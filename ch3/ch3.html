<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2015-08-28 Fri 08:19 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Structure and Interpretation of Computer Programs (SICP)</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Robert Irelan" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Structure and Interpretation of Computer Programs (SICP)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline109"><span class="todo nilTODO">TODO</span> Chapter 3: Modularity, Objects, and State</a>
<ul>
<li><a href="#orgheadline12"><span class="done nilDONE">DONE</span> 3.1: Assignment and Local State</a>
<ul>
<li><a href="#orgheadline5"><span class="done nilDONE">DONE</span> 3.1.1: Local State Variables</a>
<ul>
<li><a href="#orgheadline1"><span class="done nilDONE">DONE</span> Exercise 3.1.</a></li>
<li><a href="#orgheadline2"><span class="done nilDONE">DONE</span> Exercise 3.2.</a></li>
<li><a href="#orgheadline3"><span class="done nilDONE">DONE</span> Exercise 3.3.</a></li>
<li><a href="#orgheadline4"><span class="done nilDONE">DONE</span> Exercise 3.4.</a></li>
</ul>
</li>
<li><a href="#orgheadline8"><span class="done nilDONE">DONE</span> 3.1.2: The Benefits of Introducing Assignment</a>
<ul>
<li><a href="#orgheadline6"><span class="done nilDONE">DONE</span> Exercise 3.5.</a></li>
<li><a href="#orgheadline7"><span class="done nilDONE">DONE</span> Exercise 3.6.</a></li>
</ul>
</li>
<li><a href="#orgheadline11"><span class="done nilDONE">DONE</span> 3.1.3: The Costs of Introducing Assignment</a>
<ul>
<li><a href="#orgheadline9"><span class="done nilDONE">DONE</span> Exercise 3.7.</a></li>
<li><a href="#orgheadline10"><span class="done nilDONE">DONE</span> Exercise 3.8.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline20"><span class="done nilDONE">DONE</span> 3.2: The Environment Model of Evaluation</a>
<ul>
<li><a href="#orgheadline13"><span class="done nilDONE">DONE</span> 3.2.1: The Rules for Evaluation</a></li>
<li><a href="#orgheadline15"><span class="done nilDONE">DONE</span> 3.2.2: Applying Simple Procedures</a>
<ul>
<li><a href="#orgheadline14"><span class="done nilDONE">DONE</span> Exercise 3.9.</a></li>
</ul>
</li>
<li><a href="#orgheadline17"><span class="done nilDONE">DONE</span> 3.2.3: Frames as the Repository of Local State</a>
<ul>
<li><a href="#orgheadline16"><span class="done nilDONE">DONE</span> Exercise 3.10.</a></li>
</ul>
</li>
<li><a href="#orgheadline19"><span class="done nilDONE">DONE</span> 3.2.4: Internal Definitions</a>
<ul>
<li><a href="#orgheadline18"><span class="done nilDONE">DONE</span> Exercise 3.11.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline52"><span class="done nilDONE">DONE</span> 3.3: Modeling with Mutable Data</a>
<ul>
<li><a href="#orgheadline30"><span class="done nilDONE">DONE</span> 3.3.1: Mutable List Structure</a>
<ul>
<li><a href="#orgheadline21"><span class="done nilDONE">DONE</span> Exercise 3.12.</a></li>
<li><a href="#orgheadline22"><span class="done nilDONE">DONE</span> Exercise 3.13.</a></li>
<li><a href="#orgheadline23"><span class="done nilDONE">DONE</span> Exercise 3.14.</a></li>
<li><a href="#orgheadline24"><span class="done nilDONE">DONE</span> Exercise 3.15.</a></li>
<li><a href="#orgheadline25"><span class="done nilDONE">DONE</span> Exercise 3.16.</a></li>
<li><a href="#orgheadline26"><span class="done nilDONE">DONE</span> Exercise 3.17.</a></li>
<li><a href="#orgheadline27"><span class="done nilDONE">DONE</span> Exercise 3.18.</a></li>
<li><a href="#orgheadline28"><span class="done nilDONE">DONE</span> Exercise 3.19.</a></li>
<li><a href="#orgheadline29"><span class="done nilDONE">DONE</span> Exercise 3.20.</a></li>
</ul>
</li>
<li><a href="#orgheadline31"><span class="done nilDONE">DONE</span> 3.3.2: Representing Queues</a>
<ul>
<li><a href="#orgheadline32"><span class="done nilDONE">DONE</span> Exercise 3.21.</a></li>
<li><a href="#orgheadline33"><span class="done nilDONE">DONE</span> Exercise 3.22.</a></li>
<li><a href="#orgheadline34"><span class="done nilDONE">DONE</span> Exercise 3.23.</a></li>
</ul>
</li>
<li><a href="#orgheadline39"><span class="done nilDONE">DONE</span> 3.3.3: Representing Tables</a>
<ul>
<li><a href="#orgheadline35"><span class="done nilDONE">DONE</span> Exercise 3.24.</a></li>
<li><a href="#orgheadline36"><span class="done nilDONE">DONE</span> Exercise 3.25.</a></li>
<li><a href="#orgheadline37"><span class="done nilDONE">DONE</span> Exercise 3.26.</a></li>
<li><a href="#orgheadline38"><span class="todo nilHOLD">HOLD</span> Exercise 3.27.&#xa0;&#xa0;&#xa0;<span class="tag"><span class="HOLD">HOLD</span></span></a></li>
</ul>
</li>
<li><a href="#orgheadline40"><span class="done nilDONE">DONE</span> 3.3.4: A Simulator for Digital Circuits</a>
<ul>
<li><a href="#orgheadline41"><span class="done nilDONE">DONE</span> Exercise 3.28.</a></li>
<li><a href="#orgheadline42"><span class="done nilDONE">DONE</span> Exercise 3.29.</a></li>
<li><a href="#orgheadline43"><span class="done nilDONE">DONE</span> Exercise 3.30.</a></li>
<li><a href="#orgheadline44"><span class="done nilDONE">DONE</span> Exercise 3.31.</a></li>
<li><a href="#orgheadline45"><span class="done nilDONE">DONE</span> Exercise 3.32.</a></li>
</ul>
</li>
<li><a href="#orgheadline46"><span class="done nilDONE">DONE</span> 3.3.5: Propagation of Constraints</a>
<ul>
<li><a href="#orgheadline47"><span class="done nilDONE">DONE</span> Exercise 3.33.</a></li>
<li><a href="#orgheadline48"><span class="done nilDONE">DONE</span> Exercise 3.34.</a></li>
<li><a href="#orgheadline49"><span class="done nilDONE">DONE</span> Exercise 3.35.</a></li>
<li><a href="#orgheadline50"><span class="done nilDONE">DONE</span> Exercise 3.36.</a></li>
<li><a href="#orgheadline51"><span class="done nilDONE">DONE</span> Exercise 3.37.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline68"><span class="todo nilTODO">TODO</span> 3.4: Concurrency: Time Is of the Essence</a>
<ul>
<li><a href="#orgheadline53"><span class="done nilDONE">DONE</span> Read Section 3.4</a></li>
<li><a href="#orgheadline54"><span class="todo nilTODO">TODO</span> 3.4.1: The Nature of Time in Concurrent Systems</a>
<ul>
<li><a href="#orgheadline55"><span class="todo nilTODO">TODO</span> Exercise 3.38.</a></li>
</ul>
</li>
<li><a href="#orgheadline56"><span class="todo nilTODO">TODO</span> 3.4.2: Mechanisms for Controlling Concurrency</a>
<ul>
<li><a href="#orgheadline57"><span class="todo nilTODO">TODO</span> Exercise 3.39.</a></li>
<li><a href="#orgheadline58"><span class="todo nilTODO">TODO</span> Exercise 3.40.</a></li>
<li><a href="#orgheadline59"><span class="todo nilTODO">TODO</span> Exercise 3.41.</a></li>
<li><a href="#orgheadline60"><span class="todo nilTODO">TODO</span> Exercise 3.42.</a></li>
<li><a href="#orgheadline61"><span class="todo nilTODO">TODO</span> Exercise 3.43.</a></li>
<li><a href="#orgheadline62"><span class="todo nilTODO">TODO</span> Exercise 3.44.</a></li>
<li><a href="#orgheadline63"><span class="todo nilTODO">TODO</span> Exercise 3.45.</a></li>
<li><a href="#orgheadline64"><span class="todo nilTODO">TODO</span> Exercise 3.46.</a></li>
<li><a href="#orgheadline65"><span class="todo nilTODO">TODO</span> Exercise 3.47.</a></li>
<li><a href="#orgheadline66"><span class="todo nilTODO">TODO</span> Exercise 3.48.</a></li>
<li><a href="#orgheadline67"><span class="todo nilTODO">TODO</span> Exercise 3.49.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline69"><span class="todo nilTODO">TODO</span> 3.5: Streams</a>
<ul>
<li><a href="#orgheadline73"><span class="done nilDONE">DONE</span> 3.5.1: Streams Are Delayed Lists</a>
<ul>
<li><a href="#orgheadline70"><span class="done nilDONE">DONE</span> Exercise 3.50.</a></li>
<li><a href="#orgheadline71"><span class="done nilDONE">DONE</span> Exercise 3.51.</a></li>
<li><a href="#orgheadline72"><span class="done nilDONE">DONE</span> Exercise 3.52.</a></li>
</ul>
</li>
<li><a href="#orgheadline74"><span class="todo nilTODO">TODO</span> 3.5.2: Infinite Streams</a>
<ul>
<li><a href="#orgheadline75"><span class="done nilDONE">DONE</span> Exercise 3.53.</a></li>
<li><a href="#orgheadline76"><span class="todo nilTODO">TODO</span> Exercise 3.54.</a></li>
<li><a href="#orgheadline77"><span class="done nilDONE">DONE</span> Exercise 3.55.</a></li>
<li><a href="#orgheadline78"><span class="done nilDONE">DONE</span> Exercise 3.56.</a></li>
<li><a href="#orgheadline79"><span class="todo nilTODO">TODO</span> Exercise 3.57.</a></li>
<li><a href="#orgheadline80"><span class="todo nilTODO">TODO</span> Exercise 3.58.</a></li>
<li><a href="#orgheadline81"><span class="todo nilTODO">TODO</span> Exercise 3.59.</a></li>
<li><a href="#orgheadline82"><span class="todo nilTODO">TODO</span> Exercise 3.60.</a></li>
<li><a href="#orgheadline83"><span class="todo nilTODO">TODO</span> Exercise 3.61.</a></li>
<li><a href="#orgheadline84"><span class="todo nilTODO">TODO</span> Exercise 3.62.</a></li>
</ul>
</li>
<li><a href="#orgheadline85"><span class="todo nilTODO">TODO</span> 3.5.3: Exploiting the Stream Paradigm</a>
<ul>
<li><a href="#orgheadline86"><span class="done nilDONE">DONE</span> Exercise 3.63.</a></li>
<li><a href="#orgheadline87"><span class="done nilDONE">DONE</span> Exercise 3.64.</a></li>
<li><a href="#orgheadline88"><span class="done nilDONE">DONE</span> Exercise 3.65.</a></li>
<li><a href="#orgheadline89"><span class="done nilDONE">DONE</span> Exercise 3.66.</a></li>
<li><a href="#orgheadline90"><span class="done nilDONE">DONE</span> Exercise 3.67.</a></li>
<li><a href="#orgheadline91"><span class="todo nilTODO">TODO</span> Exercise 3.68.</a></li>
<li><a href="#orgheadline92"><span class="todo nilTODO">TODO</span> Exercise 3.69.</a></li>
<li><a href="#orgheadline93"><span class="todo nilTODO">TODO</span> Exercise 3.70.</a></li>
<li><a href="#orgheadline94"><span class="todo nilTODO">TODO</span> Exercise 3.71.</a></li>
<li><a href="#orgheadline95"><span class="todo nilTODO">TODO</span> Exercise 3.72.</a></li>
<li><a href="#orgheadline96"><span class="done nilDONE">DONE</span> Exercise 3.73.</a></li>
<li><a href="#orgheadline97"><span class="done nilDONE">DONE</span> Exercise 3.74.</a></li>
<li><a href="#orgheadline98"><span class="done nilDONE">DONE</span> Exercise 3.75.</a></li>
<li><a href="#orgheadline99"><span class="done nilDONE">DONE</span> Exercise 3.76.</a></li>
</ul>
</li>
<li><a href="#orgheadline100"><span class="done nilDONE">DONE</span> 3.5.4: Streams and Delayed Evaluation</a>
<ul>
<li><a href="#orgheadline101">Code</a></li>
<li><a href="#orgheadline102"><span class="done nilDONE">DONE</span> Exercise 3.77.</a></li>
<li><a href="#orgheadline103"><span class="done nilDONE">DONE</span> Exercise 3.78.</a></li>
<li><a href="#orgheadline104"><span class="done nilDONE">DONE</span> Exercise 3.79.</a></li>
<li><a href="#orgheadline105"><span class="done nilDONE">DONE</span> Exercise 3.80.</a></li>
</ul>
</li>
<li><a href="#orgheadline106"><span class="done nilDONE">DONE</span> 3.5.5: Modularity of Functional Programs and Modularity of Objects</a>
<ul>
<li><a href="#orgheadline107"><span class="done nilDONE">DONE</span> Exercise 3.81.</a></li>
<li><a href="#orgheadline108"><span class="done nilDONE">DONE</span> Exercise 3.82.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline109" class="outline-2">
<h2 id="orgheadline109"><span class="todo TODO">TODO</span> Chapter 3: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-19.html#%_chap_3">Modularity, Objects, and State</a></h2>
<div class="outline-text-2" id="text-orgheadline109">
</div><div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"><span class="done DONE">DONE</span> 3.1: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_sec_3.1">Assignment and Local State</a></h3>
<div class="outline-text-3" id="text-orgheadline12">
</div><div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5"><span class="done DONE">DONE</span> 3.1.1: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_sec_3.1.1">Local State Variables</a></h4>
<div class="outline-text-4" id="text-orgheadline5">
</div><div id="outline-container-orgheadline1" class="outline-5">
<h5 id="orgheadline1"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.1">Exercise 3.1.</a></h5>
<div class="outline-text-5" id="text-orgheadline1">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-accumulator</span> initial<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>increment<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">set!</span> initial <span style="color: #709870;">(</span>+ initial increment<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    initial<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-1"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">A</span> <span style="color: #7388d6;">(</span>make-accumulator 5<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 15
      <span style="color: #7388d6;">(</span>A 10<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 25
      <span style="color: #7388d6;">(</span>A 10<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-5">
<h5 id="orgheadline2"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.2">Exercise 3.2.</a></h5>
<div class="outline-text-5" id="text-orgheadline2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-monitored</span> f<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">counter</span> 0<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>equal? x 'how-many-calls?<span style="color: #907373;">)</span>
           counter<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>equal? x 'reset-count<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> counter 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span>f x<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> counter <span style="color: #6276ba;">(</span>+ counter 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-2"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">s</span> <span style="color: #7388d6;">(</span>make-monitored sqrt<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 10
      <span style="color: #7388d6;">(</span>s 100<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 1
      <span style="color: #7388d6;">(</span>s 'how-many-calls?<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-5">
<h5 id="orgheadline3"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.3">Exercise 3.3.</a></h5>
<div class="outline-text-5" id="text-orgheadline3">
<p>
Modify the <code>make-account</code> procedure so that it creates password-protected
accounts. That is, <code>make-account</code> should take a symbol as an additional
argument, as in
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-account</span> balance password<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">withdraw</span> amount<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>&gt;= balance amount<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">begin</span> <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> balance <span style="color: #6276ba;">(</span>- balance amount<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               balance<span style="color: #709870;">)</span>
        <span style="color: #8b2252;">"Insufficient funds"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">deposit</span> amount<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">set!</span> balance <span style="color: #709870;">(</span>+ balance amount<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    balance<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">dispatch</span> p m<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>equal? p password<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>x<span style="color: #907373;">)</span> <span style="color: #8b2252;">"Incorrect password"</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'withdraw<span style="color: #6276ba;">)</span> withdraw<span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'deposit<span style="color: #6276ba;">)</span> deposit<span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"Unknown request -- MAKE-ACCOUNT"</span>
                           m<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  dispatch<span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-3"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">acc</span> <span style="color: #7388d6;">(</span>make-account 100 'secret-password<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 60
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>acc 'secret-password 'withdraw<span style="color: #909183;">)</span> 40<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #8b2252;">"Incorrect password"</span>
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>acc 'some-other-password 'deposit<span style="color: #909183;">)</span> 50<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-5">
<h5 id="orgheadline4"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.4">Exercise 3.4.</a></h5>
<div class="outline-text-5" id="text-orgheadline4">
<p>
As the prompt states, there's little more work involved than to add
a <code>incorrect-password-attempts</code>, which we use to <code>call-the-cops</code> when too many
incorrect attempts in a row have been made. Ideally, a different response
would not be returned to the user when the cops have been called, but I've
decided to do so for ease of testing.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-account</span> balance password<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">incorrect-password-attempts</span> 0<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">call-the-cops</span><span style="color: #909183;">)</span>
    <span style="color: #8b2252;">"Please wait -- calling the cops..."</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">withdraw</span> amount<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>&gt;= balance amount<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">begin</span> <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> balance <span style="color: #6276ba;">(</span>- balance amount<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               balance<span style="color: #709870;">)</span>
        <span style="color: #8b2252;">"Insufficient funds"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">deposit</span> amount<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">set!</span> balance <span style="color: #709870;">(</span>+ balance amount<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    balance<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">dispatch</span> p m<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>equal? p password<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>x<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> incorrect-password-attempts
                <span style="color: #6276ba;">(</span>+ incorrect-password-attempts 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>&gt; incorrect-password-attempts 7<span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span>call-the-cops<span style="color: #6276ba;">)</span>
              <span style="color: #8b2252;">"Incorrect password"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">begin</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> incorrect-password-attempts 0<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>eq? m 'withdraw<span style="color: #858580;">)</span> withdraw<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>eq? m 'deposit<span style="color: #858580;">)</span> deposit<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span> <span style="color: #858580;">(</span>error <span style="color: #8b2252;">"Unknown request -- MAKE-ACCOUNT"</span>
                             m<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  dispatch<span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-4"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">acc</span> <span style="color: #7388d6;">(</span>make-account 100 'secret-password<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">for-each</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>i<span style="color: #909183;">)</span>
            <span style="color: #909183;">(</span>test <span style="color: #8b2252;">"Incorrect password"</span>
                  <span style="color: #709870;">(</span><span style="color: #907373;">(</span>acc 'some-other-password 'withdraw<span style="color: #907373;">)</span> 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
          <span style="color: #7388d6;">(</span>iota 7<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #8b2252;">"Please wait -- calling the cops..."</span>
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>acc 'some-other-password 'withdraw<span style="color: #909183;">)</span> 100<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-4">
<h4 id="orgheadline8"><span class="done DONE">DONE</span> 3.1.2: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_sec_3.1.2">The Benefits of Introducing Assignment</a></h4>
<div class="outline-text-4" id="text-orgheadline8">
</div><div id="outline-container-orgheadline6" class="outline-5">
<h5 id="orgheadline6"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.5">Exercise 3.5.</a></h5>
<div class="outline-text-5" id="text-orgheadline6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">estimate-integral</span> P x1 x2 y1 y2 ntrial<span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Number of trials for which the trial point was inside the region to be</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">integrated (i.e., where (= (P x y) #t)).</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">ninside</span> 0<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">random-x</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>random-in-range x1 x2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">random-y</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>random-in-range y1 y2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">try</span> x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>P x y<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">set!</span> ninside <span style="color: #907373;">(</span>+ ninside 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">for-each</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>try <span style="color: #907373;">(</span>random-x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>random-y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
            <span style="color: #909183;">(</span>iota ntrial<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>* <span style="color: #909183;">(</span>- x2 x1<span style="color: #909183;">)</span>
     <span style="color: #909183;">(</span>- y2 y1<span style="color: #909183;">)</span>
     <span style="color: #909183;">(</span>/ ninside ntrial<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-5"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">p-circle</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>&gt; <span style="color: #709870;">(</span>* 1.0 1.0<span style="color: #709870;">)</span>
       <span style="color: #709870;">(</span>+ <span style="color: #907373;">(</span>* x x<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>* y y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>current-test-epsilon 0.10<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">pi</span> <span style="color: #7388d6;">(</span>* 4 <span style="color: #909183;">(</span>atan 1 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">parameterize</span> <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>current-test-epsilon 0.10<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
              <span style="color: #7388d6;">(</span>test pi
                    <span style="color: #909183;">(</span>estimate-integral <span style="color: #709870;">(</span>p-circle<span style="color: #709870;">)</span> -2.0 2.0 -2.0 2.0 100000<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-5">
<h5 id="orgheadline7"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.6">Exercise 3.6.</a></h5>
<div class="outline-text-5" id="text-orgheadline7">
<p>
This is a fairly simple modification of the <code>rand</code> command defined in the
book. The main change is to dispatch on a <code>command</code> argument to <code>rand</code>. Also,
since the <code>reset</code> argument sets the seed of the random number generator, I
don't define a <code>random-init</code> variable here. Thus, it is necessary to make at
least one call to <code>(rand 'reset)</code> before using <code>(rand 'generate)</code> to make sure
the seed is initialized.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">rand</span> command<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> nil<span style="color: #7388d6;">)</span>                        <span style="color: #b22222;">; </span><span style="color: #b22222;">Don't produce random numbers until initialized</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>equal? command 'generate<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">set!</span> x <span style="color: #907373;">(</span>rand-update x<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         x<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>equal? command 'reset<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>x-init<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> x x-init<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"RAND -- bad command"</span><span style="color: #709870;">)</span>
         command<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-4">
<h4 id="orgheadline11"><span class="done DONE">DONE</span> 3.1.3: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_sec_3.1.3">The Costs of Introducing Assignment</a></h4>
<div class="outline-text-4" id="text-orgheadline11">
</div><div id="outline-container-orgheadline9" class="outline-5">
<h5 id="orgheadline9"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.7">Exercise 3.7.</a></h5>
<div class="outline-text-5" id="text-orgheadline9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-3"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-joint</span> account original-password new-password<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">dispatch</span> p m<span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">The underlying account accepts only original-password, so accept</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">new-password by passing original-password. Otherwise, let the underlying</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">account deal with error handling for a wrong password.</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>equal? p new-password<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>account original-password m<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>account p m<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  dispatch<span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-7"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">acc</span> <span style="color: #7388d6;">(</span>make-account 140 'secret-password<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">joint-acc</span>
  <span style="color: #7388d6;">(</span>make-joint acc 'secret-password 'proxy-password<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Both `acc` and `joint-acc` accept the original password, and actions on</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">either affect the other since `joint-acc` delegates all messages to `acc`.</span>
<span style="color: #707183;">(</span>test 100
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>joint-acc 'secret-password 'withdraw<span style="color: #909183;">)</span> 40<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 60
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>joint-acc 'secret-password 'withdraw<span style="color: #909183;">)</span> 40<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Neither account works with an unknown password.</span>
<span style="color: #707183;">(</span>test <span style="color: #8b2252;">"Incorrect password"</span>
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>acc 'some-other-password 'deposit<span style="color: #909183;">)</span> 50<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #8b2252;">"Incorrect password"</span>
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>joint-acc 'some-other-password 'deposit<span style="color: #909183;">)</span> 50<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Original account `acc` doesn't work with the proxy password, but the joint</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">account `joint-acc` does.</span>
<span style="color: #707183;">(</span>test <span style="color: #8b2252;">"Incorrect password"</span>
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>acc 'proxy-password 'withdraw<span style="color: #909183;">)</span> 20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 40
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>joint-acc 'proxy-password 'withdraw<span style="color: #909183;">)</span> 20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-5">
<h5 id="orgheadline10"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-20.html#%_thm_3.8">Exercise 3.8.</a></h5>
<div class="outline-text-5" id="text-orgheadline10">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">f</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>cache '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>null? x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> cache '<span style="color: #858580;">()</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #b22222;">; </span><span style="color: #b22222;">Allow cache to be cleared.</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>null? cache<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> 0<span style="color: #907373;">)</span>      <span style="color: #b22222;">; </span><span style="color: #b22222;">Return 0 if cache isn't clear.</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> cache x<span style="color: #6276ba;">)</span>       <span style="color: #b22222;">; </span><span style="color: #b22222;">Set cache if it isn't clear already.</span>
                  x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-8"</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Simulate left-to-right evaluation by assigning to temporaries</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> <span style="color: #7388d6;">(</span>f 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">y</span> <span style="color: #7388d6;">(</span>f 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>+ x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Reset cache</span>
<span style="color: #707183;">(</span>f '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Right-to-left evaluation</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">y</span> <span style="color: #7388d6;">(</span>f 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> <span style="color: #7388d6;">(</span>f 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 1
      <span style="color: #7388d6;">(</span>+ x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline20" class="outline-3">
<h3 id="orgheadline20"><span class="done DONE">DONE</span> 3.2: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_sec_3.2">The Environment Model of Evaluation</a></h3>
<div class="outline-text-3" id="text-orgheadline20">
</div><div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="done DONE">DONE</span> 3.2.1: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_sec_3.2.1">The Rules for Evaluation</a></h4>
<div class="outline-text-4" id="text-orgheadline13">
<p>
No exercises
</p>
</div>
</div>


<div id="outline-container-orgheadline15" class="outline-4">
<h4 id="orgheadline15"><span class="done DONE">DONE</span> 3.2.2: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_sec_3.2.2">Applying Simple Procedures</a></h4>
<div class="outline-text-4" id="text-orgheadline15">
</div><div id="outline-container-orgheadline14" class="outline-5">
<h5 id="orgheadline14"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_thm_3.9">Exercise 3.9.</a></h5>
<div class="outline-text-5" id="text-orgheadline14">
<p>
I don't want to draw, so I'll use Scheme S-expressions instead.
</p>

<p>
In general, each invocation of a procedure creates an environment containing a
reference to its enclosing environment and a list of references to its
parameters. The global environment is much the same except that has a nil
pointer for the enclosing environment since there is no enclosing
environment. In the below, I've represented each parameter as a list of the
symbol name and value, but the symbol name is only preserved here for ease of
following the examples &#x2013; it doesn't necessarily have to be kept in an actual
interpreter.
</p>

<p>
The recursive definition of <code>factorial</code>,
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">factorial</span> n<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>= n 1<span style="color: #909183;">)</span>
      1
      <span style="color: #909183;">(</span>* n <span style="color: #709870;">(</span>factorial <span style="color: #907373;">(</span>- n 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
spawns a separate environment for each call of <code>factorial</code>, each of which has a
reference to the global environment and the value of its one argument:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">global-env</span> `<span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> <span style="color: #909183;">(</span>factorial ,factorial-proc<span style="color: #909183;">)</span>
                        <span style="color: #909183;">(</span>fact-iter ,fact-iter-proc<span style="color: #909183;">)</span>
                        ,@intrinsic-defs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">all-envs</span> `<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>,global-env <span style="color: #709870;">(</span>n ,6<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> ,all-envs `<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>,global-env <span style="color: #709870;">(</span>n ,5<span style="color: #709870;">)</span><span style="color: #909183;">)</span> ,all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> ,all-envs `<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>,global-env <span style="color: #709870;">(</span>n ,4<span style="color: #709870;">)</span><span style="color: #909183;">)</span> ,all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> ,all-envs `<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>,global-env <span style="color: #709870;">(</span>n ,3<span style="color: #709870;">)</span><span style="color: #909183;">)</span> ,all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> ,all-envs `<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>,global-env <span style="color: #709870;">(</span>n ,2<span style="color: #709870;">)</span><span style="color: #909183;">)</span> ,all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> ,all-envs `<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>,global-env <span style="color: #709870;">(</span>n ,1<span style="color: #709870;">)</span><span style="color: #909183;">)</span> ,all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> all-envs <span style="color: #7388d6;">(</span>cdr all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> all-envs <span style="color: #7388d6;">(</span>cdr all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> all-envs <span style="color: #7388d6;">(</span>cdr all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> all-envs <span style="color: #7388d6;">(</span>cdr all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> all-envs <span style="color: #7388d6;">(</span>cdr all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> all-envs <span style="color: #7388d6;">(</span>cdr all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>assert <span style="color: #7388d6;">(</span>null? all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
In contrast, the iterative version,
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">factorial</span> n<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>fact-iter 1 1 n<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">fact-iter</span> product counter max-count<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>&gt; counter max-count<span style="color: #909183;">)</span>
      product
      <span style="color: #909183;">(</span>fact-iter <span style="color: #709870;">(</span>* counter product<span style="color: #709870;">)</span>
                 <span style="color: #709870;">(</span>+ counter 1<span style="color: #709870;">)</span>
                 max-count<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
because it is tail recursive, replaces the environment of the function from
which a tail recursive call is made with the environment for the target
function of the tail recursive call. Since all function calls in both
<code>factorial</code> and <code>fact-iter</code> are tail recursive, the list of environments
changes basically as described in the pseudocode below:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">global-env</span> `<span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> <span style="color: #909183;">(</span>factorial ,factorial-proc<span style="color: #909183;">)</span>
                     <span style="color: #909183;">(</span>fact-iter ,fact-iter-proc<span style="color: #909183;">)</span>
                     ,@intrinsic-defs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">all-envs</span> `<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>global-env <span style="color: #709870;">(</span>n ,6<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! all-envs `<span style="color: #7388d6;">(</span>global-env <span style="color: #909183;">(</span>product ,1<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>counter ,1<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>max-count ,6<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! all-envs `<span style="color: #7388d6;">(</span>global-env <span style="color: #909183;">(</span>product ,1<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>counter ,2<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>max-count ,6<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! all-envs `<span style="color: #7388d6;">(</span>global-env <span style="color: #909183;">(</span>product ,2<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>counter ,3<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>max-count ,6<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! all-envs `<span style="color: #7388d6;">(</span>global-env <span style="color: #909183;">(</span>product ,6<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>counter ,4<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>max-count ,6<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! all-envs `<span style="color: #7388d6;">(</span>global-env <span style="color: #909183;">(</span>product ,24<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>counter ,5<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>max-count ,6<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! all-envs `<span style="color: #7388d6;">(</span>global-env <span style="color: #909183;">(</span>product ,120<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>counter ,6<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>max-count ,6<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! all-envs `<span style="color: #7388d6;">(</span>global-env <span style="color: #909183;">(</span>product ,720<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>counter ,7<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>max-count ,6<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> all-envs <span style="color: #7388d6;">(</span>cdr all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>assert <span style="color: #7388d6;">(</span>null? all-envs<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Notice above that we've really simulated a stack, with <code>set-car!</code> performing a
mutation-in-place of the top entry of the stack.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="done DONE">DONE</span> 3.2.3: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_sec_3.2.3">Frames as the Repository of Local State</a></h4>
<div class="outline-text-4" id="text-orgheadline17">
</div><div id="outline-container-orgheadline16" class="outline-5">
<h5 id="orgheadline16"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_thm_3.10">Exercise 3.10.</a></h5>
<div class="outline-text-5" id="text-orgheadline16">
<p>
The procedure to be analyzed,
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-withdraw</span> initial-amount<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>balance initial-amount<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>amount<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>&gt;= balance amount<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">begin</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> balance <span style="color: #858580;">(</span>- balance amount<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 balance<span style="color: #907373;">)</span>
          <span style="color: #8b2252;">"Insufficient funds"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
expands to the following when <code>let</code> is expanded to its underlying syntax:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-withdraw</span> initial-amount<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>balance<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>amount<span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>&gt;= balance amount<span style="color: #6276ba;">)</span>
           <span style="color: #6276ba;">(</span><span style="color: #a020f0;">begin</span> <span style="color: #858580;">(</span><span style="color: #a020f0;">set!</span> balance <span style="color: #80a880;">(</span>- balance amount<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  balance<span style="color: #6276ba;">)</span>
           <span style="color: #8b2252;">"Insufficient funds"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   initial-amount<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Without TCE, the function returned by <code>make-withdraw</code> (i.e.,
<code>(lambda (amount) ⋯)</code>), has a pointer the environment of
<code>(lambda (balance) ⋯)</code>, which has a pointer to the global environment. However,
the call to <code>(lambda (balance) ⋯)</code> is in tail position, so it replaces the
environment formed by the call of <code>make-withdraw</code>. When the returned
<code>(lambda (amount) ⋯)</code> is called, it therefore has a pointer to the environment
of <code>(lambda (balance) ⋯)</code>, which points to the global environment.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-4">
<h4 id="orgheadline19"><span class="done DONE">DONE</span> 3.2.4: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_sec_3.2.4">Internal Definitions</a></h4>
<div class="outline-text-4" id="text-orgheadline19">
</div><div id="outline-container-orgheadline18" class="outline-5">
<h5 id="orgheadline18"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%_thm_3.11">Exercise 3.11.</a></h5>
<div class="outline-text-5" id="text-orgheadline18">
<p>
The environment for <code>make-account</code> points to the global environment. In this
environment exist references to the argument <code>balance</code> as well as the local
procedures <code>withdraw</code>, <code>deposit</code>, and <code>dispatch</code>. Each local procedure points to
the environment of <code>make-account</code> (and retains references to its own arguments
as well). It's necessary to keep references to the local procedures in the
environment of <code>make-account</code> so that <code>dispatch</code> can resolve the references to
<code>withdraw</code> and <code>deposit</code> in its body. (On the other hand, it should not
strictly be necessary to retain a reference to <code>dispatch</code> since a reference to
that procedure is returned.)
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline52" class="outline-3">
<h3 id="orgheadline52"><span class="done DONE">DONE</span> 3.3: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_sec_3.3">Modeling with Mutable Data</a></h3>
<div class="outline-text-3" id="text-orgheadline52">
</div><div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="done DONE">DONE</span> 3.3.1: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_sec_3.3.1">Mutable List Structure</a></h4>
<div class="outline-text-4" id="text-orgheadline30">
</div><div id="outline-container-orgheadline21" class="outline-5">
<h5 id="orgheadline21"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.12">Exercise 3.12.</a></h5>
<div class="outline-text-5" id="text-orgheadline21">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Nondestructive</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> <span style="color: #7388d6;">(</span>list 'a 'b<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">y</span> <span style="color: #7388d6;">(</span>list 'c 'd<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">z</span> <span style="color: #7388d6;">(</span>append x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test z
      '<span style="color: #7388d6;">(</span>a b c d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #7388d6;">(</span>cdr x<span style="color: #7388d6;">)</span>
      '<span style="color: #7388d6;">(</span>b<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Destructive</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">w</span> <span style="color: #7388d6;">(</span>append! x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test w
      '<span style="color: #7388d6;">(</span>a b c d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #7388d6;">(</span>cdr w<span style="color: #7388d6;">)</span>
      '<span style="color: #7388d6;">(</span>b c d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-5">
<h5 id="orgheadline22"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.13">Exercise 3.13.</a></h5>
<div class="outline-text-5" id="text-orgheadline22">
<p>
When a circular list is constructed from a linear list, the last cons cell in
the original list has its cdr set to the head of the original list. Thus,
<code>(null? (cdr x))</code> never returns true for any element <code>x</code> in the list and the
<code>last-pair</code> procedure loops around the list forever.
</p>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-5">
<h5 id="orgheadline23"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.14">Exercise 3.14.</a></h5>
<div class="outline-text-5" id="text-orgheadline23">
<p>
<code>mystery</code> reverses a list destructively:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock1"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">mystery</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">loop</span> x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? x<span style="color: #709870;">)</span>
        y
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>temp <span style="color: #858580;">(</span>cdr x<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>set-cdr! x y<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>loop temp x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>loop x '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-3-14&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">v</span> '<span style="color: #7388d6;">(</span>a b c d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">w</span> <span style="color: #7388d6;">(</span>mystery v<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test w
      '<span style="color: #7388d6;">(</span>d c b a<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-5">
<h5 id="orgheadline24"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.15">Exercise 3.15.</a></h5>
<div class="outline-text-5" id="text-orgheadline24">
<p>
In Figure 3.16, modify the diagram so that the arrow pointing to the ~'a~ cell
now points to a ~'wow~ cell.
</p>

<p>
In Figure 3.17, only the arrow pointing to ~'a~ from below now points to ~'wow~
&#x2013; the arrow from above continues to point to ~'a~.
</p>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-5">
<h5 id="orgheadline25"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.16">Exercise 3.16.</a></h5>
<div class="outline-text-5" id="text-orgheadline25">
<p>
Ben Bitdiddle's flawed procedure:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock2"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">count-pairs</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span>pair? x<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      0
      <span style="color: #909183;">(</span>+ <span style="color: #709870;">(</span>count-pairs <span style="color: #907373;">(</span>car x<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>count-pairs <span style="color: #907373;">(</span>cdr x<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
We define some test data here, containing a simple list, some more complex
linked structures, and a list containing a cycle, for this and the rest of the
exercises in this section.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">pairs-3</span> '<span style="color: #7388d6;">(</span>a b c<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">pairs-4</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">begin</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> '<span style="color: #709870;">(</span>a b c<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>set-car! x <span style="color: #709870;">(</span>cddr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">pairs-7</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">begin</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> '<span style="color: #709870;">(</span>a b c<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>set-car! x <span style="color: #709870;">(</span>cdr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>set-car! <span style="color: #709870;">(</span>cdr x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cddr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">pairs-cycle</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">begin</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> '<span style="color: #709870;">(</span>a b c<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>set-cdr! <span style="color: #709870;">(</span>cddr x<span style="color: #709870;">)</span> x<span style="color: #909183;">)</span>
    x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"sharing-identity-test-data"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>count-pairs '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>count-pairs 'a<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 3
      <span style="color: #7388d6;">(</span>count-pairs pairs-3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 4
      <span style="color: #7388d6;">(</span>count-pairs pairs-4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 7
      <span style="color: #7388d6;">(</span>count-pairs pairs-7<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">No test for pairs-cycle, because a cycle causes this version of count-pairs</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">to run forever.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-5">
<h5 id="orgheadline26"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.17">Exercise 3.17.</a></h5>
<div class="outline-text-5" id="text-orgheadline26">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">count-pairs</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>seens '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">inner</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>x x<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span><span style="color: #a020f0;">or</span> <span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>pair? x<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span>memq x seens<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          0
          <span style="color: #907373;">(</span><span style="color: #a020f0;">begin</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> seens <span style="color: #858580;">(</span>cons x seens<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>+ <span style="color: #858580;">(</span>inner <span style="color: #80a880;">(</span>car x<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>inner <span style="color: #80a880;">(</span>cdr x<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
               1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"sharing-identity-test-data"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-17-count-pairs"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>count-pairs '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>count-pairs 'a<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 3
      <span style="color: #7388d6;">(</span>count-pairs pairs-3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 4
      <span style="color: #7388d6;">(</span>count-pairs pairs-4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 7
      <span style="color: #7388d6;">(</span>count-pairs pairs-7<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 3
      <span style="color: #7388d6;">(</span>count-pairs pairs-cycle<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-5">
<h5 id="orgheadline27"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.18">Exercise 3.18.</a></h5>
<div class="outline-text-5" id="text-orgheadline27">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cycle?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>seens '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">inner</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>x x<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>pair? x<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> #f<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>memq x seens<span style="color: #6276ba;">)</span> #t<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> seens <span style="color: #858580;">(</span>cons x seens<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                  <span style="color: #6276ba;">(</span>inner <span style="color: #858580;">(</span>cdr x<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"sharing-identity-test-data"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-18"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? 'a<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? pairs-3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? pairs-4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? pairs-7<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #t
      <span style="color: #7388d6;">(</span>cycle? pairs-cycle<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-5">
<h5 id="orgheadline28"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.19">Exercise 3.19.</a></h5>
<div class="outline-text-5" id="text-orgheadline28">
<p>
Use <a href="http://en.wikipedia.org/wiki/Cycle_detection#Tortoise_and_hare">Floyd's cycle-finding algorithm</a>, also known as the "tortoise-and-hare"
algorithm. Two pointers to the list elements are kept. The "tortoise" is
advanced by 1 position for every call, while the "hare" is advanced by 2
positions. If a cycle exists, the tortoise and hare will eventually run into
other (i.e., compare equal via <code>eq?</code> after the initial call).
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cycle?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">cdr-safe</span> x<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>pair? x<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        x
        <span style="color: #709870;">(</span>cdr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">cddr-safe</span> x<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>pair? x<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        x
        <span style="color: #709870;">(</span>cdr-safe <span style="color: #907373;">(</span>cdr x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">inner</span> tortoise hare first-run<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>any <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>p<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>pair? p<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span>list tortoise hare<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           #f<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>not first-run<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span>eq? tortoise hare<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           #t<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #907373;">(</span>inner <span style="color: #6276ba;">(</span>cdr-safe tortoise<span style="color: #6276ba;">)</span>
                       <span style="color: #6276ba;">(</span>cddr-safe hare<span style="color: #6276ba;">)</span>
                       #f<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>inner x x #t<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"sharing-identity-test-data"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-19"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? 'a<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? pairs-3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? pairs-4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>cycle? pairs-7<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #t
      <span style="color: #7388d6;">(</span>cycle? pairs-cycle<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline29" class="outline-5">
<h5 id="orgheadline29"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.20">Exercise 3.20.</a></h5>
<div class="outline-text-5" id="text-orgheadline29">
<p>
Given the implementation of the primitive list functions in terms of
dispatching, now including mutation,
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">-d for dispatching.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cons-d</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">set-x!</span> v<span style="color: #909183;">)</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">set!</span> x v<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">set-y!</span> v<span style="color: #909183;">)</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">set!</span> y v<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">dispatch</span> m<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? m 'car<span style="color: #907373;">)</span> x<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? m 'cdr<span style="color: #907373;">)</span> y<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? m 'set-car!<span style="color: #907373;">)</span> set-x!<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? m 'set-cdr!<span style="color: #907373;">)</span> set-y!<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Undefined operation -- CONS"</span> m<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  dispatch<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">car-d</span> z<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>z 'car<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cdr-d</span> z<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>z 'cdr<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-car-d!</span> z new-value<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>z 'set-car!<span style="color: #909183;">)</span> new-value<span style="color: #7388d6;">)</span>
  z<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-cdr-d!</span> z new-value<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>z 'set-cdr!<span style="color: #909183;">)</span> new-value<span style="color: #7388d6;">)</span>
  z<span style="color: #707183;">)</span>
</pre>
</div>

<p>
we can understand the environment diagram of the following code
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-20-cons-dispatch"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> <span style="color: #7388d6;">(</span>cons 1 2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">z</span> <span style="color: #7388d6;">(</span>cons x x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-car! <span style="color: #7388d6;">(</span>cdr z<span style="color: #7388d6;">)</span> 17<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 17
      <span style="color: #7388d6;">(</span>car x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
as follows:
</p>

<ul class="org-ul">
<li>Every call to <code>cons-d</code> returns a <code>dispatch</code> closure which has a pointer to
the environment of the <code>cons-d</code> closure, which holds the arguments to
<code>cons-d</code>, <code>x</code> and <code>y</code>.</li>
<li>All messages to the <code>dispatch</code> closure read or write to the environment of
the original <code>cons-d</code> call, which is preserved by the link from <code>dispatch</code>.</li>
<li><code>x</code> and <code>y</code>, the arguments to <code>cons-d</code>, are acted upon in precisely the same
way as the <code>car</code> and <code>cdr</code> of a normal <code>cons</code> cell.</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31"><span class="done DONE">DONE</span> 3.3.2: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_sec_3.3.2">Representing Queues</a></h4>
<div class="outline-text-4" id="text-orgheadline31">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">front-ptr</span> queue<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car queue<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">rear-ptr</span> queue<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr queue<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-front-ptr!</span> queue item<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>set-car! queue item<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-rear-ptr!</span> queue item<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>set-cdr! queue item<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">empty-queue?</span> queue<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>null? <span style="color: #909183;">(</span>front-ptr queue<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-queue</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cons '<span style="color: #909183;">()</span> '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">front-queue</span> queue<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>empty-queue? queue<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"FRONT called with an empty queue"</span> queue<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>car <span style="color: #709870;">(</span>front-ptr queue<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">insert-queue!</span> queue item<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>new-pair <span style="color: #907373;">(</span>cons item '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>empty-queue? queue<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-front-ptr! queue new-pair<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-rear-ptr! queue new-pair<span style="color: #907373;">)</span>
           queue<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span>set-cdr! <span style="color: #6276ba;">(</span>rear-ptr queue<span style="color: #6276ba;">)</span> new-pair<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-rear-ptr! queue new-pair<span style="color: #907373;">)</span>
           queue<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">delete-queue!</span> queue<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>empty-queue? queue<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"DELETE! called with an empty queue"</span> queue<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span>set-front-ptr! queue <span style="color: #907373;">(</span>cdr <span style="color: #6276ba;">(</span>front-ptr queue<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         queue<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-5">
<h5 id="orgheadline32"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.21">Exercise 3.21.</a></h5>
<div class="outline-text-5" id="text-orgheadline32">
<p>
The standard Lisp printer recursively prints the contents of a list (or cons
cell) in order. In particular, this implementation does not treat two pointers
to the same underlying object specially. With the mutation used to implement
the queue, <code>(rear-ptr queue)</code> points to the last item in the queue, while
<code>(front-ptr queue)</code> points to the head of the list that actually stores the
items in the queue. Since the last item is in the queue list, it is printed
twice, once as an element of the list and once as a lone item. (As an aside, it
appears that the queue is keeping the last item alive longer than necessary
through the pointer <code>rear-ptr</code> after the queue is empty. The implementation
should set <code>rear-ptr</code> to nil (or some other small, primitive, immutable value)
to fix this.)
</p>

<p>
Since <code>front-ptr</code> returns a pointer to the list that represents the queue, all
we need to do to print the queue properly is print that list:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">print-queue</span> q<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>display <span style="color: #909183;">(</span>front-ptr q<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-5">
<h5 id="orgheadline33"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.22">Exercise 3.22.</a></h5>
<div class="outline-text-5" id="text-orgheadline33">
<p>
A straightforward implementation uses the same approach as implementing cons
cells using dispatch &#x2013; the arguments to the constructor, retained by the
<code>dispatch</code> closure, are manipulated by subprocedures in <code>dispatch</code> in the same
way as the car and cdr of the cons cell we use to implement the queue above.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-queue-d</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>front-ptr '<span style="color: #907373;">()</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>rear-ptr '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Some of these procedures are defined to return a reference to the queue</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">on which the procedure was invoked. For consistency, we define all these</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">procedures to take `queue`.</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-front-ptr!</span> queue item<span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">set!</span> front-ptr item<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-rear-ptr!</span> queue item<span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">set!</span> rear-ptr item<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">empty-queue?</span> queue<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>null? front-ptr<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">front-queue</span> queue<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>empty-queue? queue<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"FRONT called with an empty queue"</span> queue<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>car front-ptr<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">insert-queue!</span> queue item<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>new-pair <span style="color: #858580;">(</span>cons item '<span style="color: #80a880;">()</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>empty-queue? queue<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>set-front-ptr! queue new-pair<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>set-rear-ptr! queue new-pair<span style="color: #858580;">)</span>
               queue<span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span>
               <span style="color: #858580;">(</span>set-cdr! rear-ptr new-pair<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>set-rear-ptr! queue new-pair<span style="color: #858580;">)</span>
               queue<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">delete-queue!</span> queue<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>empty-queue? queue<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"DELETE! called with an empty queue"</span> queue<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span>
             <span style="color: #6276ba;">(</span>set-front-ptr! queue <span style="color: #858580;">(</span>cdr front-ptr<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #b22222;">;; </span><span style="color: #b22222;">If the queue becomes empty, clear `rear-ptr` to avoid</span>
             <span style="color: #b22222;">;; </span><span style="color: #b22222;">unnecessarily retaining a reference to it.</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">when</span> <span style="color: #858580;">(</span>null? front-ptr<span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span>set-rear-ptr! queue '<span style="color: #80a880;">()</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             queue<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">dispatch</span> m<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'front-ptr<span style="color: #6276ba;">)</span> front-ptr<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'rear-ptr<span style="color: #6276ba;">)</span> rear-ptr<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'set-front-ptr!<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>item<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>set-front-ptr! dispatch item<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'set-rear-ptr!<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>item<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>set-rear-ptr! dispatch item<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'empty-queue?<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>empty-queue? dispatch<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'front-queue<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>front-queue dispatch<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'insert-queue!<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>item<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>insert-queue! dispatch item<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'delete-queue!<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>delete-queue! dispatch<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span>
             error <span style="color: #8b2252;">"Undefined operation - QUEUE"</span> m<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    dispatch<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-22-queue-dispatch"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">q</span> <span style="color: #7388d6;">(</span>make-queue-d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>q 'insert-queue!<span style="color: #7388d6;">)</span> 0<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>q 'front-queue<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>q 'insert-queue!<span style="color: #7388d6;">)</span> 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>q 'insert-queue!<span style="color: #7388d6;">)</span> 2<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 2
      <span style="color: #7388d6;">(</span>car <span style="color: #909183;">(</span>q 'rear-ptr<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>q 'delete-queue!<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 1
      <span style="color: #7388d6;">(</span>q 'front-queue<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>q 'delete-queue!<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>q 'delete-queue!<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #t
      <span style="color: #7388d6;">(</span>q 'empty-queue?<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #t
      <span style="color: #7388d6;">(</span>null? <span style="color: #909183;">(</span>q 'rear-ptr<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-5">
<h5 id="orgheadline34"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.23">Exercise 3.23.</a></h5>
<div class="outline-text-5" id="text-orgheadline34">
<p>
Represent as doubly-linked list. Will need selectors for DLL:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-deque</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>header <span style="color: #907373;">(</span>cons '<span style="color: #6276ba;">()</span> '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Internal procedures on internal representation of deque.</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">make-node</span> item prev next<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>cons <span style="color: #907373;">(</span>cons item prev<span style="color: #907373;">)</span> next<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">front</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>car header<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">rear</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cdr header<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-front!</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>set-car! header node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-rear!</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>set-cdr! header node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">item</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>caar node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">prev</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cdar node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">next</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cdr node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-prev!</span> this that<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>set-cdr! <span style="color: #907373;">(</span>car this<span style="color: #907373;">)</span> that<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-next!</span> this that<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>set-cdr! this that<span style="color: #709870;">)</span><span style="color: #909183;">)</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Exported procedures</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">empty?</span> self<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>eq? <span style="color: #907373;">(</span>front<span style="color: #907373;">)</span> '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">front-deque</span> self<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>item <span style="color: #907373;">(</span>front<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">rear-deque</span> self<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>item <span style="color: #907373;">(</span>rear<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">front-insert!</span> self item<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>set-front! <span style="color: #907373;">(</span>make-node item '<span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>front<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">rear-insert!</span> self item<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>set-rear! <span style="color: #907373;">(</span>make-node item <span style="color: #6276ba;">(</span>rear<span style="color: #6276ba;">)</span> '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">front-delete!</span> self<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>set-front! <span style="color: #907373;">(</span>next <span style="color: #6276ba;">(</span>front<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">rear-delete!</span> self<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>set-rear! <span style="color: #907373;">(</span>prev <span style="color: #6276ba;">(</span>rear<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>

    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">dispatch</span> m<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'empty?<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>empty? header<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'front-deque<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>front-deque header<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'rear-deque<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>rear-deque header<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'front-insert!<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>front-insert! header item<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'rear-insert!<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>rear-insert! header item<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'front-delete!<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>front-delete! header<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'rear-delete!<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>rear-delete! header<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"Undefined operation -- DEQUE"</span> m<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    dispatch<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39"><span class="done DONE">DONE</span> 3.3.3: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_sec_3.3.3">Representing Tables</a></h4>
<div class="outline-text-4" id="text-orgheadline39">
</div><div id="outline-container-orgheadline35" class="outline-5">
<h5 id="orgheadline35"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.24">Exercise 3.24.</a></h5>
<div class="outline-text-5" id="text-orgheadline35">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-table</span> same-key?<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>tbl <span style="color: #907373;">(</span>cons '*table* '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Internal procedure</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">assoc</span> key records<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>null? records<span style="color: #6276ba;">)</span> #f<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>same-key? key <span style="color: #858580;">(</span>caar records<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>car records<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>assoc key <span style="color: #858580;">(</span>cdr records<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Exported procedures</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">lookup</span> key<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>record <span style="color: #858580;">(</span>assoc key <span style="color: #80a880;">(</span>cdr tbl<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> record
            <span style="color: #6276ba;">(</span>cdr record<span style="color: #6276ba;">)</span>
            #f<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">insert!</span> key value<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>record <span style="color: #858580;">(</span>assoc key <span style="color: #80a880;">(</span>cdr tbl<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> record
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> <span style="color: #858580;">(</span>cdr record<span style="color: #858580;">)</span> value<span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> <span style="color: #858580;">(</span>cdr tbl<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cons <span style="color: #80a880;">(</span>cons key value<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>cdr tbl<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Dispatch</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">dispatch</span> msg<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>equal? msg 'lookup<span style="color: #6276ba;">)</span> lookup<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>equal? msg 'insert!<span style="color: #6276ba;">)</span> insert!<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"TABLE -- unknown message"</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
    dispatch<span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-24"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">tbl-exact</span> <span style="color: #7388d6;">(</span>make-table <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>equal? x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl-exact 'lookup<span style="color: #909183;">)</span> 'foo<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>tbl-exact 'insert!<span style="color: #7388d6;">)</span> 'a 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>tbl-exact 'insert!<span style="color: #7388d6;">)</span> 'b 2<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>tbl-exact 'insert!<span style="color: #7388d6;">)</span> 'c 3<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 1
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl-exact 'lookup<span style="color: #909183;">)</span> 'a<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 2
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl-exact 'lookup<span style="color: #909183;">)</span> 'b<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 3
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl-exact 'lookup<span style="color: #909183;">)</span> 'c<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">tbl-inexact</span> <span style="color: #7388d6;">(</span>make-table <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span>
                                  <span style="color: #709870;">(</span>&lt; <span style="color: #907373;">(</span>abs <span style="color: #6276ba;">(</span>- x y<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> .1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl-inexact 'lookup<span style="color: #909183;">)</span> 'foo<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>tbl-inexact 'insert!<span style="color: #7388d6;">)</span> 1.0 'x<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'x
      <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl-inexact 'lookup<span style="color: #909183;">)</span> 1.05<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-5">
<h5 id="orgheadline36"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.25">Exercise 3.25.</a></h5>
<div class="outline-text-5" id="text-orgheadline36">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-table</span> same-key?<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>tbl <span style="color: #907373;">(</span>cons '*table* '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">assoc</span> key records<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>null? records<span style="color: #6276ba;">)</span> #f<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>same-key? key <span style="color: #858580;">(</span>caar records<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>car records<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>assoc key <span style="color: #858580;">(</span>cdr records<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">lookup</span> keys<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">recur</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>elems <span style="color: #858580;">(</span>cdr tbl<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                  <span style="color: #6276ba;">(</span>keys keys<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>record <span style="color: #80a880;">(</span>assoc <span style="color: #887070;">(</span>car keys<span style="color: #887070;">)</span> elems<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> record
              <span style="color: #858580;">(</span><span style="color: #a020f0;">cond</span>
               <span style="color: #b22222;">;; </span><span style="color: #b22222;">If the current key maps to a list, there must be more keys to</span>
               <span style="color: #b22222;">;; </span><span style="color: #b22222;">continue the search.</span>
               <span style="color: #80a880;">(</span><span style="color: #887070;">(</span><span style="color: #a020f0;">and</span> <span style="color: #707183;">(</span>pair? <span style="color: #7388d6;">(</span>cdr keys<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> <span style="color: #707183;">(</span>pair? <span style="color: #7388d6;">(</span>cdr record<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                <span style="color: #887070;">(</span>recur <span style="color: #707183;">(</span>cdr record<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>cdr keys<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
               <span style="color: #b22222;">;; </span><span style="color: #b22222;">Ensure that e.g. `(lookup '(a b))` does not succeed if</span>
               <span style="color: #b22222;">;; </span><span style="color: #b22222;">`(lookup '(a))` does not return a list.</span>
               <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>null? <span style="color: #707183;">(</span>cdr keys<span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                <span style="color: #887070;">(</span>cdr record<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
               <span style="color: #80a880;">(</span><span style="color: #a020f0;">else</span> #f<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
              #f<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">insert!</span> keys value<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">when</span> <span style="color: #907373;">(</span>null? keys<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"INSERT! -- keys cannot be empty"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">recur</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>header tbl<span style="color: #6276ba;">)</span>
                  <span style="color: #6276ba;">(</span>keys keys<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">define</span> <span style="color: #6276ba;">(</span><span style="color: #0000ff;">recursively-insert</span> record<span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span>null? <span style="color: #80a880;">(</span>cdr keys<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
              <span style="color: #858580;">(</span><span style="color: #a020f0;">set!</span> <span style="color: #80a880;">(</span>cdr record<span style="color: #80a880;">)</span> value<span style="color: #858580;">)</span>
              <span style="color: #858580;">(</span><span style="color: #a020f0;">begin</span>
                <span style="color: #b22222;">;; </span><span style="color: #b22222;">Obliterate any non-list associated with the current key,</span>
                <span style="color: #b22222;">;; </span><span style="color: #b22222;">since it will need to be replaced.</span>
                <span style="color: #80a880;">(</span><span style="color: #a020f0;">when</span> <span style="color: #887070;">(</span>not <span style="color: #707183;">(</span>pair? <span style="color: #7388d6;">(</span>cdr record<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                      <span style="color: #887070;">(</span><span style="color: #a020f0;">set!</span> <span style="color: #707183;">(</span>cdr record<span style="color: #707183;">)</span> '<span style="color: #707183;">()</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                <span style="color: #80a880;">(</span>recur record <span style="color: #887070;">(</span>cdr keys<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>record <span style="color: #80a880;">(</span>assoc <span style="color: #887070;">(</span>car keys<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>cdr header<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span>pair? record<span style="color: #858580;">)</span>
              <span style="color: #858580;">(</span>recursively-insert record<span style="color: #858580;">)</span>
              <span style="color: #858580;">(</span><span style="color: #a020f0;">let</span> <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>inserted <span style="color: #707183;">(</span><span style="color: #a020f0;">if</span> record
                                  record
                                  <span style="color: #7388d6;">(</span>cons <span style="color: #909183;">(</span>car keys<span style="color: #909183;">)</span> '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                <span style="color: #80a880;">(</span><span style="color: #a020f0;">when</span> <span style="color: #887070;">(</span>not record<span style="color: #887070;">)</span>
                      <span style="color: #887070;">(</span><span style="color: #a020f0;">set!</span> <span style="color: #707183;">(</span>cdr header<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>cons inserted <span style="color: #7388d6;">(</span>cdr header<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                <span style="color: #80a880;">(</span>recursively-insert inserted<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">dispatch</span> msg<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>equal? msg 'lookup<span style="color: #6276ba;">)</span> lookup<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>equal? msg 'insert!<span style="color: #6276ba;">)</span> insert!<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"TABLE -- unknown message"</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    dispatch<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-25"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lookup</span> tbl keys<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl 'lookup<span style="color: #909183;">)</span> keys<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">insert!</span> tbl keys value<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl 'insert!<span style="color: #909183;">)</span> keys value<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">tbl</span> <span style="color: #7388d6;">(</span>make-table equal?<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>lookup tbl '<span style="color: #909183;">(</span>a<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>lookup tbl '<span style="color: #909183;">(</span>0 1 2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>insert! tbl '<span style="color: #7388d6;">(</span>a<span style="color: #7388d6;">)</span> 'foo<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>insert! tbl '<span style="color: #7388d6;">(</span>0 1 2<span style="color: #7388d6;">)</span> 'bar<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'foo
      <span style="color: #7388d6;">(</span>lookup tbl '<span style="color: #909183;">(</span>a<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>lookup tbl '<span style="color: #909183;">(</span>a b<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'bar
      <span style="color: #7388d6;">(</span>lookup tbl '<span style="color: #909183;">(</span>0 1 2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #t
      <span style="color: #7388d6;">(</span>pair? <span style="color: #909183;">(</span>lookup tbl '<span style="color: #709870;">(</span>0<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>insert! tbl '<span style="color: #7388d6;">(</span>a b<span style="color: #7388d6;">)</span> 'baz<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'baz
      <span style="color: #7388d6;">(</span>lookup tbl '<span style="color: #909183;">(</span>a b<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #t
      <span style="color: #7388d6;">(</span>pair? <span style="color: #909183;">(</span>lookup tbl '<span style="color: #709870;">(</span>a<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-5">
<h5 id="orgheadline37"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.26">Exercise 3.26.</a></h5>
<div class="outline-text-5" id="text-orgheadline37">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-table</span> cmp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>tbl <span style="color: #907373;">(</span>cons '*table* '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Accessor functions</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">key</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>caar node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">value</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cdar node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">left</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cadr node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">right</span> node<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cddr node<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-value!</span> node v<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>set-cdr! <span style="color: #907373;">(</span>car node<span style="color: #907373;">)</span> v<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-left!</span> node n<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>set-car! <span style="color: #907373;">(</span>cdr node<span style="color: #907373;">)</span> n<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-right!</span> node n<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>set-cdr! <span style="color: #907373;">(</span>cdr node<span style="color: #907373;">)</span> n<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">make-node</span> k v<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cons <span style="color: #b22222;">#|payload|#</span>  <span style="color: #907373;">(</span>cons k v<span style="color: #907373;">)</span>
                                  <span style="color: #b22222;">#|children|#</span> <span style="color: #907373;">(</span>cons '<span style="color: #6276ba;">()</span> '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>

    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">lookup</span> k<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">recur</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>node <span style="color: #858580;">(</span>cdr tbl<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>null? node<span style="color: #858580;">)</span> #f<span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>&lt; <span style="color: #80a880;">(</span>cmp k <span style="color: #887070;">(</span>key node<span style="color: #887070;">)</span><span style="color: #80a880;">)</span> 0<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>recur <span style="color: #80a880;">(</span>left node<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>&gt; <span style="color: #80a880;">(</span>cmp k <span style="color: #887070;">(</span>key node<span style="color: #887070;">)</span><span style="color: #80a880;">)</span> 0<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>recur <span style="color: #80a880;">(</span>right node<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span> <span style="color: #858580;">(</span>value node<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">insert!</span> k v<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">set!</span> <span style="color: #907373;">(</span>cdr tbl<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">recur</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>node <span style="color: #80a880;">(</span>cdr tbl<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>null? node<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>make-node k v<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                    <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>&lt; <span style="color: #887070;">(</span>cmp k <span style="color: #707183;">(</span>key node<span style="color: #707183;">)</span><span style="color: #887070;">)</span> 0<span style="color: #80a880;">)</span>
                     <span style="color: #80a880;">(</span>set-left! node <span style="color: #887070;">(</span>recur <span style="color: #707183;">(</span>left node<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                     node<span style="color: #858580;">)</span>
                    <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>&gt; <span style="color: #887070;">(</span>cmp k <span style="color: #707183;">(</span>key node<span style="color: #707183;">)</span><span style="color: #887070;">)</span> 0<span style="color: #80a880;">)</span>
                     <span style="color: #80a880;">(</span>set-right! node <span style="color: #887070;">(</span>recur <span style="color: #707183;">(</span>right node<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                     node<span style="color: #858580;">)</span>
                    <span style="color: #858580;">(</span><span style="color: #a020f0;">else</span> <span style="color: #80a880;">(</span>set-value! node v<span style="color: #80a880;">)</span>
                          node<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">dispatch</span> msg<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>equal? msg 'lookup<span style="color: #6276ba;">)</span> lookup<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>equal? msg 'insert!<span style="color: #6276ba;">)</span> insert!<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"TABLE -- unknown message"</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    dispatch<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-26"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lookup</span> tbl key<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl 'lookup<span style="color: #909183;">)</span> key<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">insert!</span> tbl key value<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>tbl 'insert!<span style="color: #909183;">)</span> key value<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">tbl</span> <span style="color: #7388d6;">(</span>make-table <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span>
                          <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>&lt; x y<span style="color: #6276ba;">)</span> -1<span style="color: #907373;">)</span>
                                <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>&gt; x y<span style="color: #6276ba;">)</span> 1<span style="color: #907373;">)</span>
                                <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>lookup tbl 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>insert! tbl 0 'foo<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'foo
      <span style="color: #7388d6;">(</span>lookup tbl 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>lookup tbl 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>insert! tbl -3 'bar<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'foo
      <span style="color: #7388d6;">(</span>lookup tbl 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'bar
      <span style="color: #7388d6;">(</span>lookup tbl -3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-5">
<h5 id="orgheadline38"><span class="todo HOLD">HOLD</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.27">Exercise 3.27.</a>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="HOLD">HOLD</span></span></h5>
<div class="outline-text-5" id="text-orgheadline38">
<ul class="org-ul">
<li>State "HOLD"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2015-01-18 Sun 19:09]</span></span></li>
</ul>

<p>
Ehh&#x2026;
</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline40" class="outline-4">
<h4 id="orgheadline40"><span class="done DONE">DONE</span> 3.3.4: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_sec_3.3.4">A Simulator for Digital Circuits</a></h4>
<div class="outline-text-4" id="text-orgheadline40">
<p>
Some common procedures, most copied from the book.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"logic-gates-agenda"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-wire</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>signal-value 0<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>action-procedures '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-my-signal!</span> new-value<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>= signal-value new-value<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">begin</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> signal-value new-value<span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span>call-each action-procedures<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          'done<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">accept-action-procedure!</span> proc<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">set!</span> action-procedures <span style="color: #907373;">(</span>cons proc action-procedures<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>proc<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">dispatch</span> m<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'get-signal<span style="color: #6276ba;">)</span> signal-value<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'set-signal!<span style="color: #6276ba;">)</span> set-my-signal!<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? m 'add-action!<span style="color: #6276ba;">)</span> accept-action-procedure!<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"Unknown operation -- WIRE"</span> m<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    dispatch<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">call-each</span> procedures<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? procedures<span style="color: #909183;">)</span>
      'done
      <span style="color: #909183;">(</span><span style="color: #a020f0;">begin</span>
        <span style="color: #709870;">(</span><span style="color: #907373;">(</span>car procedures<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>call-each <span style="color: #907373;">(</span>cdr procedures<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get-signal</span> wire<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>wire 'get-signal<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-signal!</span> wire new-value<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>wire 'set-signal!<span style="color: #909183;">)</span> new-value<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">add-action!</span> wire action-procedure<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>wire 'add-action!<span style="color: #909183;">)</span> action-procedure<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-probe</span> log<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">probe</span> name wire<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>add-action! wire
                 <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">()</span>
                   <span style="color: #907373;">(</span>cons <span style="color: #6276ba;">(</span>list name
                               <span style="color: #858580;">(</span>current-time the-agenda<span style="color: #858580;">)</span>
                               <span style="color: #858580;">(</span>get-signal wire<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                         log<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  probe<span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline41" class="outline-5">
<h5 id="orgheadline41"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.28">Exercise 3.28.</a></h5>
<div class="outline-text-5" id="text-orgheadline41">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock3"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">or-gate</span> a1 a2 output<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">logical-or</span> s1 s2<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">signal-valid</span> s<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">or</span> <span style="color: #907373;">(</span>= s 0<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>= s 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>signal-valid s1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Invalid signal on a1"</span> s1<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>signal-valid s2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Invalid signal on a2"</span> s2<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>= s1 0<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>= s2 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> 0<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>= s1 1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>= s2 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> 1<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>= s1 0<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>= s2 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> 1<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>= s1 1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>= s2 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> 1<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Unreachable"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">or-action-procedure</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>new-value
           <span style="color: #6276ba;">(</span>logical-or <span style="color: #858580;">(</span>get-signal a1<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>get-signal a2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>after-delay or-gate-delay
                   <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span>
                     <span style="color: #6276ba;">(</span>set-signal! output new-value<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>add-action! a1 or-action-procedure<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>add-action! a2 or-action-procedure<span style="color: #7388d6;">)</span>
  'ok<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-5">
<h5 id="orgheadline42"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.29">Exercise 3.29.</a></h5>
<div class="outline-text-5" id="text-orgheadline42">
<p>
We use this result from De Morgan's laws
</p>

\begin{equation*}
a \vee b = \neg \left( \neg a \wedge \neg b \right)
\end{equation*}

<p>
to implement the or-gate in terms of and-gates and inverters:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">or-gate</span> a1 a2 output<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>na <span style="color: #907373;">(</span>make-wire<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>nb <span style="color: #907373;">(</span>make-wire<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>c <span style="color: #907373;">(</span>make-wire<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>inverter a na<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>inverter b nb<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>and-gate na nb c<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>inverter c output<span style="color: #909183;">)</span>
    'ok<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
This construction is simpler than the primitive and-gate constructed
above. However, its propagation times are more complex &#x2013; the formula for the
total propagation time \(t_{\mathrm{total}}\), where \(t_{x}\) is the
propagation delay due to the gate that begins the wire \(x\), is
</p>

\begin{equation*}
t_{\mathrm{total}} = \t_{output} + \t_{c} + \max{(na, nb)}
\end{equation*}

<p>
This may be a larger delay than that of the primitive or-gate if the primitive
gate can be manufactured to have a delay similar to that of the and-gate, for
example. On the other hand, if the composition of inverters and and-gates has
enough of an advantage, such as individual speed or cost, over a single
primitive or-gate or-gate for whatever reason, the composed or-gate may still
be preferable.
</p>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-5">
<h5 id="orgheadline43"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.30">Exercise 3.30.</a></h5>
<div class="outline-text-5" id="text-orgheadline43">
<p>
Straightforward implementation of the diagram:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">ripple-carry-adder</span> as bs ss carry<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>cs
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">Construct the n internal wires needed to link the full-adders</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">internally and verify that as, bs, and ss all have the same length.</span>
         <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">make-cs</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>as as<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>bs bs<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>ss ss<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cs '<span style="color: #80a880;">()</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span><span style="color: #a020f0;">and</span> <span style="color: #887070;">(</span>null? as<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>null? bs<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>null? ss<span style="color: #887070;">)</span><span style="color: #80a880;">)</span> cs<span style="color: #858580;">)</span>
                    <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>null? as<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>error <span style="color: #8b2252;">"Too few bits in as"</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                    <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>null? bs<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>error <span style="color: #8b2252;">"Too few bits in bs"</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                    <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>null? ss<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>error <span style="color: #8b2252;">"Too few bits in ss"</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                    <span style="color: #858580;">(</span><span style="color: #a020f0;">else</span> <span style="color: #80a880;">(</span>make-cs <span style="color: #887070;">(</span>cdr as<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>cdr bs<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>cdr ss<span style="color: #887070;">)</span>
                                 <span style="color: #887070;">(</span>cons <span style="color: #707183;">(</span>make-wire<span style="color: #707183;">)</span> cs<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">make-adder</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>as as<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>bs bs<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>cs cs<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>ss ss<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>carry carry<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>null? as<span style="color: #6276ba;">)</span> 'ok<span style="color: #907373;">)</span>  <span style="color: #b22222;">; </span><span style="color: #b22222;">Only test `as` since all lists have same length.</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>full-adder <span style="color: #858580;">(</span>car as<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>car bs<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>car cs<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>car ss<span style="color: #858580;">)</span> carry<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span>make-adder <span style="color: #858580;">(</span>cdr as<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cdr bs<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cdr cs<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cdr ss<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>car cs<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-30"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
</pre>
</div>

<p>
The delay is troublesome &#x2013; \(n \mathrm{delay}_{\mathrm{full-adder}}\).
</p>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-5">
<h5 id="orgheadline44"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.31">Exercise 3.31.</a></h5>
<div class="outline-text-5" id="text-orgheadline44">
<p>
If the procedure is merely added without executing it, the state of the circuit
can become inconsistent until the first change to the inputs is made. For
example, consider the execution of <code>(half-adder a b s c)</code>, with <code>a</code> and <code>b</code>
initially <code>1</code> and <code>s</code> and <code>c</code> initially <code>0</code>. Without the argument <code>proc</code> being
called immediately on the call to <code>accept-action-procedure!</code>, no calls to
<code>set-my-signal!</code>, which is the only means now to call any of the
<code>action-procedures</code>, are made, so <code>s</code> and <code>c</code> remain set to <code>0</code> until the first
input is set.
</p>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-5">
<h5 id="orgheadline45"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.32">Exercise 3.32.</a></h5>
<div class="outline-text-5" id="text-orgheadline45">
<p>
It is necessary to execute the events in the same queue (i.e., those that take
place "at the same time") in FIFO order because it is in fact the case that the
and-gate observes the change to <code>a1</code> while it is scheduling <code>a2</code>.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock4"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">agenda</span>
  '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>0 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a1! 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a2! 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Stable value of and-gate output after initialization.</span>
    <span style="color: #909183;">(</span>5 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>assert-output 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Change a1 and a2 simultaneously.</span>
    <span style="color: #909183;">(</span>10 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a1! 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
         <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a2! 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>13 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Lexical capture of new-value at t = 10 after setting just a1.</span>
           <span style="color: #6276ba;">(</span>set-output! 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
         <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Lexical capture of new-value at t = 10 after setting a1 followed</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">by a2.</span>
           <span style="color: #6276ba;">(</span>set-output! 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock5"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">agenda</span>
  '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>0 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a1! 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a2! 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Stable value of and-gate output after initialization.</span>
    <span style="color: #909183;">(</span>5 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>assert-output 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Change a1 and a2 simultaneously.</span>
    <span style="color: #909183;">(</span>10 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a1! 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
         <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span> <span style="color: #6276ba;">(</span>set-a2! 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>13 <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Lexical capture of new-value at t = 10 after setting a1 followed</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">by a2.</span>
           <span style="color: #6276ba;">(</span>set-output! 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
         <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">()</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Lexical capture of new-value at t = 10 after setting just a1.</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">THIS IS THE INCORRECT RESULT.</span>
           <span style="color: #6276ba;">(</span>set-output! 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-4">
<h4 id="orgheadline46"><span class="done DONE">DONE</span> 3.3.5: <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_sec_3.3.4">Propagation of Constraints</a></h4>
<div class="outline-text-4" id="text-orgheadline46">
<p>
Implementation of constraint objects from book. Includes the primitive
procedures
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Primitive connector construction</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-connector</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>value #f<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>informant #f<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>constraints '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">set-my-value</span> newval setter<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>has-value? me<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> value newval<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> informant setter<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>for-each-except setter
                              inform-about-value
                              constraints<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>= value newval<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"Contradiction"</span> <span style="color: #858580;">(</span>list value newval<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> 'ignored<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">forget-my-value</span> retractor<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>eq? retractor informant<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">begin</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> informant #f<span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span>for-each-except retractor
                                  inform-about-no-value
                                  constraints<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          'ignored<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">connect</span> new-constraint<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>memq new-constraint constraints<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> constraints
                <span style="color: #6276ba;">(</span>cons new-constraint constraints<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>has-value? me<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>inform-about-value new-constraint<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      'done<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">me</span> request<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? request 'has-value?<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> informant #t #f<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? request 'value<span style="color: #6276ba;">)</span> value<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? request 'set-value!<span style="color: #6276ba;">)</span> set-my-value<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? request 'forget<span style="color: #6276ba;">)</span> forget-my-value<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? request 'connect<span style="color: #6276ba;">)</span> connect<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"Unknown operation -- CONNECTOR"</span>
                         request<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    me<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Convenience procedures for make-connector.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">for-each-except</span> exception procedure list<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">loop</span> items<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>null? items<span style="color: #907373;">)</span> 'done<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? <span style="color: #6276ba;">(</span>car items<span style="color: #6276ba;">)</span> exception<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>loop <span style="color: #6276ba;">(</span>cdr items<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #907373;">(</span>procedure <span style="color: #6276ba;">(</span>car items<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">(</span>loop <span style="color: #6276ba;">(</span>cdr items<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>loop list<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">has-value?</span> connector<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connector 'has-value?<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get-value</span> connector<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connector 'value<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-value!</span> connector new-value informant<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>connector 'set-value!<span style="color: #909183;">)</span> new-value informant<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">forget-value!</span> connector retractor<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>connector 'forget<span style="color: #909183;">)</span> retractor<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">connect</span> connector new-constraint<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>connector 'connect<span style="color: #909183;">)</span> new-constraint<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">inform-about-value</span> constraint<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>constraint 'I-have-a-value<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">inform-about-no-value</span> constraint<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>constraint 'I-lost-my-value<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
and some commonly used constraints, implemented in terms of the primitives:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"constraint-primitive"</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Adder constraint between summands and sum</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">adder</span> a1 a2 sum<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">process-new-value</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>has-value? a1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>has-value? a2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-value! sum
                       <span style="color: #6276ba;">(</span>+ <span style="color: #858580;">(</span>get-value a1<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>get-value a2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                       me<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>has-value? a1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>has-value? sum<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-value! a2
                       <span style="color: #6276ba;">(</span>- <span style="color: #858580;">(</span>get-value sum<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>get-value a1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                       me<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>has-value? a2<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>has-value? sum<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-value! a1
                       <span style="color: #6276ba;">(</span>- <span style="color: #858580;">(</span>get-value sum<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>get-value a2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                       me<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">process-forget-value</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>forget-value! sum me<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>forget-value! a1 me<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>forget-value! a2 me<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>process-new-value<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">me</span> request<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? request 'I-have-a-value<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>process-new-value<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? request 'I-lost-my-value<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>process-forget-value<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Unknown request -- ADDER"</span> request<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect a1 me<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect a2 me<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect sum me<span style="color: #7388d6;">)</span>
  me<span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Multiplier constraint between multiplicands and product.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplier</span> m1 m2 product<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">process-new-value</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">or</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>has-value? m1<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>= <span style="color: #80a880;">(</span>get-value m1<span style="color: #80a880;">)</span> 0<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>has-value? m2<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>= <span style="color: #80a880;">(</span>get-value m2<span style="color: #80a880;">)</span> 0<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-value! product 0 me<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>has-value? m1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>has-value? m2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-value! product
                       <span style="color: #6276ba;">(</span>* <span style="color: #858580;">(</span>get-value m1<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>get-value m2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                       me<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>has-value? product<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>has-value? m1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-value! m2
                       <span style="color: #6276ba;">(</span>/ <span style="color: #858580;">(</span>get-value product<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>get-value m1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                       me<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>has-value? product<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>has-value? m2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>set-value! m1
                       <span style="color: #6276ba;">(</span>/ <span style="color: #858580;">(</span>get-value product<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>get-value m2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                       me<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">process-forget-value</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>forget-value! product me<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>forget-value! m1 me<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>forget-value! m2 me<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>process-new-value<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">me</span> request<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? request 'I-have-a-value<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>process-new-value<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? request 'I-lost-my-value<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>process-forget-value<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Unknown request -- MULTIPLIER"</span> request<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect m1 me<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect m2 me<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect product me<span style="color: #7388d6;">)</span>
  me<span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Constrain connector to a constant</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">constant</span> value connector<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">me</span> request<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"Unknown request -- CONSTANT"</span> request<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect connector me<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>set-value! connector value me<span style="color: #7388d6;">)</span>
  me<span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Print a message about setting or unsetting of a connector (e.g., for</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">testing).</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">probe</span> name connector<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">print-probe</span> value<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>display <span style="color: #8b2252;">"Probe: "</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>display name<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>display <span style="color: #8b2252;">" = "</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>display value<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>newline<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">process-new-value</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>print-probe <span style="color: #709870;">(</span>get-value connector<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">process-forget-value</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>print-probe <span style="color: #8b2252;">"?"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">me</span> request<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? request 'I-have-a-value<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>process-new-value<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? request 'I-lost-my-value<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>process-forget-value<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Unknown request -- PROBE"</span> request<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>connect connector me<span style="color: #7388d6;">)</span>
  me<span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-5">
<h5 id="orgheadline47"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.33">Exercise 3.33.</a></h5>
<div class="outline-text-5" id="text-orgheadline47">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">averager</span> a b c<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>half <span style="color: #907373;">(</span>make-connector<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>sum <span style="color: #907373;">(</span>make-connector<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>constant 0.5 half<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>adder a b sum<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>multiplier half sum c<span style="color: #909183;">)</span>
    'ok<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-5">
<h5 id="orgheadline48"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.34">Exercise 3.34.</a></h5>
<div class="outline-text-5" id="text-orgheadline48">
<p>
The procedure suggested by Louis won't work when propagation from the
product to the multiplicands is needed. <code>multiplier</code> needs at least two of
<code>m1</code>, <code>m2</code>, and <code>product</code> to be set in order to propagate the constraint from
the set values to the unset value. However, if one of the multiplicands is
unset, both are, a situation that <code>multiplier</code> can't handle.
</p>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-5">
<h5 id="orgheadline49"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.35">Exercise 3.35.</a></h5>
<div class="outline-text-5" id="text-orgheadline49">
<p>
Straightforward implementation based on <code>multiplier</code>:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">squarer</span> a b<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">process-new-value</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>has-value? b<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>&lt; <span style="color: #6276ba;">(</span>get-value b<span style="color: #6276ba;">)</span> 0<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"square less than 0 -- SQUARER"</span> <span style="color: #6276ba;">(</span>get-value b<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>set-value! a <span style="color: #6276ba;">(</span>sqrt b<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>aval <span style="color: #858580;">(</span>get-value a<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>set-value! b <span style="color: #6276ba;">(</span>* aval aval<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">process-forget-value</span><span style="color: #709870;">)</span>
    <span style="color: #709870;">(</span>forget-value! b me<span style="color: #709870;">)</span>
    <span style="color: #709870;">(</span>forget-value! a me<span style="color: #709870;">)</span>
    <span style="color: #709870;">(</span>process-new-value<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">me</span> request<span style="color: #709870;">)</span>
    <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? request 'I-have-a-value<span style="color: #6276ba;">)</span>
           <span style="color: #6276ba;">(</span>process-new-value<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? request 'I-lost-my-value<span style="color: #6276ba;">)</span>
           <span style="color: #6276ba;">(</span>process-forget-value<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"Unknown request -- SQUARER"</span> request<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>connect a me<span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>connect b me<span style="color: #909183;">)</span>
  me<span style="color: #7388d6;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-5">
<h5 id="orgheadline50"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.36">Exercise 3.36.</a></h5>
<div class="outline-text-5" id="text-orgheadline50">
<p>
Do in class.
</p>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-5">
<h5 id="orgheadline51"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-22.html#%_thm_3.37">Exercise 3.37.</a></h5>
<div class="outline-text-5" id="text-orgheadline51">
<p>
The expression-oriented constraint adder is defined thus in the book:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock6"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">c+</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>z <span style="color: #907373;">(</span>make-connector<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>adder x y z<span style="color: #909183;">)</span>
    z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
We define similar procedures for subtraction, multiplication, division, and
constant values:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"constraint-common"</span><span style="color: #707183;">)</span>

<span style="color: #228b22;">&lt;&lt;constraint-adder-expression&gt;&gt;</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Constant</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cv</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>z <span style="color: #907373;">(</span>make-connector<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>constant x z<span style="color: #909183;">)</span>
    z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Subtraction</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">c-</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">$x - y = z \Rightarrow x = y + z$ to avoid having to introduce an</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">additional multiplier and constant constraint.</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>z <span style="color: #907373;">(</span>make-connector<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>adder y z x<span style="color: #909183;">)</span>
    z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Multiplication</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">c*</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>z <span style="color: #907373;">(</span>make-connector<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>multiplier x y z<span style="color: #909183;">)</span>
    z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Division</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">c/</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">$x / y = z \Rightarrow x = y * z$ to avoid having to implement division as</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">a primitive constraint. Pray that $y \neq 0$.</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>z <span style="color: #907373;">(</span>make-connector<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>multiplier y z x<span style="color: #909183;">)</span>
    z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline68" class="outline-3">
<h3 id="orgheadline68"><span class="todo TODO">TODO</span> 3.4: Concurrency: Time Is of the Essence</h3>
<div class="outline-text-3" id="text-orgheadline68">
</div><div id="outline-container-orgheadline53" class="outline-4">
<h4 id="orgheadline53"><span class="done DONE">DONE</span> Read Section 3.4</h4>
<div class="outline-text-4" id="text-orgheadline53">
<ul class="org-ul">
<li>State "DONE"       from "STARTED"    <span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat 15:07]</span></span></li>
</ul>
<ul class="org-ul">
<li>State "STARTED"    from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat 14:42]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat]</span></span>
</p>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="todo TODO">TODO</span> 3.4.1: The Nature of Time in Concurrent Systems</h4>
<div class="outline-text-4" id="text-orgheadline54">
<p>
Complexity of concurrent systems comes from:
</p>

<ul class="org-ul">
<li>Dependence of ordering of events in a system with mutation.</li>
<li>Reduced ability to control ordering of events, and difficulty in mentally
taking this into account.</li>
</ul>

<p>
Concurrency models:
</p>

<ul class="org-ul">
<li>No two operations on any shared state variable can occur at the same
time. Too strict for most uses (for example, implies that only one
transaction can occur at a time in a bank system).</li>
<li>System must proceed as if events had been executed sequentially in <i>some</i>
  order (not guaranteed what order is used).
<ul class="org-ul">
<li><p>
There can still be more than one "correct" answer &#x2013; may need to restrict
some parts of the program further depending on requirements.
</p>

<ul class="org-ul">
<li>State "STARTED"    from "STARTED"    <span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat 16:41] </span></span> <br  /></li>
<li>State "STARTED"    from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat 14:26]</span></span>
     Want SRFI-18 to support concurrency.</li>
</ul>
<p>
:Effort:   0:30
</p>
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat]</span></span>
</p></li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgheadline55" class="outline-5">
<h5 id="orgheadline55"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.38">Exercise 3.38.</a></h5>
<div class="outline-text-5" id="text-orgheadline55">
<ol class="org-ol">
<li><p>
There are 6 combinations of Peter (A), Paul (B), and Mary (C):
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Order</th>
<th scope="col" class="org-right">Final amount</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">(A, B, C)</td>
<td class="org-right">45</td>
</tr>

<tr>
<td class="org-left">(A, C, B)</td>
<td class="org-right">35</td>
</tr>

<tr>
<td class="org-left">(B, A, C)</td>
<td class="org-right">45</td>
</tr>

<tr>
<td class="org-left">(B, C, A)</td>
<td class="org-right">50</td>
</tr>

<tr>
<td class="org-left">(C, A, B)</td>
<td class="org-right">40</td>
</tr>

<tr>
<td class="org-left">(C, B, A)</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table></li>

<li><p>
For transactions A and B, there are 3 steps:
</p>

<ul class="org-ul">
<li>Read the current balance from the shared account [Xr].</li>
<li>Perform the calculation.</li>
<li>Write the new balance to the shared account [Xw].</li>
</ul>
<p>
However, transaction C reads the shared variable <code>balance</code> twice, so there
are 5 steps:
</p>

<ul class="org-ul">
<li>Read the current balance from the shared account [Cr1].</li>
<li>Perform the division.</li>
<li>Read the current balance from the shared account [Cr2].</li>
<li>Perform the subtraction.</li>
<li>Write the new balance to the shared account [Cw].</li>
</ul>
<p>
The calculations don't modify a shared variable, so the relevant
combinations for each transaction are combinations of Ar, Aw, Br, Bw, Cr1,
Cr2, and Cw, with the constraint that \(t(Ar) \leq t(Aw)\),
\(t(Br) \leq t(Bw)\), and \(t(Cr1) \leq t(Cr2) \leq t(Cw)\) or
\(t(Cr2) \leq t(Cr1) \leq t(Cw)\).
</p></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-4">
<h4 id="orgheadline56"><span class="todo TODO">TODO</span> 3.4.2: Mechanisms for Controlling Concurrency</h4>
<div class="outline-text-4" id="text-orgheadline56">
<p>
There are too many possible orderings of concurrent processes to ensure a
single answer or to analyze in many cases.
</p>

<p>
Serializer:
</p>
<ul class="org-ul">
<li>Ensures that only one procedure under the control of the serializer can be
executed at a time.</li>
<li><p>
Example: In the below, <code>foo</code> and <code>bar</code> are guaranteed to not execute at the
same time (i.e., their execution is <i>serialized</i>).
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">s</span> <span style="color: #7388d6;">(</span>make-serializer<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>parallel-execute <span style="color: #7388d6;">(</span>s <span style="color: #909183;">(</span>foo<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
                  <span style="color: #7388d6;">(</span>s <span style="color: #909183;">(</span>bar<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li>Implemented in terms of <i>mutexes</i>.</li>
<li>Mutex implemented as a spin lock using a test-and-set instruction.</li>
</ul>

<p>
Here's an implementation of the threading tools <code>parallel-execute</code> and
<code>make-serializer</code> using SRFI-18 mutexes and threads:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> srfi-18<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-serializer</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>mutex <span style="color: #907373;">(</span>make-mutex<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">define</span> <span style="color: #907373;">(</span><span style="color: #0000ff;">serialized-p</span> . args<span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>mutex-lock! mutex<span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>val <span style="color: #80a880;">(</span>apply p args<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span>mutex-unlock! mutex<span style="color: #6276ba;">)</span>
          val<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      serialized-p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">parallel-execute</span> . fs<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>ts <span style="color: #907373;">(</span><span style="color: #a020f0;">map</span> make-thread fs<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">for-each</span> thread-start! ts<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">for-each</span> thread-join! ts<span style="color: #909183;">)</span>
    '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>State "HOLD"       from "STARTED"    <span class="timestamp-wrapper"><span class="timestamp">[2014-12-10 Wed 19:54] </span></span> <br  />
Do at some point</li>
</ul>
<ul class="org-ul">
<li>State "STARTED"    from "STARTED"    <span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat 17:31] </span></span> <br  />
Implemented those two functions.</li>
</ul>
<ul class="org-ul">
<li>State "STARTED"    from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat 17:11]</span></span></li>
</ul>
<p>
Need to implement <code>make-serializer</code> and perhaps <code>parallel-execute</code>.
</p>
<p>
:Effort:   3:00
</p>
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat]</span></span>
</p>
</div>

<div id="outline-container-orgheadline57" class="outline-5">
<h5 id="orgheadline57"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.39">Exercise 3.39.</a></h5>
</div>
<div id="outline-container-orgheadline58" class="outline-5">
<h5 id="orgheadline58"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.40">Exercise 3.40.</a></h5>
</div>
<div id="outline-container-orgheadline59" class="outline-5">
<h5 id="orgheadline59"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.41">Exercise 3.41.</a></h5>
</div>
<div id="outline-container-orgheadline60" class="outline-5">
<h5 id="orgheadline60"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.42">Exercise 3.42.</a></h5>
</div>
<div id="outline-container-orgheadline61" class="outline-5">
<h5 id="orgheadline61"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.43">Exercise 3.43.</a></h5>
</div>
<div id="outline-container-orgheadline62" class="outline-5">
<h5 id="orgheadline62"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.44">Exercise 3.44.</a></h5>
</div>
<div id="outline-container-orgheadline63" class="outline-5">
<h5 id="orgheadline63"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.45">Exercise 3.45.</a></h5>
</div>
<div id="outline-container-orgheadline64" class="outline-5">
<h5 id="orgheadline64"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.46">Exercise 3.46.</a></h5>
</div>
<div id="outline-container-orgheadline65" class="outline-5">
<h5 id="orgheadline65"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.47">Exercise 3.47.</a></h5>
</div>
<div id="outline-container-orgheadline66" class="outline-5">
<h5 id="orgheadline66"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.48">Exercise 3.48.</a></h5>
</div>
<div id="outline-container-orgheadline67" class="outline-5">
<h5 id="orgheadline67"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-23.html#%_thm_3.49">Exercise 3.49.</a></h5>
</div>
</div>
</div>

<div id="outline-container-orgheadline69" class="outline-3">
<h3 id="orgheadline69"><span class="todo TODO">TODO</span> 3.5: Streams</h3>
<div class="outline-text-3" id="text-orgheadline69">
<p>
Basic stream procedures used throughout the section.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #228b22;">&lt;&lt;stream-primitives&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;stream-fold&gt;&gt;</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-ref</span> s n<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>= n 0<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>stream-car s<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>stream-ref <span style="color: #709870;">(</span>stream-cdr s<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>- n 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;stream-map-poly&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-for-each</span> proc s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>stream-null? s<span style="color: #909183;">)</span>
      'done
      <span style="color: #909183;">(</span><span style="color: #a020f0;">begin</span> <span style="color: #709870;">(</span>proc <span style="color: #907373;">(</span>stream-car s<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
             <span style="color: #709870;">(</span>stream-for-each proc <span style="color: #907373;">(</span>stream-cdr s<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-filter</span> proc s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>stream-null? s<span style="color: #709870;">)</span> the-empty-stream<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>proc <span style="color: #907373;">(</span>stream-car s<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>cons-stream <span style="color: #907373;">(</span>stream-car s<span style="color: #907373;">)</span>
                      <span style="color: #907373;">(</span>stream-filter proc <span style="color: #6276ba;">(</span>stream-cdr s<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span>stream-filter proc <span style="color: #907373;">(</span>stream-cdr s<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">display-line</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>newline<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>display x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">display-stream</span> s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>stream-for-each display-line s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-enumerate-interval</span> low high<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>&gt; low high<span style="color: #909183;">)</span>
      the-empty-stream
      <span style="color: #909183;">(</span>cons-stream
       low
       <span style="color: #709870;">(</span>stream-enumerate-interval <span style="color: #907373;">(</span>+ low 1<span style="color: #907373;">)</span> high<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
We start with the primitive procedures on the stream data type:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock7"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">the-empty-stream</span> 'the-empty-stream<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-null?</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>eq? s the-empty-stream<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define-syntax</span> <span style="color: #a0522d;">cons-stream</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">syntax-rules</span> <span style="color: #909183;">()</span>
    <span style="color: #909183;">(</span><span style="color: #709870;">(</span>cons-stream a b<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>cons a <span style="color: #907373;">(</span><span style="color: #a020f0;">delay</span> b<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-car</span> stream<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car stream<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-cdr</span> stream<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">force</span> <span style="color: #909183;">(</span>cdr stream<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Another very useful and generally-applicable stream function is <code>fold</code>. In
fact, both <code>map</code> and <code>filter</code> can be implemented in terms of <code>fold</code>:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock8"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-fold</span> kons knil . streams<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">or</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">map</span> stream-null? streams<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      knil
      <span style="color: #909183;">(</span>cons-stream <span style="color: #709870;">(</span>apply kons <span style="color: #907373;">(</span>append <span style="color: #6276ba;">(</span><span style="color: #a020f0;">map</span> stream-car streams<span style="color: #6276ba;">)</span>
                                       knil<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>apply stream-fold kons knil <span style="color: #907373;">(</span><span style="color: #a020f0;">map</span> stream-cdr streams<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline73" class="outline-4">
<h4 id="orgheadline73"><span class="done DONE">DONE</span> 3.5.1: Streams Are Delayed Lists</h4>
<div class="outline-text-4" id="text-orgheadline73">
</div><div id="outline-container-orgheadline70" class="outline-5">
<h5 id="orgheadline70"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.50">Exercise 3.50.</a></h5>
<div class="outline-text-5" id="text-orgheadline70">
<p>
The <code>apply</code> procedure can be used to call a function with arguments drawn from
a list, and we can iterate along the argument streams in turn (which are all
assumed to be of the same length):
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock9"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-map</span> proc . argstreams<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>stream-null? <span style="color: #709870;">(</span>car argstreams<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      the-empty-stream
      <span style="color: #909183;">(</span>cons-stream
       <span style="color: #709870;">(</span>apply proc <span style="color: #907373;">(</span><span style="color: #a020f0;">map</span> stream-car argstreams<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
       <span style="color: #709870;">(</span>apply stream-map
              <span style="color: #907373;">(</span>cons proc <span style="color: #6276ba;">(</span><span style="color: #a020f0;">map</span> stream-cdr argstreams<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline71" class="outline-5">
<h5 id="orgheadline71"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.51">Exercise 3.51.</a></h5>
<div class="outline-text-5" id="text-orgheadline71">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">show</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>display-line x<span style="color: #7388d6;">)</span> x<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> <span style="color: #7388d6;">(</span>stream-map show <span style="color: #909183;">(</span>stream-enumerate-interval 0 10<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>stream-ref x 5<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>stream-ref x 7<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline72" class="outline-5">
<h5 id="orgheadline72"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.52">Exercise 3.52.</a></h5>
<div class="outline-text-5" id="text-orgheadline72">
<p>
We have these definitions, which in particular include a mutating procedure
<code>accum</code>:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">sum</span> 0<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">accum</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">set!</span> sum <span style="color: #909183;">(</span>+ x sum<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  sum<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">seq</span> <span style="color: #7388d6;">(</span>stream-map accum <span style="color: #909183;">(</span>stream-enumerate-interval 1 20<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">y</span> <span style="color: #7388d6;">(</span>stream-filter even? seq<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">z</span> <span style="color: #7388d6;">(</span>stream-filter <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>= <span style="color: #907373;">(</span>remainder x 5<span style="color: #907373;">)</span> 0<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                         seq<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #228b22;">&lt;&lt;ex-3-52-eval-y&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-3-52-eval-z&gt;&gt;</span>
</pre>
</div>

<p>
First, we obtain the 7<sup>th</sup> element of <code>y</code>, which is the 14<sup>th</sup> element of <code>seq</code>,
obtaining the expected result of \( \sum_{i=1}^{14} i = 136 \):
</p>
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock10"><span style="color: #707183;">(</span>stream-ref y 7<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 136
      sum<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Next, we look at <code>z</code>, which should contain only those entries of <code>seq</code>
divisible by <code>5</code>. Since \( \sum_{i=1}^{n} i = \frac{n(n + 1)}{2} \), we expect
that both every \(i\)<sup>th</sup> entry and \(i-1\)<sup>th</sup> entry of
<code>(stream-enumerate-interval 1 20)</code> should produce a corresponding entry in <code>z</code>,
and this is what we indeed observe, finally obtaining <code>(= sum 210)</code>.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock11"><span style="color: #707183;">(</span>display-stream z<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 210
      sum<span style="color: #707183;">)</span>
</pre>
</div>

<p>
However, if <code>delay</code> did not cache its results, the mutation in <code>accum</code> would
cause a different result to be obtained for <code>z</code> (but not for <code>y</code>, since it was
the first evaluated). The execution of <code>y</code> would have gone through the first 14
integers, as before, giving <code>(= sum 136)</code>. The values of <code>seq</code> when <code>z</code> was
executed would therefore all be increased by 136, producing a different stream
for <code>z</code> and a final sum of \(136 + 210 = 346\).
</p>


<p>
:Effort:   1:00
</p>
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat]</span></span>
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74"><span class="todo TODO">TODO</span> 3.5.2: Infinite Streams</h4>
<div class="outline-text-4" id="text-orgheadline74">
<p>
The book defines several miscellaneous procedures that are useful for exercises
in this section:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">integers-starting-from</span> n<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons-stream n <span style="color: #909183;">(</span>integers-starting-from <span style="color: #709870;">(</span>+ n 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">integers</span> <span style="color: #7388d6;">(</span>integers-starting-from 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">add-streams</span> s1 s2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>stream-map + s1 s2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scale-stream</span> stream factor<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>stream-map <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>* x factor<span style="color: #709870;">)</span><span style="color: #909183;">)</span> stream<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #228b22;">&lt;&lt;stream-partial-sums&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;stream-pairs&gt;&gt;</span>
</pre>
</div>

<p>
:Effort:   3:00
</p>
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2014-11-22 Sat]</span></span>
</p>
</div>

<div id="outline-container-orgheadline75" class="outline-5">
<h5 id="orgheadline75"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.53">Exercise 3.53.</a></h5>
<div class="outline-text-5" id="text-orgheadline75">
<p>
This produces a stream consisting of the powers of 2: <code>1 2 4 8 16 ...</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline76" class="outline-5">
<h5 id="orgheadline76"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.54">Exercise 3.54.</a></h5>
<div class="outline-text-5" id="text-orgheadline76">
<div class="org-src-container">

<pre class="src src-scheme"></pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline77" class="outline-5">
<h5 id="orgheadline77"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.55">Exercise 3.55.</a></h5>
<div class="outline-text-5" id="text-orgheadline77">
<p>
In order to calculate the partial sum corresponding to an element in the input
stream, you need two pieces of information: the partial sum of the elements
before this one and the element itself. This is most easily done using
recursion. The recursive function call tracks in its parameters the partial sum
of the preceding elements and the start of the remaining input stream and
returns the entire output stream.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock12"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">partial-sums</span> s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">rec</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>partial-sum 0<span style="color: #709870;">)</span>
            <span style="color: #709870;">(</span>s s<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>stream-null? s<span style="color: #709870;">)</span>
        the-empty-stream
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>new-sum <span style="color: #858580;">(</span>+ partial-sum <span style="color: #80a880;">(</span>stream-car s<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>cons-stream new-sum
                       <span style="color: #6276ba;">(</span>rec new-sum <span style="color: #858580;">(</span>stream-cdr s<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test 15
      <span style="color: #7388d6;">(</span>stream-ref <span style="color: #909183;">(</span>partial-sums integers<span style="color: #909183;">)</span> 4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline78" class="outline-5">
<h5 id="orgheadline78"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.56">Exercise 3.56.</a></h5>
<div class="outline-text-5" id="text-orgheadline78">
<p>
The <code>merge</code> procedure combines two streams ordered in ascending order,
eliminating repetitions:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock13"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">merge</span> s1 s2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>stream-null? s1<span style="color: #709870;">)</span> s2<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>stream-null? s2<span style="color: #709870;">)</span> s1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>s1car <span style="color: #858580;">(</span>stream-car s1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span>s2car <span style="color: #858580;">(</span>stream-car s2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>&lt; s1car s2car<span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>cons-stream s1car <span style="color: #80a880;">(</span>merge <span style="color: #887070;">(</span>stream-cdr s1<span style="color: #887070;">)</span> s2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>&gt; s1car s2car<span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>cons-stream s2car <span style="color: #80a880;">(</span>merge s1 <span style="color: #887070;">(</span>stream-cdr s2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span>
                  <span style="color: #858580;">(</span>cons-stream s1car
                               <span style="color: #80a880;">(</span>merge <span style="color: #887070;">(</span>stream-cdr s1<span style="color: #887070;">)</span>
                                      <span style="color: #887070;">(</span>stream-cdr s2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Given this, we can create <code>S</code>, the list of integers with no prime factors but
2, 3, and 5:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;stream-merge&gt;&gt;</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">S</span> <span style="color: #7388d6;">(</span>cons-stream 1 <span style="color: #909183;">(</span>merge <span style="color: #709870;">(</span>scale-stream S 2<span style="color: #709870;">)</span>
                                <span style="color: #709870;">(</span>merge <span style="color: #907373;">(</span>scale-stream S 3<span style="color: #907373;">)</span>
                                       <span style="color: #907373;">(</span>scale-stream S 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-5">
<h5 id="orgheadline79"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.57">Exercise 3.57.</a></h5>
</div>
<div id="outline-container-orgheadline80" class="outline-5">
<h5 id="orgheadline80"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.58">Exercise 3.58.</a></h5>
</div>
<div id="outline-container-orgheadline81" class="outline-5">
<h5 id="orgheadline81"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.59">Exercise 3.59.</a></h5>
</div>
<div id="outline-container-orgheadline82" class="outline-5">
<h5 id="orgheadline82"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.60">Exercise 3.60.</a></h5>
</div>
<div id="outline-container-orgheadline83" class="outline-5">
<h5 id="orgheadline83"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.61">Exercise 3.61.</a></h5>
</div>
<div id="outline-container-orgheadline84" class="outline-5">
<h5 id="orgheadline84"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.62">Exercise 3.62.</a></h5>
</div>
</div>
<div id="outline-container-orgheadline85" class="outline-4">
<h4 id="orgheadline85"><span class="todo TODO">TODO</span> 3.5.3: Exploiting the Stream Paradigm</h4>
<div class="outline-text-4" id="text-orgheadline85">
<p>
For convenience:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock14"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">interleave</span> s1 s2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>stream-null? s1<span style="color: #909183;">)</span>
      s2
      <span style="color: #909183;">(</span>cons-stream <span style="color: #709870;">(</span>stream-car s1<span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>interleave s2 <span style="color: #907373;">(</span>stream-cdr s1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">pairs</span> s t<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons-stream
   <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>stream-car s<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>stream-car t<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>interleave
    <span style="color: #709870;">(</span>stream-map <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>list <span style="color: #858580;">(</span>stream-car s<span style="color: #858580;">)</span> x<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">(</span>stream-cdr t<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #709870;">(</span>pairs <span style="color: #907373;">(</span>stream-cdr s<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>stream-cdr t<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline86" class="outline-5">
<h5 id="orgheadline86"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.63">Exercise 3.63.</a></h5>
<div class="outline-text-5" id="text-orgheadline86">
<p>
<b>TODO</b>: Explain better.
</p>

<p>
First, note that both procedures are inefficient without memoization, because
<code>guesses</code> has to be evaluated always in Alyssa's version as well. However, with
memoization, the <code>guesses</code> variable is bound in the environment of
<code>sqrt-stream</code>, so the delayed cdr of the stream returned by <code>cons-stream</code> is
memoized after the first call.
</p>
</div>
</div>

<div id="outline-container-orgheadline87" class="outline-5">
<h5 id="orgheadline87"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.64">Exercise 3.64.</a></h5>
<div class="outline-text-5" id="text-orgheadline87">
<p>
A straightforward recursive procedure:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-limit</span> stream tol<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">rec</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>stream stream<span style="color: #709870;">)</span>
            <span style="color: #709870;">(</span>previous +inf<span style="color: #709870;">)</span><span style="color: #909183;">)</span>  <span style="color: #b22222;">; </span><span style="color: #b22222;">+INF is IEEE-754 positive infinity</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>stream-null? stream<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"STREAM-LIMIT - stream exhausted without tolerance achieved"</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>current <span style="color: #858580;">(</span>stream-car stream<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span>rest <span style="color: #858580;">(</span>stream-cdr stream<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>&lt; <span style="color: #858580;">(</span>abs <span style="color: #80a880;">(</span>- previous current<span style="color: #80a880;">)</span><span style="color: #858580;">)</span> tol<span style="color: #6276ba;">)</span>
              current
              <span style="color: #6276ba;">(</span>rec rest current<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline88" class="outline-5">
<h5 id="orgheadline88"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.65">Exercise 3.65.</a></h5>
<div class="outline-text-5" id="text-orgheadline88">
<p>
This is the original sequence:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock15"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">ln2-summands</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons-stream 1.0
               <span style="color: #909183;">(</span>stream-map <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>k<span style="color: #907373;">)</span>
                             <span style="color: #907373;">(</span>* <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span>even? k<span style="color: #858580;">)</span> -1.0 1.0<span style="color: #6276ba;">)</span>
                                <span style="color: #6276ba;">(</span>/ 1.0 k<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                           <span style="color: #709870;">(</span>integers-starting-from 2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">ln2-stream</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>partial-sums <span style="color: #909183;">(</span>ln2-summands<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
In order to accelerate the \(\ln{2}\) sequence, we use the Euler transform from
this subsection:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock16"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-tableau</span> transform s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons-stream s
               <span style="color: #909183;">(</span>make-tableau transform
                             <span style="color: #709870;">(</span>transform s<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">accelerated-sequence</span> transform s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>stream-map stream-car
              <span style="color: #909183;">(</span>make-tableau transform s<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">square</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>* x x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">euler-transform</span> s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>s0 <span style="color: #907373;">(</span>stream-ref s 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span>           <span style="color: #b22222;">; </span><span style="color: #b22222;">S_{n-1}</span>
        <span style="color: #709870;">(</span>s1 <span style="color: #907373;">(</span>stream-ref s 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span>           <span style="color: #b22222;">; </span><span style="color: #b22222;">S_{n}</span>
        <span style="color: #709870;">(</span>s2 <span style="color: #907373;">(</span>stream-ref s 2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>          <span style="color: #b22222;">; </span><span style="color: #b22222;">S_{n+1}</span>
    <span style="color: #909183;">(</span>cons-stream <span style="color: #709870;">(</span>- s2 <span style="color: #907373;">(</span>/ <span style="color: #6276ba;">(</span>square <span style="color: #858580;">(</span>- s2 s1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                          <span style="color: #6276ba;">(</span>+ s0 <span style="color: #858580;">(</span>* -2 s1<span style="color: #858580;">)</span> s2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                 <span style="color: #709870;">(</span>euler-transform <span style="color: #907373;">(</span>stream-cdr s<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
We put the sequence and the transform in the same file for ease of testing:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #228b22;">&lt;&lt;stream-euler-transform&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ln2-stream&gt;&gt;</span>
</pre>
</div>

<p>
With that, we can calculate the convergence of the original sequence as well as
its acceleration one and two times. As expected, the more accelerated sequences
converge much faster&#x2014;while the original sequence has not converged even after
hundreds of iterations, it only takes 10 iterations for the first accelerated
sequence to converge to the limits of floating-point accuracy, and 5 iterations
for the second accelerated sequence.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-65"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">orig</span> <span style="color: #7388d6;">(</span>ln2-stream<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">acc1</span> <span style="color: #7388d6;">(</span>accelerated-sequence euler-transform orig<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">acc2</span> <span style="color: #7388d6;">(</span>accelerated-sequence euler-transform acc1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline89" class="outline-5">
<h5 id="orgheadline89"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.66">Exercise 3.66.</a></h5>
<div class="outline-text-5" id="text-orgheadline89">
<p>
Here are the first twenty pairs:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test <span style="color: #7388d6;">(</span><span style="color: #a020f0;">map</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>i<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>stream-ref <span style="color: #907373;">(</span>pairs integers integers<span style="color: #907373;">)</span> i<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
           <span style="color: #909183;">(</span>iota 20<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
      '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>1 1<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>2 2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 3<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>2 3<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 4<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>3 3<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 5<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>2 4<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 6<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>3 4<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 7<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>2 5<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 8<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>4 4<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 9<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>2 6<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 10<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>3 5<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>1 11<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Notice that two streams seem to be interleaved:
</p>

<ul class="org-ul">
<li>A stream of pairs <code>(1 k)</code> in the second, fourth, etc. positions; i.e., where
\(i\) is odd (starting from \(0\)). More
precisely, if <code>(odd? i)</code>, <code>(stream-ref pairs-stream i)</code> is
<code>(+ 1 (quotient (- i 1) 2))</code>.</li>
<li>A stream of pairs where all pairs that sum to \(n\) are generated before those
that sum to \(n + 1\). In these pairs, \(i\) decreases from \(\lfloor n / 2 \rfloor\) to \(2\),
since \(i = 1\) is already taken.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline90" class="outline-5">
<h5 id="orgheadline90"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.67">Exercise 3.67.</a></h5>
<div class="outline-text-5" id="text-orgheadline90">
<p>
We proceed by induction. Consider the case where all pairs \((S_{k < i}, T_{j})\)
have been generated. Then the stream to generate consists of the following
three parts:
</p>

<ul class="org-ul">
<li>The single element \((S_{i}, T_{0})\).</li>
<li>The pairs of \(S_{i}\) with the rest of the elements in \(T\): \((S_{i}, T_{j > 0})\).</li>
<li>The pairs the remaining elements of \(S\) with everything: \((S_{k > i}, T_{j})\).</li>
</ul>

<p>
The pair \((S_{0}, T_{0})\) is obviously in the stream to be generated, so our
construction in fact does produce all the pairs \((S_{i}, T_{j})\). The Scheme
implementation below straightforwardly generates these three parts of the
stream (see the comments):
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">both-pairs</span> s t<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons-stream
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">(S_{i}, T_{0})</span>
   <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>stream-car s<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>stream-car t<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>interleave
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(S_{i}, T_{j &gt; 0})</span>
    <span style="color: #709870;">(</span>stream-map <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>list <span style="color: #858580;">(</span>stream-car s<span style="color: #858580;">)</span> x<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">(</span>stream-cdr t<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(S_{k &gt; i}, T_{j})</span>
    <span style="color: #709870;">(</span>both-pairs <span style="color: #907373;">(</span>stream-cdr s<span style="color: #907373;">)</span> t<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-67"</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline91" class="outline-5">
<h5 id="orgheadline91"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.68">Exercise 3.68.</a></h5>
<div class="outline-text-5" id="text-orgheadline91">
<p>
This does not work&#x2014;it generates the list \((S_{i}, T_{j}), i \leq j\).
</p>
</div>
</div>

<div id="outline-container-orgheadline92" class="outline-5">
<h5 id="orgheadline92"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.69">Exercise 3.69.</a></h5>
<div class="outline-text-5" id="text-orgheadline92">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">triples</span> s t u<span style="color: #7388d6;">)</span>
  <span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-5">
<h5 id="orgheadline93"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.70">Exercise 3.70.</a></h5>
<div class="outline-text-5" id="text-orgheadline93">
<p>
Here, we want to construct a list of all pairs \((S_{i}, T_{j})\) just as in Exercise
3.67, but we want to make sure that instead of interleaving streams one after
the other, we interleave according to whichever stream has a first element with
a smaller weight.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">merge-weighted</span> s1 s2 weight<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">recur</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>s1 s1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>s2 s2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>stream-null? s1<span style="color: #907373;">)</span> s2<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>stream-null? s2<span style="color: #907373;">)</span> s1<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>s1car <span style="color: #80a880;">(</span>stream-car s1<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>s2car <span style="color: #80a880;">(</span>stream-car s2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>w <span style="color: #80a880;">(</span>weight s1car s2car<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>wrev <span style="color: #80a880;">(</span>weight s2car s1car<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>&lt; w wrev<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>cons-stream s1car <span style="color: #887070;">(</span>recur <span style="color: #707183;">(</span>stream-cdr s1<span style="color: #707183;">)</span> s2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>&gt; w wrev<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>cons-stream s2car <span style="color: #887070;">(</span>recur s1 <span style="color: #707183;">(</span>stream-cdr s2<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span><span style="color: #a020f0;">else</span>
                    <span style="color: #80a880;">(</span>cons-stream s1car
                                 <span style="color: #887070;">(</span>recur <span style="color: #707183;">(</span>stream-cdr s1<span style="color: #707183;">)</span>
                                        <span style="color: #707183;">(</span>stream-cdr s2<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">weighted-pairs</span> s t weight<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons-stream
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">(S_{i}, T_{0})</span>
   <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>stream-car s<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>stream-car t<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>merge-weighted
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(S_{i}, T_{j &gt; 0})</span>
    <span style="color: #709870;">(</span>stream-map <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>list <span style="color: #858580;">(</span>stream-car s<span style="color: #858580;">)</span> x<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">(</span>stream-cdr t<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(S_{k &gt; i}, T_{j})</span>
    <span style="color: #709870;">(</span>both-pairs <span style="color: #907373;">(</span>stream-cdr s<span style="color: #907373;">)</span> t<span style="color: #709870;">)</span>
    weight<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Now we can compute:
</p>

<ol class="org-ol">
<li><p>
the stream of all pairs of positive integers \((i, j)\) with \((i \leq j)\)
   ordered according to the sum \(i + j\):
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-70"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">stream-a</span> <span style="color: #7388d6;">(</span>weighted-pairs integers integers &lt;<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">stream-b</span>
  <span style="color: #7388d6;">(</span>stream-filter <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p<span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>apply or
                               <span style="color: #6276ba;">(</span><span style="color: #a020f0;">map</span> <span style="color: #858580;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #80a880;">(</span>q<span style="color: #80a880;">)</span>
                                      <span style="color: #80a880;">(</span>= 0 <span style="color: #887070;">(</span>remainder p q<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                                    '<span style="color: #858580;">(</span>2 3 5<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                 <span style="color: #909183;">(</span>weighted-pairs integers integers
                                 <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>i j<span style="color: #907373;">)</span>
                                   <span style="color: #907373;">(</span>+ <span style="color: #6276ba;">(</span>* 2 i<span style="color: #6276ba;">)</span>
                                      <span style="color: #6276ba;">(</span>* 3 j<span style="color: #6276ba;">)</span>
                                      <span style="color: #6276ba;">(</span>* 5 i j<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline94" class="outline-5">
<h5 id="orgheadline94"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.71">Exercise 3.71.</a></h5>
</div>
<div id="outline-container-orgheadline95" class="outline-5">
<h5 id="orgheadline95"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.72">Exercise 3.72.</a></h5>
</div>
<div id="outline-container-orgheadline96" class="outline-5">
<h5 id="orgheadline96"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.73">Exercise 3.73.</a></h5>
<div class="outline-text-5" id="text-orgheadline96">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">integral</span> integrand initial-value dt<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">int</span>
    <span style="color: #909183;">(</span>cons-stream initial-value
                 <span style="color: #709870;">(</span>add-streams <span style="color: #907373;">(</span>scale-stream integrand dt<span style="color: #907373;">)</span>
                              int<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  int<span style="color: #707183;">)</span>
</pre>
</div>


<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">RC</span> R C dt<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">circuit</span> i v0<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>add-streams <span style="color: #709870;">(</span>scale-stream i R<span style="color: #709870;">)</span>
                 <span style="color: #709870;">(</span>integral <span style="color: #907373;">(</span>scale-stream i <span style="color: #6276ba;">(</span>/ 1.0 C<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> v0<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  circuit<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline97" class="outline-5">
<h5 id="orgheadline97"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.74">Exercise 3.74.</a></h5>
<div class="outline-text-5" id="text-orgheadline97">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">zero-crossings</span>
  <span style="color: #7388d6;">(</span>stream-map sign-change-detector
              sense-data
              <span style="color: #909183;">(</span>stream-cdr sense-data<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline98" class="outline-5">
<h5 id="orgheadline98"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.75">Exercise 3.75.</a></h5>
<div class="outline-text-5" id="text-orgheadline98">
<p>
Alyssa wants to run the sign change detector on the smoothed stream. In other
words, the sign change detector should be run on two values: first, the average
of the current and last points; second, the average between the last and
previous-to-last points. However, Louis' program runs the sign change detector
between the average point and the previous, unsmoothed point. Here is the
correct version, which needs to preserve the average between the last and
previous-to-last points:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-zero-crossings</span> input-stream last-value last-avpt<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>current <span style="color: #907373;">(</span>stream-car input-stream<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>avpt <span style="color: #907373;">(</span>/ <span style="color: #6276ba;">(</span>+ current last-value<span style="color: #6276ba;">)</span> 2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>cons-stream
     <span style="color: #709870;">(</span>sign-change-detector avpt last-avpt<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>make-zero-crossings
      <span style="color: #907373;">(</span>stream-cdr input-stream<span style="color: #907373;">)</span> current avpt<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline99" class="outline-5">
<h5 id="orgheadline99"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.76">Exercise 3.76.</a></h5>
<div class="outline-text-5" id="text-orgheadline99">
<p>
Here, we exploit the inherent independence between the smoothing process and
the sign-change detection to compose the two transformations:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">smooth</span> input-stream<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">inner</span> input-stream last-value<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>current <span style="color: #6276ba;">(</span>stream-car input-stream<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>avpt <span style="color: #6276ba;">(</span>/ <span style="color: #858580;">(</span>+ current last-value<span style="color: #858580;">)</span> 2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>cons-stream avpt
                   <span style="color: #907373;">(</span>inner <span style="color: #6276ba;">(</span>stream-cdr input-stream<span style="color: #6276ba;">)</span> current<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>inner input-stream 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">zero-crossings</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>s <span style="color: #907373;">(</span>smooth sense-stream<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>stream-map sign-change-detector
                s <span style="color: #709870;">(</span>cdr s<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline100" class="outline-4">
<h4 id="orgheadline100"><span class="done DONE">DONE</span> 3.5.4: Streams and Delayed Evaluation</h4>
<div class="outline-text-4" id="text-orgheadline100">
<p>
:Effort:   2:00
</p>
</div>

<div id="outline-container-orgheadline101" class="outline-5">
<h5 id="orgheadline101">Code</h5>
<div class="outline-text-5" id="text-orgheadline101">
<p>
Stream integral function from text:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">integral</span> delayed-integrand initial-value dt<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">int</span>
    <span style="color: #909183;">(</span>cons-stream initial-value
                 <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>integrand <span style="color: #858580;">(</span><span style="color: #a020f0;">force</span> delayed-integrand<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                   <span style="color: #907373;">(</span>add-streams <span style="color: #6276ba;">(</span>scale-stream integrand dt<span style="color: #6276ba;">)</span>
                                int<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  int<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline102" class="outline-5">
<h5 id="orgheadline102"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.77">Exercise 3.77.</a></h5>
<div class="outline-text-5" id="text-orgheadline102">
<p>
This should just be a matter of delaying the evaluation of <code>integrand</code> until
the <code>cdr</code> of the <code>cons-stream</code> is forced, the same way as is done for the
implicit definition:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">integral</span> delayed-integrand initial-value dt<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons-stream
   initial-value
   <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>integrand <span style="color: #6276ba;">(</span><span style="color: #a020f0;">force</span> delayed-integrand<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>stream-null? integrand<span style="color: #907373;">)</span>
         the-empty-stream
         <span style="color: #907373;">(</span>integral
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">The first argument to INTEGRAL is a *delayed* integrand.</span>
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">delay</span> <span style="color: #858580;">(</span>stream-cdr integrand<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span>+ <span style="color: #858580;">(</span>* dt <span style="color: #80a880;">(</span>stream-car integrand<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
             initial-value<span style="color: #6276ba;">)</span>
          dt<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-77"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">solve</span> f y0 dt<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">y</span> <span style="color: #909183;">(</span>integral <span style="color: #709870;">(</span><span style="color: #a020f0;">delay</span> dy<span style="color: #709870;">)</span> y0 dt<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">dy</span> <span style="color: #909183;">(</span>stream-map f y<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  y<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test 2.716924
      <span style="color: #7388d6;">(</span>stream-ref <span style="color: #909183;">(</span>solve <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>y<span style="color: #907373;">)</span> y<span style="color: #709870;">)</span> 1 0.001<span style="color: #909183;">)</span> 1000<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline103" class="outline-5">
<h5 id="orgheadline103"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.78">Exercise 3.78.</a></h5>
<div class="outline-text-5" id="text-orgheadline103">
<p>
Straightforward encoding of the diagram in the text:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">solve-2nd</span> a b dt y0 dy0<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">y</span> <span style="color: #909183;">(</span>integrate <span style="color: #709870;">(</span><span style="color: #a020f0;">delay</span> dy<span style="color: #709870;">)</span> y0 dt<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">dy</span> <span style="color: #909183;">(</span>integrate <span style="color: #709870;">(</span><span style="color: #a020f0;">delay</span> ddy<span style="color: #709870;">)</span> dy0 dt<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">ddy</span> <span style="color: #909183;">(</span>add-streams <span style="color: #709870;">(</span>scale-stream dy a<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>scale-stream y b<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  y<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline104" class="outline-5">
<h5 id="orgheadline104"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.79">Exercise 3.79.</a></h5>
<div class="outline-text-5" id="text-orgheadline104">
<p>
The integration of <code>ddy</code> to <code>dy</code> and <code>dy</code> to <code>y</code> remain identical with the
previous answer. The only change is to generalize the definition of <code>ddy</code> to an
arbitrary function of the two variables \(\mathtt{dy} \equiv \frac{dy}{dt}\) and
\(\mathtt{y} \equiv y\):
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">solve-2nd</span> f dt y0 dy0<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">y</span> <span style="color: #909183;">(</span>integrate <span style="color: #709870;">(</span><span style="color: #a020f0;">delay</span> dy<span style="color: #709870;">)</span> y0 dt<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">dy</span> <span style="color: #909183;">(</span>integrate <span style="color: #709870;">(</span><span style="color: #a020f0;">delay</span> ddy<span style="color: #709870;">)</span> dy0 dt<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">ddy</span> <span style="color: #909183;">(</span>stream-map-poly f dy y<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>  <span style="color: #b22222;">; </span><span style="color: #b22222;">(define (f dy y) ...)</span>
  y<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline105" class="outline-5">
<h5 id="orgheadline105"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.80">Exercise 3.80.</a></h5>
<div class="outline-text-5" id="text-orgheadline105">
<p>
Another transcription of the equations/signal-flow diagram:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-integral"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">RLC</span> R L C dt vC0 iL0<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">iL</span> <span style="color: #909183;">(</span>integral <span style="color: #709870;">(</span><span style="color: #a020f0;">delay</span> diL<span style="color: #709870;">)</span> iL0 dt<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">vC</span> <span style="color: #909183;">(</span>integral <span style="color: #709870;">(</span><span style="color: #a020f0;">delay</span> dVC<span style="color: #709870;">)</span> vC0 dt<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">dVC</span> <span style="color: #909183;">(</span>scale-stream iL <span style="color: #709870;">(</span>/ <span style="color: #907373;">(</span>- 1<span style="color: #907373;">)</span> C<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">diL</span> <span style="color: #909183;">(</span>add-streams <span style="color: #709870;">(</span>scale-stream vC <span style="color: #907373;">(</span>/ 1 L<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                           <span style="color: #709870;">(</span>scale-stream iL <span style="color: #907373;">(</span>/ <span style="color: #6276ba;">(</span>- R<span style="color: #6276ba;">)</span> L<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons vC iL<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-80"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">vCiL</span> <span style="color: #7388d6;">(</span>RLC 1 0.2 1 0.1 0 10<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">vC</span> <span style="color: #7388d6;">(</span>car vCiL<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">iL</span> <span style="color: #7388d6;">(</span>cdr vCiL<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">parameterize</span> <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>current-test-epsilon 0.01<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
              <span style="color: #7388d6;">(</span>test -0.9605
                    <span style="color: #909183;">(</span>stream-ref vC 10<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
              <span style="color: #7388d6;">(</span>test -1.2153
                    <span style="color: #909183;">(</span>stream-ref iL 10<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline106" class="outline-4">
<h4 id="orgheadline106"><span class="done DONE">DONE</span> 3.5.5: Modularity of Functional Programs and Modularity of Objects</h4>
<div class="outline-text-4" id="text-orgheadline106">
<p>
:Effort:   2:00
</p>
</div>

<div id="outline-container-orgheadline107" class="outline-5">
<h5 id="orgheadline107"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.81">Exercise 3.81.</a></h5>
<div class="outline-text-5" id="text-orgheadline107">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"stream-util"</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Generates a stream of random numbers given a stream of requests to the RNG,</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">which can take two forms:</span>
<span style="color: #b22222;">;;;</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">- GENERATE: emit the next number in the random number sequence</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">- a number: reset the sequence using the number as the seed. Should be</span>
<span style="color: #b22222;">;;;   </span><span style="color: #b22222;">between 0 and 1.</span>
<span style="color: #b22222;">;;;</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">REQUEST-STREAM must start with a number to initialize the seed.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">rand-stream</span> request-stream<span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Linear congruential generator -- glibc coefficients</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">rand-update</span> x<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">m</span> <span style="color: #709870;">(</span>expt 2 31<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>/ <span style="color: #709870;">(</span>modulo <span style="color: #907373;">(</span>+ <span style="color: #6276ba;">(</span>* 1103515245 <span style="color: #858580;">(</span>floor <span style="color: #80a880;">(</span>* x m<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> 12345<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>expt 2 31<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
       m<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">reset?</span> request<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>number? request<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">when</span> <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span><span style="color: #a020f0;">or</span> <span style="color: #907373;">(</span>stream-null? request-stream<span style="color: #907373;">)</span>
                 <span style="color: #907373;">(</span>reset? <span style="color: #6276ba;">(</span>stream-car request-stream<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"RAND-STREAM -- first element must be random seed"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">recur</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>request-stream request-stream<span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>value-stream the-empty-stream<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>stream-null? request-stream<span style="color: #709870;">)</span>
        the-empty-stream
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>request <span style="color: #858580;">(</span>stream-car request-stream<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">output-stream</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>eq? request 'generate<span style="color: #80a880;">)</span> value-stream<span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>reset? request<span style="color: #80a880;">)</span>
                   <span style="color: #80a880;">(</span>cons-stream request
                                <span style="color: #887070;">(</span>stream-map rand-update output-stream<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span><span style="color: #a020f0;">else</span> <span style="color: #80a880;">(</span>error <span style="color: #8b2252;">"RAND-STREAM -- bad request"</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>cons-stream <span style="color: #6276ba;">(</span>stream-car output-stream<span style="color: #6276ba;">)</span>
                       <span style="color: #6276ba;">(</span>rec <span style="color: #858580;">(</span>stream-cdr request-stream<span style="color: #858580;">)</span>
                            <span style="color: #858580;">(</span>stream-cdr output-stream<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>


<div class="org-src-container">

<pre class="src src-scheme"></pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline108" class="outline-5">
<h5 id="orgheadline108"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_thm_3.82">Exercise 3.82.</a></h5>
<div class="outline-text-5" id="text-orgheadline108">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-3-81"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">stream-estimate-interval</span> P x1 x2 y1 y2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">constant-stream</span> c<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">s</span> <span style="color: #709870;">(</span>cons-stream c s<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">area</span> <span style="color: #909183;">(</span>* <span style="color: #709870;">(</span>- x2 x1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>- y2 y1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rand-stream-input</span>
    <span style="color: #909183;">(</span>cons-stream seed
                 <span style="color: #709870;">(</span>constant-stream 'generate<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">recur</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>rands <span style="color: #907373;">(</span>rand-stream rand-stream-input<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>pf <span style="color: #907373;">(</span>cons 0 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>x <span style="color: #6276ba;">(</span>stream-car rands<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>y <span style="color: #6276ba;">(</span>stream-car <span style="color: #858580;">(</span>stream-cdr rands<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>pass <span style="color: #858580;">(</span>car pf<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>fail <span style="color: #858580;">(</span>cdr pf<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>pfnext
              <span style="color: #858580;">(</span><span style="color: #a020f0;">if</span> <span style="color: #80a880;">(</span>P x y<span style="color: #80a880;">)</span>
                  <span style="color: #80a880;">(</span>cons <span style="color: #887070;">(</span>+ 1 pass<span style="color: #887070;">)</span> fail<span style="color: #80a880;">)</span>
                  <span style="color: #80a880;">(</span>cons pass <span style="color: #887070;">(</span>+ 1 fail<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>cons-stream <span style="color: #6276ba;">(</span>* area
                        <span style="color: #b22222;">;; </span><span style="color: #b22222;">Probability of satisfying P</span>
                        <span style="color: #858580;">(</span>/ <span style="color: #80a880;">(</span>car pfnext<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>+ <span style="color: #887070;">(</span>car pfnext<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>cdr pfnext<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                     <span style="color: #6276ba;">(</span>recur <span style="color: #858580;">(</span>stream-cdr rands<span style="color: #858580;">)</span> pfnext<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Robert Irelan</p>
<p class="email">Email: <a href="mailto:rirelan@gmail.com">rirelan@gmail.com</a></p>
<p class="date">Created: 2015-08-28 Fri 08:19</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
