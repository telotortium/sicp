<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2015-08-28 Fri 08:19 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Structure and Interpretation of Computer Programs (SICP)</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Robert Irelan" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Structure and Interpretation of Computer Programs (SICP)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline110">Chapter 2</a>
<ul>
<li><a href="#orgheadline21">2.1: Introduction to Data Abstraction</a>
<ul>
<li><a href="#orgheadline2">2.1.1: Example: Arithmetic Operations for Rational Numbers</a>
<ul>
<li><a href="#orgheadline1">Exercise 2.1</a></li>
</ul>
</li>
<li><a href="#orgheadline5">2.1.2: Abstraction Barriers</a>
<ul>
<li><a href="#orgheadline3">Exercise 2.2</a></li>
<li><a href="#orgheadline4">Exercise 2.3</a></li>
</ul>
</li>
<li><a href="#orgheadline9">2.1.3: What Is Meant By Data?</a>
<ul>
<li><a href="#orgheadline6">Exercise 2.4</a></li>
<li><a href="#orgheadline7">Exercise 2.5</a></li>
<li><a href="#orgheadline8">Exercise 2.6</a></li>
</ul>
</li>
<li><a href="#orgheadline20">2.1.4: Extended Exercise: Interval Arithmetic</a>
<ul>
<li><a href="#orgheadline10">Exercise 2.7</a></li>
<li><a href="#orgheadline11">Exercise 2.8</a></li>
<li><a href="#orgheadline12">Exercise 2.9</a></li>
<li><a href="#orgheadline13">Exercise 2.10</a></li>
<li><a href="#orgheadline14">Exercise 2.11</a></li>
<li><a href="#orgheadline15">Exercise 2.12</a></li>
<li><a href="#orgheadline16">Exercise 2.13</a></li>
<li><a href="#orgheadline17">Exercise 2.14</a></li>
<li><a href="#orgheadline18">Exercise 2.15</a></li>
<li><a href="#orgheadline19">Exercise 2.16</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline62">2.2: Hierarchical Data and the Closure Property</a>
<ul>
<li><a href="#orgheadline29">2.2.1: Representing Sequences</a>
<ul>
<li><a href="#orgheadline22">Exercise 2.17</a></li>
<li><a href="#orgheadline23">Exercise 2.18</a></li>
<li><a href="#orgheadline24">Exercise 2.19</a></li>
<li><a href="#orgheadline25">Exercise 2.20</a></li>
<li><a href="#orgheadline26">Exercise 2.21</a></li>
<li><a href="#orgheadline27">Exercise 2.22</a></li>
<li><a href="#orgheadline28">Exercise 2.23</a></li>
</ul>
</li>
<li><a href="#orgheadline39">2.2.2: Hierarchical Structures</a>
<ul>
<li><a href="#orgheadline30">Exercise 2.24</a></li>
<li><a href="#orgheadline31">Exercise 2.25</a></li>
<li><a href="#orgheadline32">Exercise 2.26</a></li>
<li><a href="#orgheadline33">Exercise 2.27</a></li>
<li><a href="#orgheadline34">Exercise 2.28</a></li>
<li><a href="#orgheadline35">Exercise 2.29</a></li>
<li><a href="#orgheadline36">Exercise 2.30</a></li>
<li><a href="#orgheadline37">Exercise 2.31</a></li>
<li><a href="#orgheadline38">Exercise 2.32</a></li>
</ul>
</li>
<li><a href="#orgheadline51">2.2.3: Sequences as Conventional Interfaces</a>
<ul>
<li><a href="#orgheadline40">Exercise 2.33</a></li>
<li><a href="#orgheadline41">Exercise 2.34</a></li>
<li><a href="#orgheadline42">Exercise 2.35</a></li>
<li><a href="#orgheadline43">Exercise 2.36</a></li>
<li><a href="#orgheadline44">Exercise 2.37</a></li>
<li><a href="#orgheadline45">Exercise 2.38</a></li>
<li><a href="#orgheadline46">Exercise 2.39</a></li>
<li><a href="#orgheadline47">Exercise 2.40</a></li>
<li><a href="#orgheadline48">Exercise 2.41</a></li>
<li><a href="#orgheadline49">Exercise 2.42</a></li>
<li><a href="#orgheadline50">Exercise 2.43</a></li>
</ul>
</li>
<li><a href="#orgheadline61">2.2.4: Example: A Picture Language</a>
<ul>
<li><a href="#orgheadline52">Exercise 2.44</a></li>
<li><a href="#orgheadline53">Exercise 2.45</a></li>
<li><a href="#orgheadline54">Exercise 2.46</a></li>
<li><a href="#orgheadline55">Exercise 2.47</a></li>
<li><a href="#orgheadline56">Exercise 2.48</a></li>
<li><a href="#orgheadline57">Exercise 2.49</a></li>
<li><a href="#orgheadline58">Exercise 2.50</a></li>
<li><a href="#orgheadline59">Exercise 2.51</a></li>
<li><a href="#orgheadline60">Exercise 2.52</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline75">2.3: Symbolic Data</a>
<ul>
<li><a href="#orgheadline66">2.3.1: Quotation</a>
<ul>
<li><a href="#orgheadline63">Exercise 2.53.</a></li>
<li><a href="#orgheadline64">Exercise 2.54.</a></li>
<li><a href="#orgheadline65">Exercise 2.55.</a></li>
</ul>
</li>
<li><a href="#orgheadline67">2.3.2: Example: Symbolic Differentiation</a>
<ul>
<li><a href="#orgheadline68">Exercise 2.56.</a></li>
<li><a href="#orgheadline69">Exercise 2.57.</a></li>
<li><a href="#orgheadline72">Exercise 2.58.</a></li>
</ul>
</li>
<li><a href="#orgheadline73">2.3.3: Example: Representing Sets</a></li>
<li><a href="#orgheadline74">2.3.4: Example: Huffman Encoding Trees</a></li>
</ul>
</li>
<li><a href="#orgheadline76">2.4: Multiple Representations for Abstract Data</a>
<ul>
<li><a href="#orgheadline77">2.4.1: Representations for Complex Numbers</a></li>
<li><a href="#orgheadline78">2.4.2: Tagged data</a></li>
<li><a href="#orgheadline83">2.4.3: Data-Directed Programming and Additivity</a>
<ul>
<li><a href="#orgheadline79">Exercise 2.73.</a></li>
<li><a href="#orgheadline80">Exercise 2.74.</a></li>
<li><a href="#orgheadline81">Exercise 2.75.</a></li>
<li><a href="#orgheadline82">Exercise 2.76.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline109">2.5: Systems with Generic Operations</a>
<ul>
<li><a href="#orgheadline84">Auxiliary definitions</a></li>
<li><a href="#orgheadline89">2.5.1: Generic Arithmetic Operations</a>
<ul>
<li><a href="#orgheadline85">Exercise 2.77.</a></li>
<li><a href="#orgheadline86">Exercise 2.78.</a></li>
<li><a href="#orgheadline87">Exercise 2.79.</a></li>
<li><a href="#orgheadline88">Exercise 2.80.</a></li>
</ul>
</li>
<li><a href="#orgheadline95">2.5.2: Combining Data of Different Types</a>
<ul>
<li><a href="#orgheadline90">Auxiliary definitions</a></li>
<li><a href="#orgheadline91">Exercise 2.81.</a></li>
<li><a href="#orgheadline92">Exercise 2.82.</a></li>
<li><a href="#orgheadline93">Exercise 2.83.</a></li>
<li><a href="#orgheadline94">Exercise 2.84.</a></li>
</ul>
</li>
<li><a href="#orgheadline96">2.5.3: Example: Symbolic Algebra</a>
<ul>
<li><a href="#orgheadline97">Auxiliary definitions</a></li>
<li><a href="#orgheadline98">Exercise 2.87.</a></li>
<li><a href="#orgheadline99">Exercise 2.88.</a></li>
<li><a href="#orgheadline100">Exercise 2.89.</a></li>
<li><a href="#orgheadline101">Exercise 2.90.</a></li>
<li><a href="#orgheadline102">Exercise 2.91.</a></li>
<li><a href="#orgheadline103">Exercise 2.92.</a></li>
<li><a href="#orgheadline104">Exercise 2.93.</a></li>
<li><a href="#orgheadline105">Exercise 2.94.</a></li>
<li><a href="#orgheadline106">Exercise 2.95.</a></li>
<li><a href="#orgheadline107">Exercise 2.96.</a></li>
<li><a href="#orgheadline108">Exercise 2.97.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline110" class="outline-2">
<h2 id="orgheadline110"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-13.html#%_chap_2">Chapter 2</a></h2>
<div class="outline-text-2" id="text-orgheadline110">
</div><div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_sec_2.1">2.1: Introduction to Data Abstraction</a></h3>
<div class="outline-text-3" id="text-orgheadline21">
</div><div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_sec_2.1.1">2.1.1: Example: Arithmetic Operations for Rational Numbers</a></h4>
<div class="outline-text-4" id="text-orgheadline2">
</div><div id="outline-container-orgheadline1" class="outline-5">
<h5 id="orgheadline1"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.1">Exercise 2.1</a></h5>
</div>
</div>
<div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_sec_2.1.2">2.1.2: Abstraction Barriers</a></h4>
<div class="outline-text-4" id="text-orgheadline5">
</div><div id="outline-container-orgheadline3" class="outline-5">
<h5 id="orgheadline3"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.2">Exercise 2.2</a></h5>
</div>
<div id="outline-container-orgheadline4" class="outline-5">
<h5 id="orgheadline4"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.3">Exercise 2.3</a></h5>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-4">
<h4 id="orgheadline9"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_sec_2.1.3">2.1.3: What Is Meant By Data?</a></h4>
<div class="outline-text-4" id="text-orgheadline9">
</div><div id="outline-container-orgheadline6" class="outline-5">
<h5 id="orgheadline6"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.4">Exercise 2.4</a></h5>
</div>
<div id="outline-container-orgheadline7" class="outline-5">
<h5 id="orgheadline7"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.5">Exercise 2.5</a></h5>
</div>
<div id="outline-container-orgheadline8" class="outline-5">
<h5 id="orgheadline8"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.6">Exercise 2.6</a></h5>
</div>
</div>
<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_sec_2.1.4">2.1.4: Extended Exercise: Interval Arithmetic</a></h4>
<div class="outline-text-4" id="text-orgheadline20">
</div><div id="outline-container-orgheadline10" class="outline-5">
<h5 id="orgheadline10"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.7">Exercise 2.7</a></h5>
</div>
<div id="outline-container-orgheadline11" class="outline-5">
<h5 id="orgheadline11"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.8">Exercise 2.8</a></h5>
</div>
<div id="outline-container-orgheadline12" class="outline-5">
<h5 id="orgheadline12"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.9">Exercise 2.9</a></h5>
</div>
<div id="outline-container-orgheadline13" class="outline-5">
<h5 id="orgheadline13"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.10">Exercise 2.10</a></h5>
</div>
<div id="outline-container-orgheadline14" class="outline-5">
<h5 id="orgheadline14"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.11">Exercise 2.11</a></h5>
</div>
<div id="outline-container-orgheadline15" class="outline-5">
<h5 id="orgheadline15"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.12">Exercise 2.12</a></h5>
</div>
<div id="outline-container-orgheadline16" class="outline-5">
<h5 id="orgheadline16"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.13">Exercise 2.13</a></h5>
</div>
<div id="outline-container-orgheadline17" class="outline-5">
<h5 id="orgheadline17"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.14">Exercise 2.14</a></h5>
</div>
<div id="outline-container-orgheadline18" class="outline-5">
<h5 id="orgheadline18"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.15">Exercise 2.15</a></h5>
</div>
<div id="outline-container-orgheadline19" class="outline-5">
<h5 id="orgheadline19"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#%_thm_2.16">Exercise 2.16</a></h5>
</div>
</div>
</div>

<div id="outline-container-orgheadline62" class="outline-3">
<h3 id="orgheadline62"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_sec_2.2">2.2: Hierarchical Data and the Closure Property</a></h3>
<div class="outline-text-3" id="text-orgheadline62">
</div><div id="outline-container-orgheadline29" class="outline-4">
<h4 id="orgheadline29"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_sec_2.2.1">2.2.1: Representing Sequences</a></h4>
<div class="outline-text-4" id="text-orgheadline29">
</div><div id="outline-container-orgheadline22" class="outline-5">
<h5 id="orgheadline22"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.17">Exercise 2.17</a></h5>
</div>
<div id="outline-container-orgheadline23" class="outline-5">
<h5 id="orgheadline23"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.18">Exercise 2.18</a></h5>
</div>
<div id="outline-container-orgheadline24" class="outline-5">
<h5 id="orgheadline24"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.19">Exercise 2.19</a></h5>
</div>
<div id="outline-container-orgheadline25" class="outline-5">
<h5 id="orgheadline25"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.20">Exercise 2.20</a></h5>
</div>
<div id="outline-container-orgheadline26" class="outline-5">
<h5 id="orgheadline26"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.21">Exercise 2.21</a></h5>
</div>
<div id="outline-container-orgheadline27" class="outline-5">
<h5 id="orgheadline27"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.22">Exercise 2.22</a></h5>
</div>
<div id="outline-container-orgheadline28" class="outline-5">
<h5 id="orgheadline28"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.23">Exercise 2.23</a></h5>
</div>
</div>
<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_sec_2.2.2">2.2.2: Hierarchical Structures</a></h4>
<div class="outline-text-4" id="text-orgheadline39">
</div><div id="outline-container-orgheadline30" class="outline-5">
<h5 id="orgheadline30"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.24">Exercise 2.24</a></h5>
</div>
<div id="outline-container-orgheadline31" class="outline-5">
<h5 id="orgheadline31"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.25">Exercise 2.25</a></h5>
</div>
<div id="outline-container-orgheadline32" class="outline-5">
<h5 id="orgheadline32"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.26">Exercise 2.26</a></h5>
</div>
<div id="outline-container-orgheadline33" class="outline-5">
<h5 id="orgheadline33"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.27">Exercise 2.27</a></h5>
</div>
<div id="outline-container-orgheadline34" class="outline-5">
<h5 id="orgheadline34"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.28">Exercise 2.28</a></h5>
</div>
<div id="outline-container-orgheadline35" class="outline-5">
<h5 id="orgheadline35"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.29">Exercise 2.29</a></h5>
</div>
<div id="outline-container-orgheadline36" class="outline-5">
<h5 id="orgheadline36"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.30">Exercise 2.30</a></h5>
</div>
<div id="outline-container-orgheadline37" class="outline-5">
<h5 id="orgheadline37"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.31">Exercise 2.31</a></h5>
</div>
<div id="outline-container-orgheadline38" class="outline-5">
<h5 id="orgheadline38"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.32">Exercise 2.32</a></h5>
</div>
</div>
<div id="outline-container-orgheadline51" class="outline-4">
<h4 id="orgheadline51"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_sec_2.2.3">2.2.3: Sequences as Conventional Interfaces</a></h4>
<div class="outline-text-4" id="text-orgheadline51">
</div><div id="outline-container-orgheadline40" class="outline-5">
<h5 id="orgheadline40"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.33">Exercise 2.33</a></h5>
</div>
<div id="outline-container-orgheadline41" class="outline-5">
<h5 id="orgheadline41"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.34">Exercise 2.34</a></h5>
</div>
<div id="outline-container-orgheadline42" class="outline-5">
<h5 id="orgheadline42"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.35">Exercise 2.35</a></h5>
</div>
<div id="outline-container-orgheadline43" class="outline-5">
<h5 id="orgheadline43"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.36">Exercise 2.36</a></h5>
</div>
<div id="outline-container-orgheadline44" class="outline-5">
<h5 id="orgheadline44"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.37">Exercise 2.37</a></h5>
</div>
<div id="outline-container-orgheadline45" class="outline-5">
<h5 id="orgheadline45"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.38">Exercise 2.38</a></h5>
</div>
<div id="outline-container-orgheadline46" class="outline-5">
<h5 id="orgheadline46"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.39">Exercise 2.39</a></h5>
</div>
<div id="outline-container-orgheadline47" class="outline-5">
<h5 id="orgheadline47"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.40">Exercise 2.40</a></h5>
</div>
<div id="outline-container-orgheadline48" class="outline-5">
<h5 id="orgheadline48"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.41">Exercise 2.41</a></h5>
</div>
<div id="outline-container-orgheadline49" class="outline-5">
<h5 id="orgheadline49"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.42">Exercise 2.42</a></h5>
</div>
<div id="outline-container-orgheadline50" class="outline-5">
<h5 id="orgheadline50"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.43">Exercise 2.43</a></h5>
</div>
</div>
<div id="outline-container-orgheadline61" class="outline-4">
<h4 id="orgheadline61"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_sec_2.2.4">2.2.4: Example: A Picture Language</a></h4>
<div class="outline-text-4" id="text-orgheadline61">
</div><div id="outline-container-orgheadline52" class="outline-5">
<h5 id="orgheadline52"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.44">Exercise 2.44</a></h5>
</div>
<div id="outline-container-orgheadline53" class="outline-5">
<h5 id="orgheadline53"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.45">Exercise 2.45</a></h5>
</div>
<div id="outline-container-orgheadline54" class="outline-5">
<h5 id="orgheadline54"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.46">Exercise 2.46</a></h5>
</div>
<div id="outline-container-orgheadline55" class="outline-5">
<h5 id="orgheadline55"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.47">Exercise 2.47</a></h5>
</div>
<div id="outline-container-orgheadline56" class="outline-5">
<h5 id="orgheadline56"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.48">Exercise 2.48</a></h5>
</div>
<div id="outline-container-orgheadline57" class="outline-5">
<h5 id="orgheadline57"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.49">Exercise 2.49</a></h5>
</div>
<div id="outline-container-orgheadline58" class="outline-5">
<h5 id="orgheadline58"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.50">Exercise 2.50</a></h5>
</div>
<div id="outline-container-orgheadline59" class="outline-5">
<h5 id="orgheadline59"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.51">Exercise 2.51</a></h5>
</div>
<div id="outline-container-orgheadline60" class="outline-5">
<h5 id="orgheadline60"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-15.html#%_thm_2.52">Exercise 2.52</a></h5>
</div>
</div>
</div>

<div id="outline-container-orgheadline75" class="outline-3">
<h3 id="orgheadline75"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3">2.3: Symbolic Data</a></h3>
<div class="outline-text-3" id="text-orgheadline75">
</div><div id="outline-container-orgheadline66" class="outline-4">
<h4 id="orgheadline66"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.1">2.3.1: Quotation</a></h4>
<div class="outline-text-4" id="text-orgheadline66">
</div><div id="outline-container-orgheadline63" class="outline-5">
<h5 id="orgheadline63"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_thm_2.53">Exercise 2.53.</a></h5>
<div class="outline-text-5" id="text-orgheadline63">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock1"><span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>a b c<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>list 'a 'b 'c<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>george<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>list <span style="color: #909183;">(</span>list 'george<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>y1 y2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>cdr '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>x1 x2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>y1 y2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>y1 y2<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>cadr '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>x1 x2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>y1 y2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>pair? <span style="color: #909183;">(</span>car '<span style="color: #709870;">(</span>a short list<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>memq 'red '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>red shoes<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>blue socks<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>red shoes blue socks<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>memq 'red '<span style="color: #909183;">(</span>red shoes blue socks<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-5">
<h5 id="orgheadline64"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_thm_2.54">Exercise 2.54.</a></h5>
<div class="outline-text-5" id="text-orgheadline64">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock2"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">my-equal?</span> a b<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>not <span style="color: #907373;">(</span><span style="color: #a020f0;">and</span> <span style="color: #6276ba;">(</span>pair? a<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>pair? b<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>eq? a b<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>pair? a<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>pair? b<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>my-equal? <span style="color: #6276ba;">(</span>car a<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>car b<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span>my-equal? <span style="color: #6276ba;">(</span>cdr a<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>cdr b<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> #f<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock3"><span style="color: #707183;">(</span>test #t
      <span style="color: #7388d6;">(</span>my-equal? '<span style="color: #909183;">(</span>this is a list<span style="color: #909183;">)</span> '<span style="color: #909183;">(</span>this is a list<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test #f
      <span style="color: #7388d6;">(</span>my-equal? '<span style="color: #909183;">(</span>this is a list<span style="color: #909183;">)</span> '<span style="color: #909183;">(</span>this <span style="color: #709870;">(</span>is a<span style="color: #709870;">)</span> list<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline65" class="outline-5">
<h5 id="orgheadline65"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_thm_2.55">Exercise 2.55.</a></h5>
<div class="outline-text-5" id="text-orgheadline65">
<p>
When this expression is evaluated, the outer <code>quote</code> is stripped, but the inner
one remains, giving the observed result, <code>quote</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline67" class="outline-4">
<h4 id="orgheadline67"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.2">2.3.2: Example: Symbolic Differentiation</a></h4>
<div class="outline-text-4" id="text-orgheadline67">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock4"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Provided in the book</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">variable?</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>symbol? x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">same-variable?</span> v1 v2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>variable? v1<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>variable? v2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? v1 v2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">=number?</span> exp num<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>number? exp<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>= exp num<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-sum</span> a1 a2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? a1 0<span style="color: #709870;">)</span> a2<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? a2 0<span style="color: #709870;">)</span> a1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>number? a1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>number? a2<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>+ a1 a2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>list '+ a1 a2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-product</span> m1 m2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">or</span> <span style="color: #907373;">(</span>=number? m1 0<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>=number? m2 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span> 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? m1 1<span style="color: #709870;">)</span> m2<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? m2 1<span style="color: #709870;">)</span> m1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>number? m1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>number? m2<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>* m1 m2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>list '* m1 m2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">sum?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? <span style="color: #709870;">(</span>car x<span style="color: #709870;">)</span> '+<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">addend</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">augend</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">product?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? <span style="color: #709870;">(</span>car x<span style="color: #709870;">)</span> '*<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplier</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplicand</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">deriv</span> exp var<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>number? exp<span style="color: #709870;">)</span> 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>variable? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>same-variable? exp var<span style="color: #907373;">)</span> 1 0<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>sum? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>make-sum <span style="color: #907373;">(</span>deriv <span style="color: #6276ba;">(</span>addend exp<span style="color: #6276ba;">)</span> var<span style="color: #907373;">)</span>
                   <span style="color: #907373;">(</span>deriv <span style="color: #6276ba;">(</span>augend exp<span style="color: #6276ba;">)</span> var<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>product? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>make-sum
           <span style="color: #907373;">(</span>make-product <span style="color: #6276ba;">(</span>multiplier exp<span style="color: #6276ba;">)</span>
                         <span style="color: #6276ba;">(</span>deriv <span style="color: #858580;">(</span>multiplicand exp<span style="color: #858580;">)</span> var<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>make-product <span style="color: #6276ba;">(</span>deriv <span style="color: #858580;">(</span>multiplier exp<span style="color: #858580;">)</span> var<span style="color: #6276ba;">)</span>
                         <span style="color: #6276ba;">(</span>multiplicand exp<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"unknown expression type -- DERIV"</span> exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline68" class="outline-5">
<h5 id="orgheadline68"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_thm_2.56">Exercise 2.56.</a></h5>
<div class="outline-text-5" id="text-orgheadline68">
<p>
We define the exponentiation procedure:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock5"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-exponentiation</span> b e<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? b 1<span style="color: #709870;">)</span> 1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? e 0<span style="color: #709870;">)</span> 1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? e 1<span style="color: #709870;">)</span> b<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>number? b<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>number? e<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>expt b e<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>list '** b e<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">base</span> e<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr e<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">exponent</span> e<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr e<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">exponentiation?</span> e<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? e<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? <span style="color: #709870;">(</span>car e<span style="color: #709870;">)</span> '**<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
and then re-define the top-level <code>deriv</code> procedure to include exponentiation.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock6"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">deriv</span> exp var<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>number? exp<span style="color: #709870;">)</span> 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>variable? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>same-variable? exp var<span style="color: #907373;">)</span> 1 0<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>sum? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>make-sum <span style="color: #907373;">(</span>deriv <span style="color: #6276ba;">(</span>addend exp<span style="color: #6276ba;">)</span> var<span style="color: #907373;">)</span>
                   <span style="color: #907373;">(</span>deriv <span style="color: #6276ba;">(</span>augend exp<span style="color: #6276ba;">)</span> var<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>product? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>make-sum
           <span style="color: #907373;">(</span>make-product <span style="color: #6276ba;">(</span>multiplier exp<span style="color: #6276ba;">)</span>
                         <span style="color: #6276ba;">(</span>deriv <span style="color: #858580;">(</span>multiplicand exp<span style="color: #858580;">)</span> var<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>make-product <span style="color: #6276ba;">(</span>deriv <span style="color: #858580;">(</span>multiplier exp<span style="color: #858580;">)</span> var<span style="color: #6276ba;">)</span>
                         <span style="color: #6276ba;">(</span>multiplicand exp<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>exponentiation? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>b <span style="color: #858580;">(</span>base exp<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span>e <span style="color: #858580;">(</span>exponent exp<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>make-product
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span>number? e<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>make-product
                 <span style="color: #80a880;">(</span>exponent exp<span style="color: #80a880;">)</span>
                 <span style="color: #80a880;">(</span>make-exponentiation <span style="color: #887070;">(</span>base exp<span style="color: #887070;">)</span>
                                      <span style="color: #887070;">(</span>make-sum <span style="color: #707183;">(</span>exponent exp<span style="color: #707183;">)</span> -1<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>error <span style="color: #8b2252;">"Can't evaluate non-constant exponents"</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>deriv <span style="color: #858580;">(</span>base exp<span style="color: #858580;">)</span> var<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"unknown expression type -- DERIV"</span> exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline69" class="outline-5">
<h5 id="orgheadline69"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_thm_2.57">Exercise 2.57.</a></h5>
<div class="outline-text-5" id="text-orgheadline69">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock7"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-sum</span> a . as<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">rec</span> a as<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? as<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>list a<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>a1 a<span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>a2 <span style="color: #858580;">(</span>car as<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>arest <span style="color: #858580;">(</span>cdr as<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>=number? a1 0<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>rec a2 arest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>=number? a2 0<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>rec a1 arest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span><span style="color: #a020f0;">and</span> <span style="color: #80a880;">(</span>number? a1<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>number? a2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>rec <span style="color: #80a880;">(</span>+ a1 a2<span style="color: #80a880;">)</span> arest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span>
                <span style="color: #858580;">(</span>cons a1 <span style="color: #80a880;">(</span>rec a2 arest<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>val <span style="color: #907373;">(</span>rec a as<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>pair? val<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>pair? <span style="color: #6276ba;">(</span>cdr val<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>cons '+ val<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>car val<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-product</span> m . ms<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">rec</span> m ms<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? ms<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>list m<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>m1 m<span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>m2 <span style="color: #858580;">(</span>car ms<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>mrest <span style="color: #858580;">(</span>cdr ms<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span><span style="color: #a020f0;">or</span> <span style="color: #80a880;">(</span>=number? m1 0<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>=number? m2 0<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>list 0<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>=number? m1 1<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>rec m2 mrest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>=number? m2 1<span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>rec m1 mrest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span><span style="color: #a020f0;">and</span> <span style="color: #80a880;">(</span>number? m1<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>number? m2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
               <span style="color: #858580;">(</span>rec <span style="color: #80a880;">(</span>* m1 m2<span style="color: #80a880;">)</span> mrest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span>
                <span style="color: #858580;">(</span><span style="color: #a020f0;">let</span> <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>val <span style="color: #707183;">(</span>rec m2 mrest<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                 <span style="color: #80a880;">(</span><span style="color: #a020f0;">if</span> <span style="color: #887070;">(</span>=number? <span style="color: #707183;">(</span>car val<span style="color: #707183;">)</span> 0<span style="color: #887070;">)</span>
                   <span style="color: #887070;">(</span>list 0<span style="color: #887070;">)</span>
                   <span style="color: #887070;">(</span>cons m1 val<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>val <span style="color: #907373;">(</span>rec m ms<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>pair? val<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>pair? <span style="color: #6276ba;">(</span>cdr val<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>cons '* val<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>car val<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">addend</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">augend</span> s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? <span style="color: #709870;">(</span>cdddr s<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>caddr s<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>cons '+ <span style="color: #709870;">(</span>cddr s<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplier</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplicand</span> s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? <span style="color: #709870;">(</span>cdddr s<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>caddr s<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>cons '* <span style="color: #709870;">(</span>cddr s<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock8"><span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>make-sum 0 0 0 0 0 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'x
      <span style="color: #7388d6;">(</span>make-sum <span style="color: #909183;">(</span>make-sum 'x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>+ x 3<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>make-sum 'x 3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>+ <span style="color: #909183;">(</span>+ x 3<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>+ y 2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>make-sum <span style="color: #909183;">(</span>make-sum 'x 3<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>make-sum 'y 2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>make-product 'x 'y 'z 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 1
      <span style="color: #7388d6;">(</span>make-product 1 1 1 1 1 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 'x
      <span style="color: #7388d6;">(</span>make-product <span style="color: #909183;">(</span>make-product 'x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>* x 3<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>make-product 'x 3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>* <span style="color: #909183;">(</span>* x 3<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>* y 2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>make-product <span style="color: #909183;">(</span>make-product 'x 3<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>make-product 'y 2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline72" class="outline-5">
<h5 id="orgheadline72"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_thm_2.58">Exercise 2.58.</a></h5>
<div class="outline-text-5" id="text-orgheadline72">
</div><ul class="org-ul"><li><a id="orgheadline70"></a>a. Differentiation in infix form, fully parenthesized<br  /><div class="outline-text-6" id="text-orgheadline70">
<p>
Given that each non-atomic expression is a list consisting of a left and right
expression separated by either a <code>+</code> or <code>*</code> symbol, differentiation is mostly
a case of pattern matching:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock9"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">sum?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>pair? <span style="color: #709870;">(</span>cdr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? <span style="color: #709870;">(</span>cadr x<span style="color: #709870;">)</span> '+<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">product?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>pair? <span style="color: #709870;">(</span>cdr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? <span style="color: #709870;">(</span>cadr x<span style="color: #709870;">)</span> '*<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">addend</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">augend</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplier</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplicand</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-sum</span> a1 a2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? a1 0<span style="color: #709870;">)</span>
         a2<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? a2 0<span style="color: #709870;">)</span>
         a1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>number? a1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>number? a2<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>+ a1 a2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
          <span style="color: #709870;">(</span>list a1 '+ a2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-product</span> m1 m2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">or</span> <span style="color: #907373;">(</span>=number? m1 0<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>=number? m2 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         0<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? m1 1<span style="color: #709870;">)</span>
         m2<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>=number? m2 1<span style="color: #709870;">)</span>
         m1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>number? m1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>number? m2<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>* m1 m2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
          <span style="color: #709870;">(</span>list m1 '* m2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock10"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">expr</span> <span style="color: #7388d6;">(</span>make-sum 'x <span style="color: #909183;">(</span>make-product 3 <span style="color: #709870;">(</span>make-sum 'x <span style="color: #907373;">(</span>make-sum 'y 2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 4
      <span style="color: #7388d6;">(</span>deriv expr 'x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 3
      <span style="color: #7388d6;">(</span>deriv expr 'y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>deriv expr 'z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div></li>

<li><a id="orgheadline71"></a>b. Differentiation of infix form with precedence<br  /><div class="outline-text-6" id="text-orgheadline71">
<p>
With precedence, a non-atomic expression may now be a list of more than three
elements &#x2014; a well-formed non-atomic expression now begins and ends with a
expression (where an operator is not an expression) and alternates between
operators and expressions.
</p>

<p>
Nevertheless, we can continue to use the <code>deriv</code> procedure defined above just
by changing the predicates and selectors (in addition to the changes in
ex-2-58-a). Precedence is determined as follows:
</p>

<ul class="org-ul">
<li>Sum: list contains <code>+</code></li>
<li>Product: list contains <code>*</code> but not <code>+</code></li>
<li>Exponent (not implemented): list contains <code>**</code> but not <code>*</code> or <code>+</code></li>
</ul>

<p>
The sum and product selectors consider everything to the left of the first
corresponding symbol to form the left subexpression and everything to the
right to form the right subexpression. The sum and product selectors are only
valid for lists for which <code>sum?</code> and <code>product?</code>, respectively, return
true. <code>deriv</code> makes sure to obey this prerequisite (it would be nice if Scheme
had an assertion facility which could be disabled for performance &#x2013; this
requires a macro to avoid evaluating the condition).
</p>

<p>
Since the right subexpression consists of everything after the first operator,
these infix operators are right associative. I believe the <code>+</code> and <code>*</code>
operators are conventionally assumed to be left associative, although I'm not
sure. It's not a problem here because these operators are commutative, but if
needed, left associativity can be implemented by searching for the last
occurrence of a symbol rather than the first.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock11"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">sum?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>pair? <span style="color: #709870;">(</span>cdr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>memq '+ x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">product?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>pair? <span style="color: #709870;">(</span>cdr x<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">and</span> <span style="color: #709870;">(</span>memq '* x<span style="color: #709870;">)</span>
                                      <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>memq '+ x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">addend</span> s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>res <span style="color: #907373;">(</span>take-while <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>x<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>eq? x '+<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> s<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? <span style="color: #907373;">(</span>cdr res<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>car res<span style="color: #709870;">)</span> res<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">augend</span> s<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>res <span style="color: #907373;">(</span>cdr <span style="color: #6276ba;">(</span>drop-while <span style="color: #858580;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #80a880;">(</span>x<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>not <span style="color: #887070;">(</span>eq? x '+<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span> s<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? <span style="color: #907373;">(</span>cdr res<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>car res<span style="color: #709870;">)</span> res<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplier</span> p<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>res <span style="color: #907373;">(</span>take-while <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>x<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>eq? x '*<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> p<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? <span style="color: #907373;">(</span>cdr res<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>car res<span style="color: #709870;">)</span> res<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiplicand</span> p<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>res <span style="color: #907373;">(</span>cdr <span style="color: #6276ba;">(</span>drop-while <span style="color: #858580;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #80a880;">(</span>x<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>not <span style="color: #887070;">(</span>eq? x '*<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span> p<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? <span style="color: #907373;">(</span>cdr res<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>car res<span style="color: #709870;">)</span> res<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock12"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">expr</span> '<span style="color: #7388d6;">(</span>x + 3 * <span style="color: #909183;">(</span>x + y + 2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test 4
      <span style="color: #7388d6;">(</span>deriv expr 'x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 3
      <span style="color: #7388d6;">(</span>deriv expr 'y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 0
      <span style="color: #7388d6;">(</span>deriv expr 'z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div></li></ul>
</div>
</div>

<div id="outline-container-orgheadline73" class="outline-4">
<h4 id="orgheadline73"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.3">2.3.3: Example: Representing Sets</a></h4>
</div>
<div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.4">2.3.4: Example: Huffman Encoding Trees</a></h4>
</div>
</div>

<div id="outline-container-orgheadline76" class="outline-3">
<h3 id="orgheadline76"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_sec_2.4">2.4: Multiple Representations for Abstract Data</a></h3>
<div class="outline-text-3" id="text-orgheadline76">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Operation, type -&gt; procedure dispatch table.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> apropos<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>not <span style="color: #909183;">(</span>= <span style="color: #709870;">(</span>length <span style="color: #907373;">(</span>apropos-list '*op-table*<span style="color: #907373;">)</span><span style="color: #709870;">)</span> 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">(</span><span style="color: #a020f0;">begin</span>
      <span style="color: #909183;">(</span>display <span style="color: #8b2252;">"Defining *op-table*"</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>newline<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">*op-table*</span> <span style="color: #709870;">(</span>make-hash-table equal?<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">put</span> op type proc<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>hash-table-set! *op-table* <span style="color: #907373;">(</span>list op type<span style="color: #907373;">)</span> proc<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">get</span> op type<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>hash-table-ref *op-table* <span style="color: #907373;">(</span>list op type<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>

      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Without loss of generality</span>
      <span style="color: #228b22;">&lt;&lt;ex-2-78-type-tag-scheme-number&gt;&gt;</span>

      <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">apply-generic</span> op . args<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>type-tags <span style="color: #858580;">(</span><span style="color: #a020f0;">map</span> type-tag args<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>proc <span style="color: #80a880;">(</span>get op type-tags<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> proc
                <span style="color: #858580;">(</span>apply proc <span style="color: #80a880;">(</span><span style="color: #a020f0;">map</span> contents args<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span>error
                 <span style="color: #8b2252;">"No method for these types -- APPLY-GENERIC"</span>
                 <span style="color: #80a880;">(</span>list op type-tags<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline77" class="outline-4">
<h4 id="orgheadline77"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_sec_2.4.1">2.4.1: Representations for Complex Numbers</a></h4>
<div class="outline-text-4" id="text-orgheadline77">
<p>
No exercises.
</p>
</div>
</div>

<div id="outline-container-orgheadline78" class="outline-4">
<h4 id="orgheadline78"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_sec_2.4.2">2.4.2: Tagged data</a></h4>
<div class="outline-text-4" id="text-orgheadline78">
<p>
No exercises.
</p>
</div>
</div>

<div id="outline-container-orgheadline83" class="outline-4">
<h4 id="orgheadline83"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_sec_2.4.3">2.4.3: Data-Directed Programming and Additivity</a></h4>
<div class="outline-text-4" id="text-orgheadline83">
</div><div id="outline-container-orgheadline79" class="outline-5">
<h5 id="orgheadline79"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.73">Exercise 2.73.</a></h5>
<div class="outline-text-5" id="text-orgheadline79">
<ol class="org-ol">
<li>We dispatch to an implementation of differentiation based on the operator of
an expression, which indicates whether it's a sum, product, etc. Since
numbers and variables are not operators, we cannot dispatch into the table
based on them and must handle them specially.</li>

<li><p>
Code:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">install-deriv-package</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">internal procedures</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">make-sum</span> a1 a2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>list '+ a1 a2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">addend</span> s<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>car s<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">augend</span> s<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>cadr s<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>

  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">make-product</span> m1 m2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>list '* m1 m2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">multiplier</span> p<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>car p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">multiplicand</span> p<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>cadr p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>

  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">deriv-sum</span> exp var<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>make-sum <span style="color: #709870;">(</span>deriv <span style="color: #907373;">(</span>addend exp<span style="color: #907373;">)</span> var<span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>deriv <span style="color: #907373;">(</span>augend exp<span style="color: #907373;">)</span> var<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>

  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">deriv-product</span> exp var<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>make-sum
      <span style="color: #709870;">(</span>make-product <span style="color: #907373;">(</span>multiplier exp<span style="color: #907373;">)</span>
                    <span style="color: #907373;">(</span>deriv <span style="color: #6276ba;">(</span>multiplicand  exp<span style="color: #6276ba;">)</span> var<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>make-product <span style="color: #907373;">(</span>deriv <span style="color: #6276ba;">(</span>multiplier  exp<span style="color: #6276ba;">)</span> var<span style="color: #907373;">)</span>
                    <span style="color: #907373;">(</span>multiplicand exp<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">interface to the rest of the system</span>
  <span style="color: #7388d6;">(</span>put 'deriv '+ deriv-sum<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'deriv '* deriv-product<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>install-deriv-package<span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Here is an implementation for exponentiation:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-exponentiation</span> base power<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>list '** base power<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">base</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">exponent</span> s<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">deriv-exponentiation</span> operands var<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>make-product
    <span style="color: #909183;">(</span>make-product
      <span style="color: #709870;">(</span>exponent exp<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>make-exponentiation
        <span style="color: #907373;">(</span>base exp<span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>- <span style="color: #6276ba;">(</span>exponent exp<span style="color: #6276ba;">)</span> 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>deriv <span style="color: #709870;">(</span>base exp<span style="color: #709870;">)</span> var<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'deriv '** deriv-exponentiation<span style="color: #707183;">)</span>
</pre>
</div></li>

<li>It is only necessary to change the places where the <code>get</code> or <code>put</code>
procedures are actually invoked. In my implementation above, since the only
place these procedures are invoked besides in the definition of <code>deriv</code> is
when registering the operator-specific commands, the order of the arguments
to the <code>put</code> calls is the only thing to change.</li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline80" class="outline-5">
<h5 id="orgheadline80"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.74">Exercise 2.74.</a></h5>
<div class="outline-text-5" id="text-orgheadline80">
<ol class="org-ol">
<li><p>
Assume that a procedure <code>file-type</code> can extract the type of a file without
knowing the detailed structure of the file. For example, the first element
of the file data structure always holds the type.
</p>

<p>
The <code>find-in-set</code> procedure takes the set first and the key second.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get-record</span> file employee-name<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>get <span style="color: #709870;">(</span>file-type file<span style="color: #709870;">)</span> 'find-in-set<span style="color: #909183;">)</span> file employee-name<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Again, assume that the type of the record can be extracted without
a detailed knowledge of the structure.
</p>

<p>
Note that file and employee record types are in the same namespace so that
the <code>find-in-set</code> procedure can easily be used for either.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get-salary</span> record<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>get <span style="color: #709870;">(</span>record-type record<span style="color: #709870;">)</span> 'find-in-set<span style="color: #909183;">)</span> record 'salary<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Note that this is abstracted away from the representation of the files and
records &#x2013; everything is implemented in terms of the lower-level procedures
given above.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">find-employee-record</span> files employee-name<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? files<span style="color: #909183;">)</span>
    #f
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>record <span style="color: #6276ba;">(</span>get-record <span style="color: #858580;">(</span>car files<span style="color: #858580;">)</span> employee-name<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> record
       record
       <span style="color: #907373;">(</span>find-employee-record <span style="color: #6276ba;">(</span>cdr files<span style="color: #6276ba;">)</span> employee-name<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li>Each file and employee record must be modified to place the type information
in a place where <code>file-type</code> and <code>record-type</code> can extract it, and the
primitive type-dependent procedures must be defined and put into the
dispatch table.</li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline81" class="outline-5">
<h5 id="orgheadline81"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.75">Exercise 2.75.</a></h5>
<div class="outline-text-5" id="text-orgheadline81">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-from-mag-ang</span> mag ang<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">dispatch</span> op<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? op 'magnitude<span style="color: #907373;">)</span> mag<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? op 'angle<span style="color: #907373;">)</span> ang<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? op 'real-part<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>* mag <span style="color: #6276ba;">(</span>cos ang<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? op 'imag-part<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>* mag <span style="color: #6276ba;">(</span>sin ang<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"Unknown op -- MAKE-FROM-MAG-ANG"</span> op<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  dispatch<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">pi</span> <span style="color: #7388d6;">(</span>* 2 <span style="color: #909183;">(</span>asin 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">z</span> <span style="color: #7388d6;">(</span>make-from-mag-ang 1 <span style="color: #909183;">(</span>/ pi 4<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 1
      <span style="color: #7388d6;">(</span>z 'magnitude<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #7388d6;">(</span>/ pi 4<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>z 'angle<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #7388d6;">(</span>/ <span style="color: #909183;">(</span>sqrt 2<span style="color: #909183;">)</span> 2<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>z 'real-part<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #7388d6;">(</span>/ <span style="color: #909183;">(</span>sqrt 2<span style="color: #909183;">)</span> 2<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>z 'imag-part<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline82" class="outline-5">
<h5 id="orgheadline82"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.76">Exercise 2.76.</a></h5>
<div class="outline-text-5" id="text-orgheadline82">
<p>
Steps to add types or operations:
</p>

<dl class="org-dl">
<dt>explicit dispatch</dt><dd>Need to add an additional case in every operation when a
new type is added, and need to explicitly dispatch on all types when a new
operation is added.</dd>

<dt>data-directed style</dt><dd>can add new types easily by implementing all the
operations in a package and then importing it.</dd>

<dt>message-passing style</dt><dd>can add new operations easily defined for a type, it
can fall back to a default implementation or an error &#x2013; but adding new
operations requires modifying every type.</dd>
</dl>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline109" class="outline-3">
<h3 id="orgheadline109"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-18.html#%_sec_2.5">2.5: Systems with Generic Operations</a></h3>
<div class="outline-text-3" id="text-orgheadline109">
</div><div id="outline-container-orgheadline84" class="outline-4">
<h4 id="orgheadline84">Auxiliary definitions</h4>
<div class="outline-text-4" id="text-orgheadline84">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">add</span> x y<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'add x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">sub</span> x y<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'sub x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">mul</span> x y<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'mul x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">div</span> x y<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'div x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">install-scheme-number-package</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">tag</span> x<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>attach-tag 'scheme-number x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'add '<span style="color: #909183;">(</span>scheme-number scheme-number<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>+ x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'sub '<span style="color: #909183;">(</span>scheme-number scheme-number<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>- x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'mul '<span style="color: #909183;">(</span>scheme-number scheme-number<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>* x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'div '<span style="color: #909183;">(</span>scheme-number scheme-number<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>/ x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'make '<span style="color: #909183;">(</span>scheme-number<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag x<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  'done<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>install-scheme-number-package<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-scheme-number</span> n<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>get 'make '<span style="color: #709870;">(</span>scheme-number<span style="color: #709870;">)</span><span style="color: #909183;">)</span> n<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline89" class="outline-4">
<h4 id="orgheadline89"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-18.html#%_sec_2.5.1">2.5.1: Generic Arithmetic Operations</a></h4>
<div class="outline-text-4" id="text-orgheadline89">
</div><div id="outline-container-orgheadline85" class="outline-5">
<h5 id="orgheadline85"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.77">Exercise 2.77.</a></h5>
<div class="outline-text-5" id="text-orgheadline85">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>put 'real-part '<span style="color: #7388d6;">(</span>complex<span style="color: #7388d6;">)</span> real-part<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'imag-part '<span style="color: #7388d6;">(</span>complex<span style="color: #7388d6;">)</span> imag-part<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'magnitude '<span style="color: #7388d6;">(</span>complex<span style="color: #7388d6;">)</span> magnitude<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'angle '<span style="color: #7388d6;">(</span>complex<span style="color: #7388d6;">)</span> angle<span style="color: #707183;">)</span>
</pre>
</div>

<p>
The <code>real-part</code>, etc. functions are in fact simple wrappers around the
application of the corresponding generic operations:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">real-part</span> z<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'real-part z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">imag-part</span> z<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'imag-part z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">magnitude</span> z<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'magnitude z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">angle</span> z<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'angle z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
The <code>rectangular</code> and <code>polar</code> packages define internal procedures to implement
these generic operations. The generic operations defined for <code>complex</code> numbers
just end up dispatching to the corresponding generic <code>rectangular</code> or <code>polar</code>
operations, only after which is the underlying internal function called.
</p>

<p>
For example, calling <code>(magnitude z)</code>, where <code>z</code> is a <code>complex</code> number, results
in the following calls:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Original application to complex type.</span>
<span style="color: #707183;">(</span>magnitude z<span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Expansion from generic definition of magnitude.</span>
<span style="color: #707183;">(</span>apply-generic 'magnitude z<span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Definition in this problem applies magnitude to contents of z (which may be</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">rectangular or polar).</span>
<span style="color: #707183;">(</span>magnitude <span style="color: #7388d6;">(</span>contents z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Again, expansion from generic definition of magnitude.</span>
<span style="color: #707183;">(</span>apply-generic 'magnitude <span style="color: #7388d6;">(</span>contents z<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Application of generic magnitude operation to numbers tagged rectangular or</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">polar results in calling the implementation of magnitude internal to the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">package.</span>
<span style="color: #707183;">(</span>internal-magnitude <span style="color: #7388d6;">(</span>contents <span style="color: #909183;">(</span>contents z<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline86" class="outline-5">
<h5 id="orgheadline86"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.78">Exercise 2.78.</a></h5>
<div class="outline-text-5" id="text-orgheadline86">
<p>
We special-case numbers to return <code>scheme-number</code> as their type tag and avoid
adding the type tag to numbers that would otherwise be tagged with
<code>scheme-number</code>.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock13"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-arithmetic-procedures.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"scheme-number-package.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">attach-tag</span> type-tag contents<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">and</span> <span style="color: #709870;">(</span>equal? type-tag 'scheme-number<span style="color: #709870;">)</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Leave open the possibility to apply SCHEME-NUMBER to non-numbers.</span>
           <span style="color: #709870;">(</span>number? contents<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      contents
      <span style="color: #909183;">(</span>cons type-tag contents<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">type-tag</span> datum<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>number? datum<span style="color: #709870;">)</span> 'scheme-number<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>pair? datum<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>car datum<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> error <span style="color: #8b2252;">"Bad tagged datum -- TYPE-TAG"</span> datum<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">contents</span> datum<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>number? datum<span style="color: #709870;">)</span> datum<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>pair? datum<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>cdr datum<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Bad tagged datum -- CONTENTS"</span> datum<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline87" class="outline-5">
<h5 id="orgheadline87"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.79">Exercise 2.79.</a></h5>
<div class="outline-text-5" id="text-orgheadline87">
<p>
We define the top-level generic function for convenience:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"dispatch-table.scm"</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-2-79-impl&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">equ?</span> <span style="color: #7388d6;">(</span>apply-generic 'equ? x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Install the following functions as implementations for <code>equ?</code> in the
corresponding packages:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock14"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">equ?-scheme-number</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>= x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'equ? '<span style="color: #7388d6;">(</span>scheme-number scheme-number<span style="color: #7388d6;">)</span> equ?-scheme-number<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">equ?-rat</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>= <span style="color: #709870;">(</span>numer x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>numer y<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span>= <span style="color: #709870;">(</span>denom x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>denom y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'equ? '<span style="color: #7388d6;">(</span>rational rational<span style="color: #7388d6;">)</span> equ?-rat<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">equ?-complex</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>= <span style="color: #709870;">(</span>real-part x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>real-part y<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>imag-part x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>imag-part y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'equ? '<span style="color: #7388d6;">(</span>complex complex<span style="color: #7388d6;">)</span> equ?-complex<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline88" class="outline-5">
<h5 id="orgheadline88"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.80">Exercise 2.80.</a></h5>
<div class="outline-text-5" id="text-orgheadline88">
<p>
We define the top-level generic function for convenience:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"dispatch-table.scm"</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-2-80-impl&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">=zero?</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x<span style="color: #909183;">)</span>  <span style="color: #909183;">(</span>apply-generic '=zero? x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Install the following functions as implementations for <code>=zero?</code> in the
corresponding packages:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock15"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">=zero?-scheme-number</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>= x 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put '=zero? '<span style="color: #7388d6;">(</span>scheme-number<span style="color: #7388d6;">)</span> =zero?-scheme-number<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">=zero?-complex</span> x y<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>= <span style="color: #909183;">(</span>magnitude x<span style="color: #909183;">)</span> 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put '=zero? '<span style="color: #7388d6;">(</span>complex<span style="color: #7388d6;">)</span> =zero?-complex<span style="color: #707183;">)</span>
</pre>
</div>

<p>
One could also imagine defining <code>=zero?</code> as a generic function
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">=zero?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>equ? x <span style="color: #909183;">(</span>zero x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
where <code>zero</code> is a function that returns a zero value of the type of
<code>x</code>. Assuming <code>equ?</code> properly equates zero values that have the same type but
different representations (e.g., for <code>rat</code> and <code>polar</code> numbers), the above
definition will work. However, this requires another operation to be defined
anyway, and makes it harder to override the <code>=zero?</code> operation per-type in the
event that such an override is desirable for efficiency or correctness.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline95" class="outline-4">
<h4 id="orgheadline95"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-18.html#%_sec_2.5.2">2.5.2: Combining Data of Different Types</a></h4>
<div class="outline-text-4" id="text-orgheadline95">
</div><div id="outline-container-orgheadline90" class="outline-5">
<h5 id="orgheadline90">Auxiliary definitions</h5>
<div class="outline-text-5" id="text-orgheadline90">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">*coercion-table*</span> <span style="color: #7388d6;">(</span>make-hash-table equal?<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">put-coercion</span> type-from type-to proc<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>hash-table-set!
   *coercion-table*
   <span style="color: #909183;">(</span>list type-from type-to<span style="color: #909183;">)</span>
   proc<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get-coercion</span> type-from type-to<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>hash-table-ref
   *coercion-table*
   <span style="color: #909183;">(</span>list type-from type-to<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline91" class="outline-5">
<h5 id="orgheadline91"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.81">Exercise 2.81.</a></h5>
<div class="outline-text-5" id="text-orgheadline91">
<ol class="org-ol">
<li>If <code>exp</code> is called with two <code>complex</code> numbers as arguments, <code>apply-generic</code>
will fail to find an implementation of <code>exp</code> for the arguments. However, it
will then find a coercion <code>complex-&gt;complex</code> for <code>t1-&gt;t2</code> and then re-apply
the <code>exp</code> operation with <code>t1-&gt;t2</code> applied to the first argument. Since this
applies <code>exp</code> once again to two <code>complex</code> arguments, Louis' conversions
will lead to an infinite loop.</li>

<li>Louis is not correct &#x2013; <code>apply-generic</code> works as is because it searches for
an implementation of the generic operation for the argument types given
before attempting coercion. If an implementation is found, coercion is
never attempted, so there is no need to provide a coercion operation from a
type to itself.</li>

<li><p>
From the above, it is clear that the only time <code>apply-generic</code> would look
for a conversion from a type to itself is when
</p>

<ul class="org-ul">
<li>The two arguments have the same type.</li>
<li>An implementation of the generic operation was not found.</li>
</ul>
<p>
Therefore, the only thing to do is to raise an error for the lack of an
implementation:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">apply-generic</span> op . args<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">no-method</span> op type-tags<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"No method for these types"</span>
           <span style="color: #709870;">(</span>list op type-tags<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>type-tags <span style="color: #907373;">(</span><span style="color: #a020f0;">map</span> type-tag args<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>proc <span style="color: #6276ba;">(</span>get op type-tags<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> proc
          <span style="color: #907373;">(</span>apply proc <span style="color: #6276ba;">(</span><span style="color: #a020f0;">map</span> contents args<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>= <span style="color: #858580;">(</span>length args<span style="color: #858580;">)</span> 2<span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">let</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>type1 <span style="color: #887070;">(</span>car type-tags<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>type2 <span style="color: #887070;">(</span>cadr type-tags<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>a1 <span style="color: #887070;">(</span>car args<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>a2 <span style="color: #887070;">(</span>cadr args<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span><span style="color: #a020f0;">if</span> <span style="color: #80a880;">(</span>equal? type1 type2<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>no-method op type-tags<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span><span style="color: #a020f0;">let</span> <span style="color: #887070;">(</span><span style="color: #707183;">(</span>t1-&gt;t2 <span style="color: #7388d6;">(</span>get-coercion type1 type2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                          <span style="color: #707183;">(</span>t2-&gt;t1 <span style="color: #7388d6;">(</span>get-coercion type2 type1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                      <span style="color: #887070;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #707183;">(</span>t1-&gt;t2
                             <span style="color: #7388d6;">(</span>apply-generic op <span style="color: #909183;">(</span>t1-&gt;t2 a1<span style="color: #909183;">)</span> a2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                            <span style="color: #707183;">(</span>t2-&gt;t1
                             <span style="color: #7388d6;">(</span>apply-generic op a1 <span style="color: #909183;">(</span>t2-&gt;t1 a2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                            <span style="color: #707183;">(</span><span style="color: #a020f0;">else</span>
                             <span style="color: #7388d6;">(</span>no-method op type-tags<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span>no-method op type-tags<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline92" class="outline-5">
<h5 id="orgheadline92"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.82">Exercise 2.82.</a></h5>
<div class="outline-text-5" id="text-orgheadline92">
<p>
Here's the steps:
</p>

<ul class="org-ul">
<li>First, test if the args are the proper types already for the operation. If
so, apply the op and return the result.</li>
<li>Else, we'll want to keep the list of arguments, as well as keep an index to
the current argument, whose type we want to coerce all the other arguments
to.</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">apply-generic</span> op . args<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">no-method</span> op type-tags<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"No method for these types"</span>
           <span style="color: #709870;">(</span>list op type-tags<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">attempt-coercion</span> tried to-try<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? to-try<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>no-method op <span style="color: #907373;">(</span><span style="color: #a020f0;">map</span> type-tag tried<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>current-arg <span style="color: #858580;">(</span>car to-try<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span>current-type <span style="color: #858580;">(</span>type-tag current-arg<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span>coerce-to-current
                  <span style="color: #858580;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #80a880;">(</span>x<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>get-coercion <span style="color: #707183;">(</span>type-tag x<span style="color: #707183;">)</span> current-type<span style="color: #887070;">)</span> x<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span>coerced-args
                  <span style="color: #858580;">(</span>append <span style="color: #80a880;">(</span><span style="color: #a020f0;">map</span> coerce-to-current tried<span style="color: #80a880;">)</span>
                          <span style="color: #80a880;">(</span>list current-arg<span style="color: #80a880;">)</span>
                          <span style="color: #80a880;">(</span><span style="color: #a020f0;">map</span> coerce-to-current <span style="color: #887070;">(</span>cdr to-try<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>/= <span style="color: #858580;">(</span>length coerced-args<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>length <span style="color: #80a880;">(</span>append tried to-try<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span>attempt-coercion <span style="color: #858580;">(</span>append tried <span style="color: #80a880;">(</span>list <span style="color: #887070;">(</span>car to-try<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                                <span style="color: #858580;">(</span>cdr to-try<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span>apply apply-generic op coerced-args<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>type-tags <span style="color: #907373;">(</span><span style="color: #a020f0;">map</span> type-tag args<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>proc <span style="color: #6276ba;">(</span>get op type-tags<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> proc
          <span style="color: #907373;">(</span>apply proc <span style="color: #6276ba;">(</span><span style="color: #a020f0;">map</span> contents args<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>attempt-coercion '<span style="color: #6276ba;">()</span> args<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
This procedure works for some simple cases. However, if
</p>

<ul class="org-ul">
<li>the arguments to <code>apply-generic</code> are not of the appropriate type for <code>op</code>,</li>
<li>one argument <code>t1</code> cannot be coerced to the type of another argument <code>t2</code>,</li>
<li>a coercion for <code>t1</code> exists such that the argument list is valid for <code>op</code>,</li>
</ul>

<p>
an appropriate coercion will not be found even though it exists.
</p>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-5">
<h5 id="orgheadline93"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.83">Exercise 2.83.</a></h5>
<div class="outline-text-5" id="text-orgheadline93">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Install these in the corresponding packages to implement the generic RAISE</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">operation.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">raise-integer-&gt;rational</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>make-rat x 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">raise-rational-&gt;real</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>/ <span style="color: #909183;">(</span>numer x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>denom x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">raise-real-&gt;complex</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>make-from-real-imag x 0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Raise over any numeric type</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">raise</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'raise x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline94" class="outline-5">
<h5 id="orgheadline94"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.84">Exercise 2.84.</a></h5>
<div class="outline-text-5" id="text-orgheadline94">
<p>
For simplicity, use the earlier two-argument version of <code>apply-generic</code>.
</p>

<p>
One simple way to extend the earlier <code>apply-generic</code> procedure is to first
attempt coercing the arguments as before
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">apply-generic</span> op . args<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">no-method</span> op type-tags<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"No method for these types"</span>
           <span style="color: #709870;">(</span>list op type-tags<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>type-tags <span style="color: #907373;">(</span><span style="color: #a020f0;">map</span> type-tag args<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>proc <span style="color: #6276ba;">(</span>get op type-tags<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> proc
          <span style="color: #907373;">(</span>apply proc <span style="color: #6276ba;">(</span><span style="color: #a020f0;">map</span> contents args<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>= <span style="color: #858580;">(</span>length args<span style="color: #858580;">)</span> 2<span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">let</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>type1 <span style="color: #887070;">(</span>car type-tags<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>type2 <span style="color: #887070;">(</span>cadr type-tags<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>a1 <span style="color: #887070;">(</span>car args<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>a2 <span style="color: #887070;">(</span>cadr args<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span><span style="color: #a020f0;">if</span> <span style="color: #80a880;">(</span>equal? type1 type2<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>no-method op type-tags<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span><span style="color: #a020f0;">let</span> <span style="color: #887070;">(</span><span style="color: #707183;">(</span>t1-&gt;t2 <span style="color: #7388d6;">(</span>get-coercion type1 type2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                          <span style="color: #707183;">(</span>t2-&gt;t1 <span style="color: #7388d6;">(</span>get-coercion type2 type1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                      <span style="color: #887070;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #707183;">(</span>t1-&gt;t2
                             <span style="color: #7388d6;">(</span>apply-generic op <span style="color: #909183;">(</span>t1-&gt;t2 a1<span style="color: #909183;">)</span> a2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                            <span style="color: #707183;">(</span>t2-&gt;t1
                             <span style="color: #7388d6;">(</span>apply-generic op a1 <span style="color: #909183;">(</span>t2-&gt;t1 a2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                            <span style="color: #707183;">(</span><span style="color: #a020f0;">else</span>
                             <span style="color: #7388d6;">(</span>no-method op type-tags<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span>no-method op type-tags<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline96" class="outline-4">
<h4 id="orgheadline96"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-18.html#%_sec_2.5.3">2.5.3: Example: Symbolic Algebra</a></h4>
<div class="outline-text-4" id="text-orgheadline96">
<p>
I've decided to distinguish dense and sparse polynomials with the <code>poly-dense</code>
and <code>poly-sparse</code> tags to allow keeping functions for both variants defined at
the same time. A similar distinction is made when defining auxiliary functions
for the two types before putting them in the dispatch table.
</p>
</div>

<div id="outline-container-orgheadline97" class="outline-5">
<h5 id="orgheadline97">Auxiliary definitions</h5>
<div class="outline-text-5" id="text-orgheadline97">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;procedures same-variable? and variable? from section 2.3.2&gt;</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"dispatch-table.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-zero.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-neg.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-reduce.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">variable?</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>symbol? x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">same-variable?</span> v1 v2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>variable? v1<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>variable? v2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? v1 v2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">install-poly-sparse-package</span><span style="color: #7388d6;">)</span>
  <span style="color: #228b22;">&lt;&lt;poly-sparse-basic-procs&gt;&gt;</span>

  <span style="color: #228b22;">&lt;&lt;poly-sparse-arithmetic-terms&gt;&gt;</span>

  <span style="color: #228b22;">&lt;&lt;poly-sparse-arithmetic-poly&gt;&gt;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">interface to rest of the system</span>
  <span style="color: #7388d6;">(</span>put 'make '<span style="color: #909183;">(</span>poly-sparse<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var terms<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>make-poly-sparse var terms<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  'done<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>install-poly-sparse-package<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-poly-sparse</span> var terms<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>get 'make '<span style="color: #709870;">(</span>poly-sparse<span style="color: #709870;">)</span><span style="color: #909183;">)</span> var terms<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock16"><span style="color: #b22222;">;; </span><span style="color: #b22222;">internal procedures</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">representation of poly</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-poly-sparse</span> variable term-list<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons variable term-list<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">variable</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">term-list</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;procedures same-variable? and variable? from section 2.3.2&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">variable?</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>symbol? x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">same-variable?</span> v1 v2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>variable? v1<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>variable? v2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? v1 v2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">representation of terms and term lists</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;procedures adjoin-term ...coeff from text below&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">adjoin-term</span> term term-list<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>=zero? <span style="color: #709870;">(</span>coeff term<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      term-list
      <span style="color: #909183;">(</span>cons term term-list<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">the-empty-termlist</span><span style="color: #7388d6;">)</span> '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">first-term</span> term-list<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car term-list<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">rest-terms</span> term-list<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr term-list<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">empty-termlist?</span> term-list<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>null? term-list<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-term</span> order coeff<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>list order coeff<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">order</span> term<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car term<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">coeff</span> term<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr term<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">tag</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>attach-tag 'poly-sparse p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock17"><span style="color: #228b22;">&lt;&lt;poly-sparse-add-terms&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;poly-sparse-sub-terms&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;poly-sparse-mul-terms&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;poly-sparse-div-terms&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-2-94-terms&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-2-96-improved-terms&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-2-96-reimproved-terms&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;poly-sparse-reduce-terms&gt;&gt;</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock18"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">add-terms</span> L1 L2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>empty-termlist? L1<span style="color: #709870;">)</span> L2<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>empty-termlist? L2<span style="color: #709870;">)</span> L1<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>t1 <span style="color: #858580;">(</span>first-term L1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>t2 <span style="color: #858580;">(</span>first-term L2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>&gt; <span style="color: #80a880;">(</span>order t1<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>order t2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>adjoin-term
                   t1 <span style="color: #80a880;">(</span>add-terms <span style="color: #887070;">(</span>rest-terms L1<span style="color: #887070;">)</span> L2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>&lt; <span style="color: #80a880;">(</span>order t1<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>order t2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>adjoin-term
                   t2 <span style="color: #80a880;">(</span>add-terms L1 <span style="color: #887070;">(</span>rest-terms L2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span>
                  <span style="color: #858580;">(</span>adjoin-term
                   <span style="color: #80a880;">(</span>make-term <span style="color: #887070;">(</span>order t1<span style="color: #887070;">)</span>
                              <span style="color: #887070;">(</span>add <span style="color: #707183;">(</span>coeff t1<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>coeff t2<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                   <span style="color: #80a880;">(</span>add-terms <span style="color: #887070;">(</span>rest-terms L1<span style="color: #887070;">)</span>
                              <span style="color: #887070;">(</span>rest-terms L2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock19"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">mul-terms</span> L1 L2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>empty-termlist? L1<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>the-empty-termlist<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>add-terms <span style="color: #709870;">(</span>mul-term-by-all-terms <span style="color: #907373;">(</span>first-term L1<span style="color: #907373;">)</span> L2<span style="color: #709870;">)</span>
                 <span style="color: #709870;">(</span>mul-terms <span style="color: #907373;">(</span>rest-terms L1<span style="color: #907373;">)</span> L2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">mul-term-by-all-terms</span> t1 L<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>empty-termlist? L<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>the-empty-termlist<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>t2 <span style="color: #6276ba;">(</span>first-term L<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>adjoin-term
         <span style="color: #907373;">(</span>make-term <span style="color: #6276ba;">(</span>+ <span style="color: #858580;">(</span>order t1<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>order t2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                    <span style="color: #6276ba;">(</span>mul <span style="color: #858580;">(</span>coeff t1<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>coeff t2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
         <span style="color: #907373;">(</span>mul-term-by-all-terms t1 <span style="color: #6276ba;">(</span>rest-terms L<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock20"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Arithmetic on polynomials in terms of arithmetic on their term lists.</span>
<span style="color: #228b22;">&lt;&lt;ex-2-87-zero&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">neg-poly-sparse</span> p<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>make-poly-sparse <span style="color: #909183;">(</span>variable p<span style="color: #909183;">)</span>
                    <span style="color: #909183;">(</span>neg-terms <span style="color: #709870;">(</span>term-list p<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'neg '<span style="color: #7388d6;">(</span>poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>neg-poly-sparse x<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">add-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>same-variable? <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>variable p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>make-poly-sparse <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span>
                        <span style="color: #709870;">(</span>add-terms <span style="color: #907373;">(</span>term-list p1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>term-list p2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"ADD-POLY -- cannot add two polynomials with different variables"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'add '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>add-poly-sparse x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">sub-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>add-poly-sparse p1 <span style="color: #909183;">(</span>neg-poly-sparse p2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'sub '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>sub-poly-sparse x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">mul-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>same-variable? <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>variable p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>make-poly-sparse <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span>
                        <span style="color: #709870;">(</span>mul-terms <span style="color: #907373;">(</span>term-list p1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>term-list p2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"MUL-POLY -- cannot multiply two polynomials with different variables"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'mul '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>mul-poly-sparse x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-2-91-div-poly-sparse&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-2-94-gcd-poly-sparse&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-2-96-improved-gcd-poly-sparse&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-2-96-reimproved-gcd-poly-sparse&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;poly-sparse-reduce&gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline98" class="outline-5">
<h5 id="orgheadline98"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.87">Exercise 2.87.</a></h5>
<div class="outline-text-5" id="text-orgheadline98">
<p>
Install <code>=zero?</code> for polynomials in the generic arithmetic package. This will
allow <code>adjoin-term</code> to work for polynomials with coefficients that are
themselves polynomials.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock21"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-zero.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">=zero?-poly-sparse</span> p<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">=zero?-terms</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>terms <span style="color: #907373;">(</span>term-list p<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">or</span> <span style="color: #709870;">(</span>empty-termlist? terms<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>=zero? <span style="color: #6276ba;">(</span>coeff <span style="color: #858580;">(</span>first-term terms<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
             <span style="color: #907373;">(</span>=zero?-terms <span style="color: #6276ba;">(</span>rest-terms terms<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put '=zero? 'poly-sparse =zero?-poly-sparse<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline99" class="outline-5">
<h5 id="orgheadline99"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.88">Exercise 2.88.</a></h5>
<div class="outline-text-5" id="text-orgheadline99">
<p>
We define subtraction in terms of negation. For this, it is useful to have a
generic negation function <code>neg</code>:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"dispatch-table.scm"</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-2-88-neg-monomial&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">neg</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'neg x<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock22"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">neg-complex</span> z<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>make-from-real-imag <span style="color: #909183;">(</span>- <span style="color: #709870;">(</span>real-part z<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                       <span style="color: #909183;">(</span>- <span style="color: #709870;">(</span>imag-part z<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'neg '<span style="color: #7388d6;">(</span>complex<span style="color: #7388d6;">)</span> neg-complex<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'neg '<span style="color: #7388d6;">(</span>scheme-number<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>attach-tag 'scheme-number <span style="color: #709870;">(</span>- x<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock23"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-neg.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">neg-terms</span> terms<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>empty-termlist? terms<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>the-empty-termlist<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>adjoin-term <span style="color: #709870;">(</span>make-term <span style="color: #907373;">(</span>order <span style="color: #6276ba;">(</span>first-term terms<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                              <span style="color: #907373;">(</span>neg <span style="color: #6276ba;">(</span>coeff <span style="color: #858580;">(</span>first-term terms<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>neg-terms <span style="color: #907373;">(</span>rest-terms terms<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">sub-terms</span> L1 L2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>add-terms L1 <span style="color: #909183;">(</span>neg-terms L2<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #228b22;">&lt;&lt;poly-sparse-basic-procs&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;poly-sparse-sub-terms&gt;&gt;</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>5 -3<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>3 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>neg-terms '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>5 3<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>3 -1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline100" class="outline-5">
<h5 id="orgheadline100"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.89">Exercise 2.89.</a></h5>
<div class="outline-text-5" id="text-orgheadline100">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">install-poly-dense-package</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">internal procedures</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">representation of poly</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">make-poly</span> variable term-list<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>cons variable term-list<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">variable</span> p<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>car p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">term-list</span> p<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>cdr p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;procedures same-variable? and variable? from section 2.3.2&gt;</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">variable?</span> x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>symbol? x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">same-variable?</span> v1 v2<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">and</span> <span style="color: #709870;">(</span>variable? v1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>variable? v2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>eq? v1 v2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">representation of terms and term lists</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;procedures adjoin-term ...coeff from text below&gt;</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">adjoin-term</span> term term-list<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>=zero? term<span style="color: #709870;">)</span>
        term-list
        <span style="color: #709870;">(</span>cons term term-list<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">the-empty-termlist</span><span style="color: #909183;">)</span> '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">first-term</span> term-list<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>car term-list<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">rest-terms</span> term-list<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>cdr term-list<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">empty-termlist?</span> term-list<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>null? term-list<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>

  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">add-poly</span> p1 p2<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>same-variable? <span style="color: #907373;">(</span>variable p1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>variable p2<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>make-poly <span style="color: #907373;">(</span>variable p1<span style="color: #907373;">)</span>
                   <span style="color: #907373;">(</span>add-terms <span style="color: #6276ba;">(</span>term-list p1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>term-list p2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"ADD-POLY -- cannot add two polynomials with different variables"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;procedures used by add-poly&gt;</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">add-terms</span> L1 L2<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span>rec <span style="color: #907373;">(</span>L1 L1<span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span>L2 L2<span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span>o1 <span style="color: #6276ba;">(</span>length L1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span>o2 <span style="color: #6276ba;">(</span>length L2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>empty-termlist? L1<span style="color: #6276ba;">)</span> L2<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>empty-termlist? L2<span style="color: #6276ba;">)</span> L1<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>&gt; o1 o2<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>adjoin-term <span style="color: #858580;">(</span>first-term L1<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>rec <span style="color: #80a880;">(</span>rest-terms L1<span style="color: #80a880;">)</span> L2 <span style="color: #80a880;">(</span>- o1 1<span style="color: #80a880;">)</span> o2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>&gt; o2 o1<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>adjoin-term <span style="color: #858580;">(</span>first-term L2<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>rec L1 <span style="color: #80a880;">(</span>rest-terms L2<span style="color: #80a880;">)</span> o1 <span style="color: #80a880;">(</span>- o2 1<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span>
             <span style="color: #6276ba;">(</span>adjoin-term <span style="color: #858580;">(</span>add <span style="color: #80a880;">(</span>first-term L1<span style="color: #80a880;">)</span>
                               <span style="color: #80a880;">(</span>first-term L2<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                          <span style="color: #858580;">(</span>rec <span style="color: #80a880;">(</span>rest-terms L1<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>rest-terms L2<span style="color: #80a880;">)</span>
                               <span style="color: #80a880;">(</span>- o1 1<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>- o2 1<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">mul-poly</span> p1 p2<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>same-variable? <span style="color: #907373;">(</span>variable p1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>variable p2<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>make-poly <span style="color: #907373;">(</span>variable p1<span style="color: #907373;">)</span>
                   <span style="color: #907373;">(</span>mul-terms <span style="color: #6276ba;">(</span>term-list p1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>term-list p2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"MUL-POLY -- cannot multiply two polynomials with different variables"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;procedures used by mul-poly&gt;</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">mul-terms</span> L1 L2<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span>rec <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>L1 L1<span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span>L2 L2<span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span>o1 <span style="color: #858580;">(</span>- <span style="color: #80a880;">(</span>length L1<span style="color: #80a880;">)</span> 1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>empty-termlist? L1<span style="color: #6276ba;">)</span>
                  <span style="color: #6276ba;">(</span>the-empty-termlist<span style="color: #6276ba;">)</span>
                  <span style="color: #6276ba;">(</span>add-terms <span style="color: #858580;">(</span>mul-term-by-all-terms <span style="color: #80a880;">(</span>first-term L1<span style="color: #80a880;">)</span> o1 L2<span style="color: #858580;">)</span>
                             <span style="color: #858580;">(</span>rec <span style="color: #80a880;">(</span>rest-terms L1<span style="color: #80a880;">)</span> L2 <span style="color: #80a880;">(</span>- o1 1<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">c1, o1 -- coefficient, order of term to be multiplied by term list L</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">First multiply terms by c1, then append a list of (+ o1 1) zeros to the</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">end of L to represent the multiplication by the inderminate variable</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">raised to the power of o1.</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">mul-term-by-all-terms</span> c1 o1 L<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">rec</span> c1 o1 L<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>empty-termlist? L<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>the-empty-termlist<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>t2 <span style="color: #80a880;">(</span>first-term L<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>adjoin-term
             <span style="color: #858580;">(</span>mul c1 t2<span style="color: #858580;">)</span>
             <span style="color: #858580;">(</span>rec c1 <span style="color: #80a880;">(</span>- o1 1<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>rest-terms L<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>append <span style="color: #709870;">(</span>rec t1 o1 L<span style="color: #709870;">)</span>
            <span style="color: #709870;">(</span>repeat 0 <span style="color: #907373;">(</span>+ o1 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">interface to rest of the system</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">tag</span> p<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>attach-tag 'poly-dense p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'add '<span style="color: #909183;">(</span>poly-dense poly-dense<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p1 p2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>add-poly p1 p2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'mul '<span style="color: #909183;">(</span>poly-dense poly-dense<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p1 p2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>mul-poly p1 p2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'make '<span style="color: #909183;">(</span>poly-dense<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var terms<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>make-poly var terms<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  'done<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline101" class="outline-5">
<h5 id="orgheadline101"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html%5C#%_thm_2.90">Exercise 2.90.</a></h5>
<div class="outline-text-5" id="text-orgheadline101">
<p>
We first want to define some coercions. I will use the <code>get-coercion</code> and
<code>put-coercion</code> interface for this.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"coercion-table.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">coerce-poly-sparse-&gt;poly-dense</span> p<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">coeff</span> t<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>car t<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">order</span> t<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>cdr t<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">tag</span> p<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>attach-tag 'poly-dense p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>terms <span style="color: #907373;">(</span>cdr p<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>var <span style="color: #907373;">(</span>car p<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>cons var
          <span style="color: #709870;">(</span>list
           <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span>rec <span style="color: #858580;">(</span>terms terms<span style="color: #858580;">)</span>
                     <span style="color: #858580;">(</span>o <span style="color: #80a880;">(</span>order <span style="color: #887070;">(</span>car terms<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>null? terms<span style="color: #80a880;">)</span>
                    '<span style="color: #80a880;">()</span><span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>&gt; o <span style="color: #887070;">(</span>order <span style="color: #707183;">(</span>car terms<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>cons <span style="color: #887070;">(</span>attach-tag 'scheme-number 0<span style="color: #887070;">)</span>
                          <span style="color: #887070;">(</span>rec terms <span style="color: #707183;">(</span>- o 1<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span><span style="color: #a020f0;">else</span>
                    <span style="color: #80a880;">(</span>cons <span style="color: #887070;">(</span>coeff <span style="color: #707183;">(</span>car terms<span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                          <span style="color: #887070;">(</span>rec terms <span style="color: #707183;">(</span>- o 1<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">coerce-poly-dense-&gt;poly-sparse</span> p<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">make-term</span> coeff order<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>cons coeff order<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">tag</span> p<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>attach-tag 'poly-dense p<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>terms <span style="color: #907373;">(</span>cdr p<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>var <span style="color: #907373;">(</span>car p<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>cons var
          <span style="color: #709870;">(</span>list
           <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span>rec <span style="color: #858580;">(</span>terms terms<span style="color: #858580;">)</span>
                     <span style="color: #858580;">(</span>o <span style="color: #80a880;">(</span>- <span style="color: #887070;">(</span>length terms<span style="color: #887070;">)</span> 1<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>null? terms<span style="color: #80a880;">)</span>
                    '<span style="color: #80a880;">()</span><span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>=zero? <span style="color: #887070;">(</span>car terms<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>rec <span style="color: #887070;">(</span>cdr terms<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>- o 1<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span><span style="color: #a020f0;">else</span>
                    <span style="color: #80a880;">(</span>cons <span style="color: #887070;">(</span>make-term <span style="color: #707183;">(</span>car terms<span style="color: #707183;">)</span> o<span style="color: #887070;">)</span>
                          <span style="color: #887070;">(</span>rec <span style="color: #707183;">(</span>cdr terms<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>- o 1<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put-coercion 'poly-sparse 'poly-dense coerce-poly-sparse-&gt;poly-dense<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put-coercion 'poly-dense 'poly-sparse coerce-poly-dense-&gt;poly-sparse<span style="color: #707183;">)</span>
</pre>
</div>

<p>
The idea here is to define a type <code>poly-generic</code>, whose contents we assume are
always another tagged value (of type <code>poly-sparse</code> or <code>poly-dense</code>, or perhaps
another representation that may be added in the future). Unfortunately, this
design requires manually coercing a <code>poly-generic</code> value to the underlying
representation, which is a major flaw the <code>complex</code> example doesn't have. This
arises because, unlike <code>complex</code>, there are no primitives provided for the
polynomial types below <code>add</code>, <code>sub</code>, etc. with which these procedures can be
implemented.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">install-poly-generic-package</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">tag</span> x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>attach-tag 'poly-generic x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'neg '<span style="color: #909183;">(</span>poly-generic<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>neg <span style="color: #6276ba;">(</span>contents p<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'add '<span style="color: #909183;">(</span>poly-generic poly-generic<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p1 p2<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>add <span style="color: #6276ba;">(</span>contents p1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>contents p2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'sub '<span style="color: #909183;">(</span>poly-generic poly-generic<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p1 p2<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>sub <span style="color: #6276ba;">(</span>contents p1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>contents p2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'mul '<span style="color: #909183;">(</span>poly-generic poly-generic<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>p1 p2<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>mul <span style="color: #6276ba;">(</span>contents p1<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>contents p2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'make '<span style="color: #909183;">(</span>poly-generic<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var terms<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>get 'poly-sparse 'make<span style="color: #6276ba;">)</span> var terms<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  'done<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline102" class="outline-5">
<h5 id="orgheadline102"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.91">Exercise 2.91.</a></h5>
<div class="outline-text-5" id="text-orgheadline102">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock24"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">div-terms</span> L1 L2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>empty-termlist? L1<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>the-empty-termlist<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>the-empty-termlist<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>t1 <span style="color: #6276ba;">(</span>first-term L1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>t2 <span style="color: #6276ba;">(</span>first-term L2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>&gt; <span style="color: #6276ba;">(</span>order t2<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>order t1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>list <span style="color: #6276ba;">(</span>the-empty-termlist<span style="color: #6276ba;">)</span> L1<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>new-c <span style="color: #80a880;">(</span>div <span style="color: #887070;">(</span>coeff t1<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>coeff t2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>new-o <span style="color: #80a880;">(</span>- <span style="color: #887070;">(</span>order t1<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>order t2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
              <span style="color: #6276ba;">(</span><span style="color: #a020f0;">let</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span>rest-of-result
                     <span style="color: #887070;">(</span>div-terms
                      <span style="color: #707183;">(</span>sub-terms L1
                                 <span style="color: #7388d6;">(</span>mul-terms <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>make-term new-o new-c<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                                            L2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                      L2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span>list <span style="color: #80a880;">(</span>adjoin-term <span style="color: #887070;">(</span>make-term new-o new-c<span style="color: #887070;">)</span>
                                   <span style="color: #887070;">(</span>list-ref rest-of-result 0<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                      <span style="color: #80a880;">(</span>list-ref rest-of-result 1<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock25"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">div-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>same-variable? <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span>
                      <span style="color: #709870;">(</span>variable p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>var <span style="color: #6276ba;">(</span>variable p1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               <span style="color: #907373;">(</span>result <span style="color: #6276ba;">(</span>div-terms <span style="color: #858580;">(</span>term-list p1<span style="color: #858580;">)</span>
                                  <span style="color: #858580;">(</span>term-list p2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               <span style="color: #907373;">(</span>quotient <span style="color: #6276ba;">(</span>list-ref result 0<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               <span style="color: #907373;">(</span>remainder <span style="color: #6276ba;">(</span>list-ref result 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>list <span style="color: #907373;">(</span>make-poly-sparse var quotient<span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span>make-poly-sparse var remainder<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"DIV-POLY-SPARSE -- division between different variables NYI"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'div '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>p1 p2<span style="color: #909183;">)</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">map</span> tag <span style="color: #709870;">(</span>div-poly-sparse p1 p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock26"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"poly-sparse-package.scm"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">tl1</span> '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>5 1<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>0 -1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">tl2</span> '<span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>2 1<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>0 -1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p1</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x tl1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p2</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x tl2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">result-quotient</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>3 1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">result-remainder</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>1 1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 -1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test <span style="color: #7388d6;">(</span>list result-quotient result-remainder<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span>div p1 p2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline103" class="outline-5">
<h5 id="orgheadline103"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.92">Exercise 2.92.</a></h5>
<div class="outline-text-5" id="text-orgheadline103">
<p>
Skipping.
</p>
</div>
</div>

<div id="outline-container-orgheadline104" class="outline-5">
<h5 id="orgheadline104"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.93">Exercise 2.93.</a></h5>
<div class="outline-text-5" id="text-orgheadline104">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"dispatch-table"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-zero"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"generic-neg"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">install-rational-package</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">internal procedures</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">numer</span> x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>list-ref x 0<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">denom</span> x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>list-ref x 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">make-rat</span> n d<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>list n d<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>

  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">=zero?-rat</span> x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">and</span> <span style="color: #709870;">(</span>= <span style="color: #907373;">(</span>numer x<span style="color: #907373;">)</span> 0<span style="color: #709870;">)</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">Denominator of 0 is undefined -- choose not to make such a number</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">equal to 0 even if the numerator is 0.</span>
         <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>= <span style="color: #6276ba;">(</span>denom x<span style="color: #6276ba;">)</span> 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">neg-rat</span> x<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>make-rat <span style="color: #709870;">(</span>neg <span style="color: #907373;">(</span>numer x<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>denom x<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">add-rat</span> x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>make-rat <span style="color: #709870;">(</span>add <span style="color: #907373;">(</span>mul <span style="color: #6276ba;">(</span>numer x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>denom y<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                   <span style="color: #907373;">(</span>mul <span style="color: #6276ba;">(</span>numer y<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>denom x<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>mul <span style="color: #907373;">(</span>denom x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>denom y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">sub-rat</span> x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>make-rat <span style="color: #709870;">(</span>sub <span style="color: #907373;">(</span>mul <span style="color: #6276ba;">(</span>numer x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>denom y<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                   <span style="color: #907373;">(</span>mul <span style="color: #6276ba;">(</span>numer y<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>denom x<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>mul <span style="color: #907373;">(</span>denom x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>denom y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">mul-rat</span> x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>make-rat <span style="color: #709870;">(</span>mul <span style="color: #907373;">(</span>numer x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>numer y<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>mul <span style="color: #907373;">(</span>denom x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>denom y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">div-rat</span> x y<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>make-rat <span style="color: #709870;">(</span>mul <span style="color: #907373;">(</span>numer x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>denom y<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>mul <span style="color: #907373;">(</span>denom x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>numer y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">interface to rest of the system</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">tag</span> x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>attach-tag 'rational x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put '=zero? '<span style="color: #909183;">(</span>rational<span style="color: #909183;">)</span> =zero?-rat<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'neg '<span style="color: #909183;">(</span>rational<span style="color: #909183;">)</span> neg-rat<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'add '<span style="color: #909183;">(</span>rational rational<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>add-rat x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'sub '<span style="color: #909183;">(</span>rational rational<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>sub-rat x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'mul '<span style="color: #909183;">(</span>rational rational<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>mul-rat x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put 'div '<span style="color: #909183;">(</span>rational rational<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>div-rat x y<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>

  <span style="color: #7388d6;">(</span>put 'make 'rational
       <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>n d<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>tag <span style="color: #907373;">(</span>make-rat n d<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  'done<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>install-rational-package<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-rational</span> n d<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>get 'make 'rational<span style="color: #909183;">)</span> n d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>


<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"poly-sparse-package"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"rational-package"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p1</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 1<span style="color: #709870;">)(</span>0 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p2</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>3 1<span style="color: #709870;">)(</span>0 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rf</span> <span style="color: #7388d6;">(</span>make-rational p2 p1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">result</span> <span style="color: #7388d6;">(</span>make-rational <span style="color: #909183;">(</span>make-poly-sparse 'x '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>5 2<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>3 2<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>2 2<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>0 2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                              <span style="color: #909183;">(</span>make-poly-sparse 'x '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>4 1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>2 2<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>0 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test result
      <span style="color: #7388d6;">(</span>add rf rf<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline105" class="outline-5">
<h5 id="orgheadline105"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.94">Exercise 2.94.</a></h5>
<div class="outline-text-5" id="text-orgheadline105">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock27"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">remainder-terms</span> L1 L2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>list-ref <span style="color: #909183;">(</span>div-terms L1 L2<span style="color: #909183;">)</span> 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">gcd-terms</span> a b<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>empty-termlist? b<span style="color: #909183;">)</span>
      a
      <span style="color: #909183;">(</span>gcd-terms b <span style="color: #709870;">(</span>remainder-terms a b<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock28"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">gcd-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>same-variable? <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span>
                      <span style="color: #709870;">(</span>variable p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>var <span style="color: #6276ba;">(</span>variable p1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               <span style="color: #907373;">(</span>result <span style="color: #6276ba;">(</span>gcd-terms <span style="color: #858580;">(</span>term-list p1<span style="color: #858580;">)</span>
                                  <span style="color: #858580;">(</span>term-list p2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>make-poly-sparse var result<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"GCD-POLY -- GCD between different variables NYI"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'greatest-common-divisor '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>gcd-poly-sparse x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"poly-sparse-package"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p1</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>4 1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>3 -1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>2 -2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p2</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>3 1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 -1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">gcd</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 -1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test gcd
      <span style="color: #7388d6;">(</span>apply-generic 'greatest-common-divisor p1 p2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline106" class="outline-5">
<h5 id="orgheadline106"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.95">Exercise 2.95.</a></h5>
<div class="outline-text-5" id="text-orgheadline106">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"poly-sparse-package"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p1</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 -2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p2</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 11<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 7<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p3</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>1 13<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 5<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">q1</span> <span style="color: #7388d6;">(</span>mul p1 p2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">q2</span> <span style="color: #7388d6;">(</span>mul p1 p3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">parameterize</span> <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>test-epsilon 0.01<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
              <span style="color: #7388d6;">(</span>test '<span style="color: #909183;">(</span>0 1.10004<span style="color: #909183;">)</span>
                    <span style="color: #909183;">(</span>caddr <span style="color: #709870;">(</span>apply-generic 'greatest-common-divisor q1 q2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline107" class="outline-5">
<h5 id="orgheadline107"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.96">Exercise 2.96.</a></h5>
<div class="outline-text-5" id="text-orgheadline107">
<ol class="org-ol">
<li>Pseudoremainder</li>
</ol>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock29"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">pseudoremainder-terms</span> L1 L2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>integerizing-factor <span style="color: #907373;">(</span>expt <span style="color: #6276ba;">(</span>coeff <span style="color: #858580;">(</span>first-term L2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                                      <span style="color: #6276ba;">(</span>+ 1 <span style="color: #858580;">(</span>- <span style="color: #80a880;">(</span>order <span style="color: #887070;">(</span>first-term L1<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                                              <span style="color: #80a880;">(</span>order <span style="color: #887070;">(</span>first-term L2<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>dividend <span style="color: #907373;">(</span>mul-terms L1 `<span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>0 ,integerizing-factor<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>list-ref <span style="color: #709870;">(</span>div-terms dividend L2<span style="color: #709870;">)</span> 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">improved-gcd-terms</span> a b<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>empty-termlist? b<span style="color: #909183;">)</span>
      a
      <span style="color: #909183;">(</span>gcd-terms b <span style="color: #709870;">(</span>pseudoremainder-terms a b<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock30"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">improved-gcd-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>same-variable? <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span>
                      <span style="color: #709870;">(</span>variable p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>var <span style="color: #6276ba;">(</span>variable p1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               <span style="color: #907373;">(</span>result <span style="color: #6276ba;">(</span>improved-gcd-terms <span style="color: #858580;">(</span>term-list p1<span style="color: #858580;">)</span>
                                           <span style="color: #858580;">(</span>term-list p2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>make-poly-sparse var result<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"GCD-POLY -- GCD between different variables NYI"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'improved-greatest-common-divisor '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>improved-gcd-poly-sparse x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>


<ol class="org-ol">
<li>Reduce to lowest terms</li>
</ol>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock31"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">gcd</span> a . terms<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">gcd-dyadic</span> a b<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>= b 0<span style="color: #709870;">)</span>
        a
        <span style="color: #709870;">(</span>gcd-dyadic b <span style="color: #907373;">(</span>remainder a b<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>fold gcd-dyadic 0 <span style="color: #909183;">(</span>append <span style="color: #709870;">(</span>list a<span style="color: #709870;">)</span> terms<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock32"><span style="color: #228b22;">&lt;&lt;ex-2-96-gcd-integer&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reimproved-gcd-terms</span> a b<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">rec</span> a b<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>empty-termlist? b<span style="color: #709870;">)</span>
        a
        <span style="color: #709870;">(</span>gcd-terms b <span style="color: #907373;">(</span>pseudoremainder-terms a b<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>gcd-terms-result <span style="color: #907373;">(</span>rec a b<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>common-coeff <span style="color: #907373;">(</span>apply gcd <span style="color: #6276ba;">(</span><span style="color: #a020f0;">map</span> coeff gcd-terms-result<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>div-terms gcd-terms-result <span style="color: #709870;">(</span>list <span style="color: #907373;">(</span>make-term 0 common-coeff<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock33"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reimproved-gcd-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>same-variable? <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span>
                      <span style="color: #709870;">(</span>variable p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>var <span style="color: #6276ba;">(</span>variable p1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               <span style="color: #907373;">(</span>result <span style="color: #6276ba;">(</span>reimproved-gcd-terms <span style="color: #858580;">(</span>term-list p1<span style="color: #858580;">)</span>
                                             <span style="color: #858580;">(</span>term-list p2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>make-poly-sparse var result<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"GCD-POLY -- GCD between different variables NYI"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'reimproved-greatest-common-divisor '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>reimproved-gcd-poly-sparse x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"poly-sparse-package"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p1</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 -2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p2</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 11<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 7<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p3</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>1 13<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 5<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">q1</span> <span style="color: #7388d6;">(</span>mul p1 p2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">q2</span> <span style="color: #7388d6;">(</span>mul p1 p3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">improved-result</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 1458<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 -2916<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 1458<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test improved-result
      <span style="color: #7388d6;">(</span>apply-generic 'improved-greatest-common-divisor q1 q2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">reimproved-result</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>1 -2<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>0 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test reimproved-result
      <span style="color: #7388d6;">(</span>apply-generic 'reimproved-greatest-common-divisor q1 q2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline108" class="outline-5">
<h5 id="orgheadline108"><a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-17.html#%_thm_2.97">Exercise 2.97.</a></h5>
<div class="outline-text-5" id="text-orgheadline108">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reduce-integers</span> n d<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>g <span style="color: #907373;">(</span>gcd n d<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>/ n g<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>/ d g<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reduce</span> n d<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>n d<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>apply-generic 'reduce n d<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock34"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reduce-terms</span> n d<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">scalar-terms</span> c<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>make-term 0 c<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #909183;">(</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Compute GCD of terms using code from Exercise 2.96</span>
           <span style="color: #709870;">(</span>gcd-n-d <span style="color: #907373;">(</span>reimproved-gcd-terms n d<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Multiply numerator and denominator by integerizing factor before</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">dividing both by GCD to ensure no noninteger coefficients are</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">introduced.</span>
           <span style="color: #709870;">(</span>integerizing-factor <span style="color: #907373;">(</span>expt <span style="color: #6276ba;">(</span>coeff <span style="color: #858580;">(</span>first-term gcd-n-d<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                                      <span style="color: #6276ba;">(</span>+ 1 <span style="color: #858580;">(</span>- <span style="color: #80a880;">(</span>max <span style="color: #887070;">(</span>order <span style="color: #707183;">(</span>first-term n<span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                                                   <span style="color: #887070;">(</span>order <span style="color: #707183;">(</span>first-term d<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                                              <span style="color: #80a880;">(</span>order <span style="color: #887070;">(</span>first-term gcd-n-d<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>n-integerized <span style="color: #907373;">(</span>mul-terms n <span style="color: #6276ba;">(</span>scalar-terms integerizing-factor<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>d-integerized <span style="color: #907373;">(</span>mul-terms d <span style="color: #6276ba;">(</span>scalar-terms integerizing-factor<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>n-reduced <span style="color: #907373;">(</span>div-terms n-integerized gcd-n-d<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>d-reduced <span style="color: #907373;">(</span>div-terms d-integerized gcd-n-d<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">begin</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Division by GCD of numerator and denominator should produce no</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">remainder by definition.</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">define</span> <span style="color: #907373;">(</span><span style="color: #0000ff;">quotient-terms</span> x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>list-ref x 0<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">define</span> <span style="color: #907373;">(</span><span style="color: #0000ff;">remainder-terms</span> x<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>list-ref x 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>assert <span style="color: #907373;">(</span>empty-termlist? <span style="color: #6276ba;">(</span>remainder-terms n-reduced<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>assert <span style="color: #907373;">(</span>empty-termlist? <span style="color: #6276ba;">(</span>remainder-terms d-reduced<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">letrec</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>gcd-coeffs <span style="color: #858580;">(</span>apply gcd <span style="color: #80a880;">(</span>append <span style="color: #887070;">(</span><span style="color: #a020f0;">map</span> coeff <span style="color: #707183;">(</span>quotient-terms n-reduced<span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                                              <span style="color: #887070;">(</span><span style="color: #a020f0;">map</span> coeff <span style="color: #707183;">(</span>quotient-terms d-reduced<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span>nn <span style="color: #858580;">(</span>div-terms n-reduced <span style="color: #80a880;">(</span>scalar-terms gcd-coeffs<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span>dd <span style="color: #858580;">(</span>div-terms d-reduced <span style="color: #80a880;">(</span>scalar-terms gcd-coeffs<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>list nn dd<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock35"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reduce-poly-sparse</span> p1 p2<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>same-variable? <span style="color: #709870;">(</span>variable p1<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>variable p2<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">map</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>p<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>make-poly-sparse <span style="color: #6276ba;">(</span>variable p1<span style="color: #6276ba;">)</span> p<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>reduce-terms <span style="color: #907373;">(</span>term-list p1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>term-list p2<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>error <span style="color: #8b2252;">"REDUCE-POLY -- cannot reduce two polynomials with different variables"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'reduce '<span style="color: #7388d6;">(</span>poly-sparse poly-sparse<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>tag <span style="color: #709870;">(</span>reduce-poly-sparse x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock36"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reduce-integers</span> n d<span style="color: #7388d6;">)</span>
  <span style="color: #228b22;">&lt;&lt;ex-2-96-gcd-integers&gt;&gt;</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>g <span style="color: #907373;">(</span>gcd n d<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>/ n g<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>/ d g<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>put 'reduce '<span style="color: #7388d6;">(</span>scheme-number scheme-number<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x y<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>attach-tag 'scheme-number <span style="color: #709870;">(</span>reduce-integers x y<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"dispatch-table.scm"</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-2-97-reduce-integers&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">reduce</span> x y<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>apply-generic 'reduce x y<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"poly-sparse-package"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"rational-package"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p1</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>1 1<span style="color: #709870;">)(</span>0 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p2</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>3 1<span style="color: #709870;">)(</span>0 -1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p3</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>1 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">p4</span> <span style="color: #7388d6;">(</span>make-poly-sparse 'x '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>2 1<span style="color: #709870;">)(</span>0 -1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rf1</span> <span style="color: #7388d6;">(</span>make-rational p1 p2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rf2</span> <span style="color: #7388d6;">(</span>make-rational p3 p4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">result</span> <span style="color: #7388d6;">(</span>make-rational <span style="color: #909183;">(</span>make-poly-sparse 'x '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>4 1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>3 1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>2 1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>1 -2<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>0 -1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                              <span style="color: #909183;">(</span>make-poly-sparse 'x '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>5 1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>3 -1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>2 -1<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>0 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test result
      <span style="color: #7388d6;">(</span>add rf1 rf2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Robert Irelan</p>
<p class="email">Email: <a href="mailto:rirelan@gmail.com">rirelan@gmail.com</a></p>
<p class="date">Created: 2015-08-28 Fri 08:19</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
