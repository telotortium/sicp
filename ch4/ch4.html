<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2015-10-05 Mon 16:05 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Structure and Interpretation of Computer Programs (SICP)</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Robert Irelan" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Structure and Interpretation of Computer Programs (SICP)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline122"><span class="todo nilTODO">TODO</span> Chapter 4: Metalinguistic Abstraction <code>[%]</code></a>
<ul>
<li><a href="#orgheadline1"><span class="todo nilTODO">TODO</span> 4.1: The Metacircular Evaluator <code>[28%]</code></a>
<ul>
<li><a href="#orgheadline2">Code</a></li>
<li><a href="#orgheadline5"><span class="done nilDONE">DONE</span> 4.1.1: The Core of the Evaluator <code>[2/2]</code></a>
<ul>
<li><a href="#orgheadline3"><span class="done nilDONE">DONE</span> Read SICP 4.1.1</a></li>
<li><a href="#orgheadline4"><span class="done nilDONE">DONE</span> Exercise 4.1</a></li>
</ul>
</li>
<li><a href="#orgheadline17"><span class="todo nilNEXT">NEXT</span> 4.1.2: Representing Expressions <code>[7/10]</code></a>
<ul>
<li><a href="#orgheadline6">Code</a></li>
<li><a href="#orgheadline7"><span class="done nilDONE">DONE</span> Read SICP 4.1.2</a></li>
<li><a href="#orgheadline8"><span class="done nilDONE">DONE</span> Exercise 4.2</a></li>
<li><a href="#orgheadline9"><span class="done nilDONE">DONE</span> Exercise 4.3</a></li>
<li><a href="#orgheadline10"><span class="done nilDONE">DONE</span> Exercise 4.4</a></li>
<li><a href="#orgheadline11"><span class="done nilDONE">DONE</span> Exercise 4.5</a></li>
<li><a href="#orgheadline12"><span class="done nilDONE">DONE</span> Exercise 4.6</a></li>
<li><a href="#orgheadline13"><span class="done nilDONE">DONE</span> Exercise 4.7</a></li>
<li><a href="#orgheadline14"><span class="todo nilNEXT">NEXT</span> Exercise 4.8</a></li>
<li><a href="#orgheadline15"><span class="todo nilNEXT">NEXT</span> Exercise 4.9</a></li>
<li><a href="#orgheadline16"><span class="todo nilNEXT">NEXT</span> Exercise 4.10</a></li>
</ul>
</li>
<li><a href="#orgheadline23"><span class="todo nilNEXT">NEXT</span> 4.1.3: Evaluator Data Structures <code>[3/4]</code></a>
<ul>
<li><a href="#orgheadline18">Code</a></li>
<li><a href="#orgheadline19"><span class="done nilDONE">DONE</span> Read SICP 4.1.3</a></li>
<li><a href="#orgheadline20"><span class="done nilDONE">DONE</span> Exercise 4.11</a></li>
<li><a href="#orgheadline21"><span class="done nilDONE">DONE</span> Exercise 4.12</a></li>
<li><a href="#orgheadline22"><span class="todo nilTODO">TODO</span> Exercise 4.13</a></li>
</ul>
</li>
<li><a href="#orgheadline27"><span class="done nilDONE">DONE</span> 4.1.4: Running the Evaluator as a Program <code>[2/2]</code></a>
<ul>
<li><a href="#orgheadline24">Code</a></li>
<li><a href="#orgheadline25"><span class="done nilDONE">DONE</span> Read SICP 4.1.4</a></li>
<li><a href="#orgheadline26"><span class="done nilDONE">DONE</span> Exercise 4.14</a></li>
</ul>
</li>
<li><a href="#orgheadline30"><span class="todo nilTODO">TODO</span> 4.1.5: Data as Programs <code>[1/2]</code></a>
<ul>
<li><a href="#orgheadline28"><span class="done nilDONE">DONE</span> Read SICP 4.1.5</a></li>
<li><a href="#orgheadline29"><span class="todo nilTODO">TODO</span> Exercise 4.15</a></li>
</ul>
</li>
<li><a href="#orgheadline38"><span class="todo nilTODO">TODO</span> 4.1.6: Internal Definitions <code>[/]</code></a>
<ul>
<li><a href="#orgheadline31"><span class="todo nilTODO">TODO</span> Read SICP 4.1.6</a></li>
<li><a href="#orgheadline32"><span class="todo nilTODO">TODO</span> Exercise 4.16</a></li>
<li><a href="#orgheadline33"><span class="todo nilTODO">TODO</span> Exercise 4.17</a></li>
<li><a href="#orgheadline34"><span class="todo nilTODO">TODO</span> Exercise 4.18</a></li>
<li><a href="#orgheadline35"><span class="todo nilTODO">TODO</span> Exercise 4.19</a></li>
<li><a href="#orgheadline36"><span class="todo nilTODO">TODO</span> Exercise 4.20</a></li>
<li><a href="#orgheadline37"><span class="todo nilTODO">TODO</span> Exercise 4.21</a></li>
</ul>
</li>
<li><a href="#orgheadline43"><span class="todo nilTODO">TODO</span> 4.1.7: Separating Syntactic Analysis from Execution <code>[0/4]</code></a>
<ul>
<li><a href="#orgheadline39"><span class="todo nilNEXT">NEXT</span> Read SICP 4.1.7</a></li>
<li><a href="#orgheadline40"><span class="todo nilNEXT">NEXT</span> Exercise 4.22</a></li>
<li><a href="#orgheadline41"><span class="todo nilTODO">TODO</span> Exercise 4.23</a></li>
<li><a href="#orgheadline42"><span class="todo nilTODO">TODO</span> Exercise 4.24</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline60"><span class="todo nilTODO">TODO</span> 4.2: Variations on a Scheme &#x2013; Lazy Evaluation <code>[%]</code></a>
<ul>
<li><a href="#orgheadline47"><span class="todo nilTODO">TODO</span> 4.2.1: Normal Order and Applicative Order <code>[/]</code></a>
<ul>
<li><a href="#orgheadline44"><span class="todo nilTODO">TODO</span> Read SICP 4.2.1</a></li>
<li><a href="#orgheadline45"><span class="todo nilTODO">TODO</span> Exercise 4.25</a></li>
<li><a href="#orgheadline46"><span class="todo nilTODO">TODO</span> Exercise 4.26</a></li>
</ul>
</li>
<li><a href="#orgheadline54"><span class="todo nilTODO">TODO</span> 4.2.2: An Interpreter with Lazy Evaluation <code>[/]</code></a>
<ul>
<li><a href="#orgheadline48"><span class="todo nilTODO">TODO</span> Read SICP 4.2.2</a></li>
<li><a href="#orgheadline49"><span class="todo nilTODO">TODO</span> Exercise 4.29</a></li>
<li><a href="#orgheadline50"><span class="todo nilTODO">TODO</span> Exercise 4.28</a></li>
<li><a href="#orgheadline51"><span class="todo nilTODO">TODO</span> Exercise 4.29</a></li>
<li><a href="#orgheadline52"><span class="todo nilTODO">TODO</span> Exercise 4.30</a></li>
<li><a href="#orgheadline53"><span class="todo nilTODO">TODO</span> Exercise 4.31</a></li>
</ul>
</li>
<li><a href="#orgheadline59"><span class="todo nilTODO">TODO</span> 4.2.3: Streams as Lazy Lists <code>[/]</code></a>
<ul>
<li><a href="#orgheadline55"><span class="todo nilTODO">TODO</span> Read SICP 4.2.3</a></li>
<li><a href="#orgheadline56"><span class="todo nilTODO">TODO</span> Exercise 4.32</a></li>
<li><a href="#orgheadline57"><span class="todo nilTODO">TODO</span> Exercise 4.33</a></li>
<li><a href="#orgheadline58"><span class="todo nilTODO">TODO</span> Exercise 4.34</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline87"><span class="todo nilTODO">TODO</span> 4.3: Variations on a Scheme &#x2013; Nondeterministic Computing <code>[%]</code></a>
<ul>
<li><a href="#orgheadline65"><span class="todo nilTODO">TODO</span> 4.3.1: Amb and Search <code>[3/4]</code></a>
<ul>
<li><a href="#orgheadline61"><span class="done nilDONE">DONE</span> Read SICP 4.3.1</a></li>
<li><a href="#orgheadline62"><span class="done nilDONE">DONE</span> Exercise 4.35</a></li>
<li><a href="#orgheadline63"><span class="todo nilTODO">TODO</span> Exercise 4.36</a></li>
<li><a href="#orgheadline64"><span class="done nilDONE">DONE</span> Exercise 4.37</a></li>
</ul>
</li>
<li><a href="#orgheadline79"><span class="todo nilTODO">TODO</span> 4.3.2: Examples of Nondeterministic Programs <code>[4/13]</code></a>
<ul>
<li><a href="#orgheadline66"><span class="done nilDONE">DONE</span> Read SICP 4.3.2</a></li>
<li><a href="#orgheadline67"><span class="todo nilTODO">TODO</span> Exercise 4.38</a></li>
<li><a href="#orgheadline68"><span class="todo nilTODO">TODO</span> Exercise 4.39</a></li>
<li><a href="#orgheadline69"><span class="done nilDONE">DONE</span> Exercise 4.40</a></li>
<li><a href="#orgheadline70"><span class="done nilDONE">DONE</span> Exercise 4.41</a></li>
<li><a href="#orgheadline71"><span class="done nilDONE">DONE</span> Exercise 4.42</a></li>
<li><a href="#orgheadline72"><span class="todo nilNEXT">NEXT</span> Exercise 4.43</a></li>
<li><a href="#orgheadline73"><span class="todo nilTODO">TODO</span> Exercise 4.44</a></li>
<li><a href="#orgheadline74"><span class="todo nilTODO">TODO</span> Exercise 4.45</a></li>
<li><a href="#orgheadline75"><span class="todo nilTODO">TODO</span> Exercise 4.46</a></li>
<li><a href="#orgheadline76"><span class="todo nilTODO">TODO</span> Exercise 4.47</a></li>
<li><a href="#orgheadline77"><span class="todo nilTODO">TODO</span> Exercise 4.48</a></li>
<li><a href="#orgheadline78"><span class="todo nilTODO">TODO</span> Exercise 4.49</a></li>
</ul>
</li>
<li><a href="#orgheadline86"><span class="todo nilTODO">TODO</span> 4.3.3: Implementing the Amb Evaluator <code>[/]</code></a>
<ul>
<li><a href="#orgheadline80"><span class="todo nilTODO">TODO</span> Read SICP 4.3.3</a></li>
<li><a href="#orgheadline81"><span class="todo nilTODO">TODO</span> Exercise 4.50</a></li>
<li><a href="#orgheadline82"><span class="todo nilTODO">TODO</span> Exercise 4.51</a></li>
<li><a href="#orgheadline83"><span class="todo nilTODO">TODO</span> Exercise 4.52</a></li>
<li><a href="#orgheadline84"><span class="todo nilTODO">TODO</span> Exercise 4.53</a></li>
<li><a href="#orgheadline85"><span class="todo nilTODO">TODO</span> Exercise 4.54</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline121"><span class="todo nilTODO">TODO</span> 4.4: Logic Programming <code>[%]</code></a>
<ul>
<li><a href="#orgheadline88"><span class="todo nilTODO">TODO</span> 4.4.1: Deductive Information Retrieval <code>[7/10]</code></a>
<ul>
<li><a href="#orgheadline89"><span class="done nilDONE">DONE</span> Read SICP 4.4.1</a></li>
<li><a href="#orgheadline90"><span class="done nilDONE">DONE</span> Exercise 4.55</a></li>
<li><a href="#orgheadline91"><span class="done nilDONE">DONE</span> Exercise 4.56</a></li>
<li><a href="#orgheadline92"><span class="done nilDONE">DONE</span> Exercise 4.57</a></li>
<li><a href="#orgheadline93"><span class="done nilDONE">DONE</span> Exercise 4.58</a></li>
<li><a href="#orgheadline94"><span class="done nilDONE">DONE</span> Exercise 4.59</a></li>
<li><a href="#orgheadline95"><span class="done nilDONE">DONE</span> Exercise 4.60</a></li>
<li><a href="#orgheadline96"><span class="todo nilTODO">TODO</span> Exercise 4.61</a></li>
<li><a href="#orgheadline97"><span class="todo nilTODO">TODO</span> Exercise 4.62</a></li>
<li><a href="#orgheadline98"><span class="todo nilTODO">TODO</span> Exercise 4.63</a></li>
</ul>
</li>
<li><a href="#orgheadline99"><span class="todo nilTODO">TODO</span> 4.4.2: How the Query System Works <code>[/]</code></a>
<ul>
<li><a href="#orgheadline100"><span class="todo nilTODO">TODO</span> Read SICP 4.4.2</a></li>
</ul>
</li>
<li><a href="#orgheadline108"><span class="todo nilTODO">TODO</span> 4.4.3: Is Logic Programming Mathematical Logic? <code>[/]</code></a>
<ul>
<li><a href="#orgheadline101"><span class="todo nilTODO">TODO</span> Read SICP 4.4.3</a></li>
<li><a href="#orgheadline102"><span class="todo nilTODO">TODO</span> Exercise 4.64</a></li>
<li><a href="#orgheadline103"><span class="todo nilTODO">TODO</span> Exercise 4.65</a></li>
<li><a href="#orgheadline104"><span class="todo nilTODO">TODO</span> Exercise 4.66</a></li>
<li><a href="#orgheadline105"><span class="todo nilTODO">TODO</span> Exercise 4.67</a></li>
<li><a href="#orgheadline106"><span class="todo nilTODO">TODO</span> Exercise 4.68</a></li>
<li><a href="#orgheadline107"><span class="todo nilTODO">TODO</span> Exercise 4.69</a></li>
</ul>
</li>
<li><a href="#orgheadline120"><span class="todo nilTODO">TODO</span> 4.4.4: Implementing the Query System <code>[/]</code></a>
<ul>
<li><a href="#orgheadline109"><span class="todo nilTODO">TODO</span> Read SICP 4.4.4</a></li>
<li><a href="#orgheadline110"><span class="todo nilTODO">TODO</span> Exercise 4.70</a></li>
<li><a href="#orgheadline111"><span class="todo nilTODO">TODO</span> Exercise 4.71</a></li>
<li><a href="#orgheadline112"><span class="todo nilTODO">TODO</span> Exercise 4.72</a></li>
<li><a href="#orgheadline113"><span class="todo nilTODO">TODO</span> Exercise 4.73</a></li>
<li><a href="#orgheadline114"><span class="todo nilTODO">TODO</span> Exercise 4.74</a></li>
<li><a href="#orgheadline115"><span class="todo nilTODO">TODO</span> Exercise 4.75</a></li>
<li><a href="#orgheadline116"><span class="todo nilTODO">TODO</span> Exercise 4.76</a></li>
<li><a href="#orgheadline117"><span class="todo nilTODO">TODO</span> Exercise 4.77</a></li>
<li><a href="#orgheadline118"><span class="todo nilTODO">TODO</span> Exercise 4.78</a></li>
<li><a href="#orgheadline119"><span class="todo nilTODO">TODO</span> Exercise 4.79</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline122" class="outline-2">
<h2 id="orgheadline122"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-25.html#%_chap_4">Chapter 4: Metalinguistic Abstraction</a> <code>[%]</code></h2>
<div class="outline-text-2" id="text-orgheadline122">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1">4.1: The Metacircular Evaluator</a> <code>[28%]</code></h3>
<div class="outline-text-3" id="text-orgheadline1">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-02-01 Sun 19:22] </span></span> <br  />
We seem to have a working evaluator now.</li>
</ul>
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-02-01 Sun 17:51] </span></span> <br  />
Will take a pass through this section to implement the entire evaluator before
doing more of the exercises.</li>
</ul>
</div>

<div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2">Code</h4>
<div class="outline-text-4" id="text-orgheadline2">
<p>
For convenience, put the entire metacircular interpreter here:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #228b22;">&lt;&lt;primitive-expressions&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;derived-expressions&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;evaluator-structs&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;evaluator-running&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;eval-sec-4-1&gt;&gt;</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
Main body of <code>eval</code>:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock1"><span style="color: #228b22;">&lt;&lt;eval-sec-4-1-aux&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-4-1</span> exp env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>self-evaluating? exp<span style="color: #709870;">)</span> exp<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>boolean-object? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>make-boolean-object exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>variable? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>lookup-variable-value exp env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>quoted? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>text-of-quotation exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>assignment? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>eval-assignment exp env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>definition? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>eval-definition exp env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>if? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>eval-if exp env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>lambda? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>make-procedure <span style="color: #907373;">(</span>lambda-parameters exp<span style="color: #907373;">)</span>
                         <span style="color: #907373;">(</span>lambda-body exp<span style="color: #907373;">)</span>
                         env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>begin? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>eval-sequence <span style="color: #907373;">(</span>begin-actions exp<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>cond? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>eval-4-1 <span style="color: #907373;">(</span>cond-&gt;if exp<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>application? exp<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>apply-4-1 <span style="color: #907373;">(</span>eval-4-1 <span style="color: #6276ba;">(</span>operator exp<span style="color: #6276ba;">)</span> env<span style="color: #907373;">)</span>
                    <span style="color: #907373;">(</span>list-of-values <span style="color: #6276ba;">(</span>operands exp<span style="color: #6276ba;">)</span> env<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Unknown expression type -- EVAL"</span> exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Auxiliary procedures:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock2"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">apply-4-1</span> procedure arguments<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>primitive-procedure? procedure<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>apply-primitive-procedure procedure arguments<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>compound-procedure? procedure<span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>eval-sequence
          <span style="color: #907373;">(</span>procedure-body procedure<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>extend-environment
           <span style="color: #6276ba;">(</span>procedure-parameters procedure<span style="color: #6276ba;">)</span>
           arguments
           <span style="color: #6276ba;">(</span>procedure-environment procedure<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span>
         <span style="color: #709870;">(</span>error
          <span style="color: #8b2252;">"Unknown procedure type -- APPLY-4-1"</span> procedure<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">list-of-values</span> exps env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>no-operands? exps<span style="color: #909183;">)</span>
      '<span style="color: #909183;">()</span>
      <span style="color: #909183;">(</span>cons <span style="color: #709870;">(</span>eval-4-1 <span style="color: #907373;">(</span>first-operand exps<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span>
            <span style="color: #709870;">(</span>list-of-values <span style="color: #907373;">(</span>rest-operands exps<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-if</span> exp env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>true? <span style="color: #709870;">(</span>eval-4-1 <span style="color: #907373;">(</span>if-predicate exp<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>if-consequent exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>if-alternative exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-sequence</span> exps env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>last-exp? exps<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>eval-4-1 <span style="color: #907373;">(</span>first-exp exps<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>eval-4-1 <span style="color: #907373;">(</span>first-exp exps<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>eval-sequence <span style="color: #907373;">(</span>rest-exps exps<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #228b22;">&lt;&lt;ex-4-4-eval-and-or&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-5-cond-recipient&gt;&gt;</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-assignment</span> exp env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>set-variable-value! <span style="color: #909183;">(</span>assignment-variable exp<span style="color: #909183;">)</span>
                       <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>assignment-value exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span>
                       env<span style="color: #7388d6;">)</span>
  'ok<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-definition</span> exp env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>define-variable! <span style="color: #909183;">(</span>definition-variable exp<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>definition-value exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span>
    env<span style="color: #7388d6;">)</span>
  'ok<span style="color: #707183;">)</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1.1">4.1.1: The Core of the Evaluator</a> <code>[2/2]</code></h4>
<div class="outline-text-4" id="text-orgheadline5">
</div><div id="outline-container-orgheadline3" class="outline-5">
<h5 id="orgheadline3"><span class="done DONE">DONE</span> Read SICP 4.1.1</h5>
<div class="outline-text-5" id="text-orgheadline3">
<p>
:Effort:   0:15
</p>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-5">
<h5 id="orgheadline4"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.1">Exercise 4.1</a></h5>
<div class="outline-text-5" id="text-orgheadline4">
<p>
In the original version of the <code>list-of-values</code> procedure (shown here),
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">list-of-values</span> exps env<span style="color: #7388d6;">)</span>
<span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>no-operands? exps<span style="color: #909183;">)</span>
    '<span style="color: #909183;">()</span>
    <span style="color: #909183;">(</span>cons <span style="color: #709870;">(</span>eval-4-1 <span style="color: #907373;">(</span>first-operand exps<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>list-of-values <span style="color: #907373;">(</span>rest-operands exps<span style="color: #907373;">)</span> env<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
whether the first or the rest of the operands of the list is evaluated
first depends on the evaluation order of the underlying
Lisp. Specifically, if the Lisp evaluates from left to right,
<code>first-operand</code> will be called before <code>rest-operands</code>; if the Lisp
evaluates from right to left, <code>rest-operands</code> is instead called first,
producing a right-to-left evaluating version of <code>list-of-values</code>.
</p>

<p>
To guarantee the order of execution, one can take advantage of the fact
that the <code>begin</code> form is guaranteed to evaluate its arguments in order to
write both an explicitly left-to-right version
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">list-of-values</span> exps env<span style="color: #7388d6;">)</span>
<span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>no-operands? exps<span style="color: #909183;">)</span>
    '<span style="color: #909183;">()</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">begin</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">First evaluate the leftmost expression, then the rest of the</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">expression on the right.</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">first-expr</span> <span style="color: #907373;">(</span>eval-4-1 <span style="color: #6276ba;">(</span>first-operand exps<span style="color: #6276ba;">)</span> env<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rest-expr</span> <span style="color: #907373;">(</span>list-of-values <span style="color: #6276ba;">(</span>rest-operands exps<span style="color: #6276ba;">)</span> env<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>cons first-expr rest-expr<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
and a right-to-left version:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">list-of-values</span> exps env<span style="color: #7388d6;">)</span>
<span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>no-operands? exps<span style="color: #909183;">)</span>
    '<span style="color: #909183;">()</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">begin</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">First evaluate the expressions on the right, then the leftmost</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">expression.</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rest-expr</span> <span style="color: #907373;">(</span>list-of-values <span style="color: #6276ba;">(</span>rest-operands exps<span style="color: #6276ba;">)</span> env<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">first-expr</span> <span style="color: #907373;">(</span>eval-4-1 <span style="color: #6276ba;">(</span>first-operand exps<span style="color: #6276ba;">)</span> env<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>cons first-expr rest-expr<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Test to confirm:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"interp-sec-4-1"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Override EVAL for ease of testing</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">*test-list*</span> '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">eval-4-1</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>expr env<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">set!</span> *test-list* <span style="color: #709870;">(</span>append *test-list* <span style="color: #907373;">(</span>list expr<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">input-list</span> '<span style="color: #7388d6;">(</span>0 1 2 3 4 5<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-1-ltr"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> *test-list* '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>list-of-values input-list '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>0 1 2 3 4 5<span style="color: #7388d6;">)</span> *test-list*<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-1-rtl"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">set!</span> *test-list* '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>list-of-values input-list '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>5 4 3 2 1 0<span style="color: #7388d6;">)</span> *test-list*<span style="color: #707183;">)</span>
</pre>
</div>

<p>
:Effort:   0:30
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="todo NEXT">NEXT</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1.2">4.1.2: Representing Expressions</a> <code>[7/10]</code></h4>
<div class="outline-text-4" id="text-orgheadline17">
</div><div id="outline-container-orgheadline6" class="outline-5">
<h5 id="orgheadline6">Code</h5>
<div class="outline-text-5" id="text-orgheadline6">
<p>
Here's the code for the basic constructs of the interpreter, as defined in
the text:
</p>

<ul class="org-ul">
<li><p>
Primitive expressions:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock3"><span style="color: #228b22;">&lt;&lt;self-evaluating&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;booleans&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;variables&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;quotations&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;assignments&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;definitions&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;lambda-expressions&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;conditionals&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;sequences&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;procedure-application&gt;&gt;</span>
</pre>
</div></li>

<li><p>
Self-evaluating items:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock4"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">self-evaluating?</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>number? exp<span style="color: #709870;">)</span> #t<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>string? exp<span style="color: #709870;">)</span> #t<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>boolean? exp<span style="color: #709870;">)</span> #t<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> #f<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Boolean:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock5"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">boolean-object?</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">or</span> <span style="color: #909183;">(</span>eq? exp #t<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? exp #f<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-boolean-object</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>eq? exp #t<span style="color: #709870;">)</span> true<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>eq? exp #f<span style="color: #709870;">)</span> false<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"MAKE-BOOLEAN -- passed non-boolean"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Variables:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock6"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">variable?</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>symbol? exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Quotations:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock7"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">quoted?</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>tagged-list? exp 'quote<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">text-of-quotation</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">tagged-list?</span> exp tag<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>pair? exp<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>eq? <span style="color: #709870;">(</span>car exp<span style="color: #709870;">)</span> tag<span style="color: #909183;">)</span>
      #f<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Assignments:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock8"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">assignment?</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>tagged-list? exp 'set!<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">assignment-variable</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">assignment-value</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>Definitions:</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock9"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">definition?</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>tagged-list? exp 'define<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">definition-variable</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>symbol? <span style="color: #709870;">(</span>cadr exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>cadr exp<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>caadr exp<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">definition-value</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>symbol? <span style="color: #709870;">(</span>cadr exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>caddr exp<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>make-lambda <span style="color: #709870;">(</span>cdadr exp<span style="color: #709870;">)</span>   <span style="color: #b22222;">; </span><span style="color: #b22222;">formal parameters</span>
                   <span style="color: #709870;">(</span>cddr exp<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> <span style="color: #b22222;">; </span><span style="color: #b22222;">body</span>
</pre>
</div>

<ul class="org-ul">
<li>Lambda expressions:</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock10"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lambda?</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>tagged-list? exp 'lambda<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lambda-parameters</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lambda-body</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cddr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-lambda</span> parameters body<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons 'lambda <span style="color: #909183;">(</span>cons parameters body<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Conditionals:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock11"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">if?</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>tagged-list? exp 'if<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">if-predicate</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">if-consequent</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">if-alternative</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span>null? <span style="color: #907373;">(</span>cdddr exp<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>cadddr exp<span style="color: #909183;">)</span>
      'false<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-if</span> predicate consequent alternative<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>list 'if predicate consequent alternative<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Sequences:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock12"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">begin?</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>tagged-list? exp 'begin<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">begin-actions</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">last-exp?</span> seq<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>null? <span style="color: #909183;">(</span>cdr seq<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">first-exp</span> seq<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car seq<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">rest-exps</span> seq<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr seq<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">sequence-&gt;exp</span> seq<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>null? seq<span style="color: #709870;">)</span> seq<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>last-exp? seq<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>first-exp seq<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>make-begin seq<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-begin</span> seq<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cons 'begin seq<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Procedure application:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock13"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">application?</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>pair? exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">operator</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">operands</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">no-operands?</span> ops<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>null? ops<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">first-operand</span> ops<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car ops<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">rest-operands</span> ops<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr ops<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>Derived expressions:</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock14"><span style="color: #228b22;">&lt;&lt;derived-expressions-cond&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;derived-expressions-let&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;derived-expressions-while&gt;&gt;</span>
</pre>
</div>

<ul class="org-ul">
<li><code>cond</code>:</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock15"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond?</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>tagged-list? exp 'cond<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-clauses</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-else-clause?</span> clause<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>eq? <span style="color: #909183;">(</span>cond-predicate clause<span style="color: #909183;">)</span> 'else<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-predicate</span> clause<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car clause<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-actions</span> clause<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr clause<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-&gt;if</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>expand-clauses <span style="color: #909183;">(</span>cond-clauses exp<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">expand-clauses</span> clauses<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? clauses<span style="color: #909183;">)</span>
      'false                          <span style="color: #b22222;">; </span><span style="color: #b22222;">no else clause</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>first <span style="color: #6276ba;">(</span>car clauses<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>rest <span style="color: #6276ba;">(</span>cdr clauses<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>cond-else-clause? first<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>null? rest<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span>sequence-&gt;exp <span style="color: #858580;">(</span>cond-actions first<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span>error <span style="color: #8b2252;">"ELSE clause isn't last -- COND-&gt;IF"</span>
                       clauses<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>make-if <span style="color: #6276ba;">(</span>cond-predicate first<span style="color: #6276ba;">)</span>
                     <span style="color: #6276ba;">(</span>sequence-&gt;exp <span style="color: #858580;">(</span>cond-actions first<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                     <span style="color: #6276ba;">(</span>expand-clauses rest<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<ul class="org-ul">
<li><code>let</code>:</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock16"><span style="color: #228b22;">&lt;&lt;ex-4-7-let-star&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-8-let-named&gt;&gt;</span>
</pre>
</div>

<ul class="org-ul">
<li><code>while</code>:</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock17"><span style="color: #228b22;">&lt;&lt;ex-4-9-while&gt;&gt;</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-5">
<h5 id="orgheadline7"><span class="done DONE">DONE</span> Read SICP 4.1.2</h5>
<div class="outline-text-5" id="text-orgheadline7">
<p>
:Effort:   0:15
</p>
</div>
</div>
<div id="outline-container-orgheadline8" class="outline-5">
<h5 id="orgheadline8"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.2">Exercise 4.2</a></h5>
<div class="outline-text-5" id="text-orgheadline8">
<ul class="org-ul">
<li>Louis' modification to the interpreter will fail if the operator is a</li>
</ul>
<p>
special form rather than a function that can be applied, since the
arguments to special forms might need to be evaluated in a different
manner from those to normal procedures. For example, if Louis' <code>eval</code> is
called on <code>(define x 3)</code>, it will evaluate <code>x</code> to its value, rather than
treating <code>x</code> as the assignment target.
</p>

<ul class="org-ul">
<li>In order to make Louis' plan work, we need to eliminate the ambiguity</li>
</ul>
<p>
between special forms and ordinary procedures in the syntax. One simple
way to do this is to denote procedure application by the special form
<code>call</code>. This can be accomplished by the following modification to the
interpreter:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">application?</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? exp<span style="color: #909183;">)</span>
       <span style="color: #909183;">(</span>tagged-list? exp 'call<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">operator</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">operands</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cddr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
:Effort:   0:15
</p>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-5">
<h5 id="orgheadline9"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.3">Exercise 4.3</a></h5>
<div class="outline-text-5" id="text-orgheadline9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> srfi-69<span style="color: #707183;">)</span>                           <span style="color: #b22222;">; </span><span style="color: #b22222;">Import hash table procs</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">put</span> table op type proc<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>hash-table-set! table <span style="color: #909183;">(</span>cons op type<span style="color: #909183;">)</span> proc<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get</span> table op type<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>hash-table-ref/default table <span style="color: #909183;">(</span>cons op type<span style="color: #909183;">)</span> '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #228b22;">&lt;&lt;primitive-expressions&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;derived-expressions&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;evaluator-structs&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;evaluator-running&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;eval-sec-4-1-aux&gt;&gt;</span>

<span style="color: #707183;">(</span>include <span style="color: #8b2252;">"symbol-table"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">*eval-4-1-op-table*</span> <span style="color: #7388d6;">(</span>make-parameter <span style="color: #909183;">(</span>make-hash-table equal?<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-4-1-get</span> type<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>get <span style="color: #909183;">(</span>*eval-4-1-op-table*<span style="color: #909183;">)</span> 'eval type<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-4-1-put</span> type proc<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>put <span style="color: #909183;">(</span>*eval-4-1-op-table*<span style="color: #909183;">)</span> 'eval type proc<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-4-1</span> exp env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>self-evaluating? exp<span style="color: #709870;">)</span> exp<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>variable? exp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>lookup-variable-value exp env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>method <span style="color: #858580;">(</span>eval-4-1-get <span style="color: #80a880;">(</span>car exp<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>null? method<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                       <span style="color: #858580;">(</span>method exp env<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                      <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>application? exp<span style="color: #858580;">)</span>
                       <span style="color: #858580;">(</span>apply-4-1 <span style="color: #80a880;">(</span>eval-4-1 <span style="color: #887070;">(</span>operator exp<span style="color: #887070;">)</span> env<span style="color: #80a880;">)</span>
                                  <span style="color: #80a880;">(</span>list-of-values <span style="color: #887070;">(</span>operands exp<span style="color: #887070;">)</span> env<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                      <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span>
                       <span style="color: #858580;">(</span>error <span style="color: #8b2252;">"Unknown expression type: EVAL"</span> exp<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>eval-4-1-put 'quote
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>text-of-quotation exp<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>eval-4-1-put 'set!
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-assignment exp env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>eval-4-1-put 'define
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-definition exp env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>eval-4-1-put 'if
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-if exp env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>eval-4-1-put 'lambda
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>make-procedure <span style="color: #709870;">(</span>lambda-parameters exp<span style="color: #709870;">)</span>
                                <span style="color: #709870;">(</span>lambda-body exp<span style="color: #709870;">)</span>
                                env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>eval-4-1-put 'begin
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-sequence <span style="color: #709870;">(</span>begin-actions exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>eval-4-1-put 'cond
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>cond-&gt;if exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #228b22;">&lt;&lt;ex-4-4-eval-and-or-dispatch&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-5-cond-recipient-dispatch&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-7-let-star-dispatch&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-8-let-named-dispatch&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-9-while-dispatch&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-13-make-unbound-dispatch&gt;&gt;</span>
</pre>
</div>

<p>
:Effort:   0:30
</p>
</div>
</div>
<div id="outline-container-orgheadline10" class="outline-5">
<h5 id="orgheadline10"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.4">Exercise 4.4</a></h5>
<div class="outline-text-5" id="text-orgheadline10">
<p>
We implement these short-circuiting special forms by iterating down the list:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock18"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-and</span> exps env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? exps<span style="color: #909183;">)</span>
      true
      <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>first <span style="color: #6276ba;">(</span>first-exp exps<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>last-exp? exps<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>eval-4-1 first env<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                 <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>true? first<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> false<span style="color: #907373;">)</span>
                 <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>eval-and <span style="color: #858580;">(</span>rest-exps exps<span style="color: #858580;">)</span> env<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-or</span> exps env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? exps<span style="color: #909183;">)</span>
      false
      <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>first <span style="color: #6276ba;">(</span>first-exp exps<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>true? first<span style="color: #6276ba;">)</span> first<span style="color: #907373;">)</span>
                 <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>eval-or <span style="color: #858580;">(</span>rest-exps exps<span style="color: #858580;">)</span> env<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Just add them to the data-dispatch interpreter like so:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock19"><span style="color: #707183;">(</span>eval-4-1-put 'and
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-and exp env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>eval-4-1-put 'or
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-or exp env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Here's a short test to ensure that they work:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-3"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test #t <span style="color: #7388d6;">(</span>eval-4-1 '<span style="color: #909183;">(</span><span style="color: #a020f0;">and</span><span style="color: #909183;">)</span> '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
:Effort:   0:15
</p>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-5">
<h5 id="orgheadline11"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.5">Exercise 4.5</a></h5>
<div class="outline-text-5" id="text-orgheadline11">
<p>
Let's desugar <code>cond</code> expressions. The ordinary <code>cond</code> can be desugared to a
chain of if-elses:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #7388d6;">(</span>a b<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>c d<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">else</span> e<span style="color: #7388d6;">)</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Equivalent to (if a b (if c d e))</span>
      <span style="color: #707183;">)</span>
</pre>
</div>

<p>
The <code>cond</code> with recipient is a little more complex. The result of evaluating
the test needs to be referred to twice, once to determine which branch to take
and once to pass to the procedure evaluated if the "true" branch is
taken. In order to make sure no variables in the test, the recipient, or the
alternate shadow each other, use &alpha;-conversion to convert an if-statement of
expressions into a lambda taking these expressions as arguments. Since Scheme
is lexically scoped, the bindings in the lambda will not shadow any bindings
inside the arguments:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #7388d6;">(</span>a =&gt; proc<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">else</span> b<span style="color: #7388d6;">)</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Equivalent to (if a (proc a) b)</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Equivalent to ((lambda (x y p) (if x (p x) y)) a b proc)</span>
      <span style="color: #707183;">)</span>
</pre>
</div>

<p>
With this realization, it's possible to transform this extended form of <code>cond</code>
into a chain of <code>if</code> statements without using the environment.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock20"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond?</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>tagged-list? exp 'cond<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-clauses</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-else-clause?</span> clause<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>eq? <span style="color: #909183;">(</span>cond-predicate clause<span style="color: #909183;">)</span> 'else<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-recipient-clause?</span> clause<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>eq? <span style="color: #909183;">(</span>cadr clause<span style="color: #909183;">)</span> '=&gt;<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-predicate</span> clause<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car clause<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-actions</span> clause<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr clause<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">cond-&gt;if</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>expand-clauses <span style="color: #909183;">(</span>cond-clauses exp<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">expand-clauses</span> clauses<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>null? clauses<span style="color: #909183;">)</span>
      'false                          <span style="color: #b22222;">; </span><span style="color: #b22222;">no else clause</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>first <span style="color: #6276ba;">(</span>car clauses<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>rest <span style="color: #6276ba;">(</span>cdr clauses<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>cond-else-clause? first<span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span>null? rest<span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span>sequence-&gt;exp <span style="color: #80a880;">(</span>cond-actions first<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                   <span style="color: #858580;">(</span>error <span style="color: #8b2252;">"ELSE clause isn't last -- COND-&gt;IF"</span>
                          clauses<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>cond-recipient-clause? first<span style="color: #6276ba;">)</span>
               `<span style="color: #6276ba;">(</span>,<span style="color: #858580;">(</span>make-lambda
                   '<span style="color: #80a880;">(</span>test recipient alternate<span style="color: #80a880;">)</span>
                   `<span style="color: #80a880;">(</span>,<span style="color: #887070;">(</span>make-if 'test '<span style="color: #707183;">(</span>recipient test<span style="color: #707183;">)</span> 'alternate<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 ,<span style="color: #858580;">(</span>car first<span style="color: #858580;">)</span> ,<span style="color: #858580;">(</span>caddr first<span style="color: #858580;">)</span> ,<span style="color: #858580;">(</span>expand-clauses rest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>make-if <span style="color: #858580;">(</span>cond-predicate first<span style="color: #858580;">)</span>
                             <span style="color: #858580;">(</span>sequence-&gt;exp <span style="color: #80a880;">(</span>cond-actions first<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                             <span style="color: #858580;">(</span>expand-clauses rest<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock21"><span style="color: #707183;">(</span>eval-4-1-put 'cond
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>cond-&gt;if exp<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
:Effort:   0:30
</p>
</div>
</div>
<div id="outline-container-orgheadline12" class="outline-5">
<h5 id="orgheadline12"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.6">Exercise 4.6</a></h5>
<div class="outline-text-5" id="text-orgheadline12">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock22"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> srfi-1<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">let-&gt;combination</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>clauses <span style="color: #907373;">(</span>cdr exp<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>bindings <span style="color: #907373;">(</span>car clauses<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>body <span style="color: #907373;">(</span>cdr clauses<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #709870;">(</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Partition list of bindings ((a 1) (b 2) ...) into a pair of a</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">parameter list and an argument list ((a b ...) . (1 2 ...)).</span>
           <span style="color: #907373;">(</span>res <span style="color: #6276ba;">(</span>fold-right
                 <span style="color: #858580;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #80a880;">(</span>e ls<span style="color: #80a880;">)</span>
                   <span style="color: #80a880;">(</span>cons
                    <span style="color: #887070;">(</span>cons <span style="color: #707183;">(</span>car e<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>car ls<span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                    <span style="color: #887070;">(</span>cons <span style="color: #707183;">(</span>cadr e<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>cdr ls<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 '<span style="color: #858580;">(</span><span style="color: #80a880;">()</span> . <span style="color: #80a880;">()</span><span style="color: #858580;">)</span>
                 bindings<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>params <span style="color: #6276ba;">(</span>car res<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>args <span style="color: #6276ba;">(</span>cdr res<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      `<span style="color: #709870;">(</span>,<span style="color: #907373;">(</span>make-lambda params body<span style="color: #907373;">)</span>
        ,@args<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock23"><span style="color: #707183;">(</span>eval-4-1-put 'let
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>let-&gt;combination exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-3"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">test-group</span> <span style="color: #8b2252;">"test-4-6"</span>
            <span style="color: #7388d6;">(</span>test 5
                  <span style="color: #909183;">(</span>eval-4-1 '<span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>x 2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">(</span>+ x 3<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>setup-environment<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
:Effort:   0:30
</p>
</div>
</div>
<div id="outline-container-orgheadline13" class="outline-5">
<h5 id="orgheadline13"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.7">Exercise 4.7</a></h5>
<div class="outline-text-5" id="text-orgheadline13">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock24"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> srfi-1<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">let*-&gt;nested-lets</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>clauses <span style="color: #907373;">(</span>cdr exp<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>bindings <span style="color: #907373;">(</span>car clauses<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>body <span style="color: #907373;">(</span>cdr clauses<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">The let expressions must be wrapped in parentheses, while the body must</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">be spliced into the innermost let clause. However, the recursion below</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">doesn't allow the body to be spliced in, since that would require</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">looking ahead past the current binding. So we wrap the generated let</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">expressions in an extra pair of parentheses and splice in all results of</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">ITER, making BODY spliced in but the LET expressions still wrapped in</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">parentheses at the end. Finally, we need to remove the outermost layer</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">of parentheses with the CAR.</span>
    <span style="color: #909183;">(</span>car
     <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">iter</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>bindings bindings<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>null? bindings<span style="color: #6276ba;">)</span>
           body
           `<span style="color: #6276ba;">(</span><span style="color: #858580;">(</span><span style="color: #a020f0;">let</span> <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>,<span style="color: #707183;">(</span>caar bindings<span style="color: #707183;">)</span> ,<span style="color: #707183;">(</span>cadar bindings<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
               ,@<span style="color: #80a880;">(</span>iter <span style="color: #887070;">(</span>cdr bindings<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock25"><span style="color: #707183;">(</span>eval-4-1-put 'let*
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>let*-&gt;nested-lets exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-3"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">test-group</span> <span style="color: #8b2252;">"test-4-7"</span>
            <span style="color: #7388d6;">(</span>test 9
                  <span style="color: #909183;">(</span>eval-4-1 '<span style="color: #709870;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>x 2<span style="color: #6276ba;">)</span>
                                    <span style="color: #6276ba;">(</span>y <span style="color: #858580;">(</span>+ x 3<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                               <span style="color: #907373;">(</span>+ y 4<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                            <span style="color: #709870;">(</span>setup-environment<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
<p>
:Effort:   0:15
</p>
</div>
</div>
<div id="outline-container-orgheadline14" class="outline-5">
<h5 id="orgheadline14"><span class="todo NEXT">NEXT</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.8">Exercise 4.8</a></h5>
<div class="outline-text-5" id="text-orgheadline14">
<p>
Let's try an example transformation:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">f</span> <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>a b<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>c d<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> e
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">Equivalent to (lambda () (define (f a c) e) (f b d))</span>
     <span style="color: #707183;">)</span>
</pre>
</div>

<p>
However, that uses <code>define</code>, which has to manipulate the symbol table. It would
be easier to a purely syntactic transformation, which requires a fixed-point
combinator to accomplish recursion without referring explicitly to the name of
the recursing function. First we do an implementation for a function of one
argument:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">With names to illustrate what's going on.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">fix</span> f<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>f <span style="color: #709870;">(</span>fix f<span style="color: #709870;">)</span> x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">factabs</span> fact x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>= x 0<span style="color: #909183;">)</span>
      1
      <span style="color: #909183;">(</span>* x <span style="color: #709870;">(</span>fact <span style="color: #907373;">(</span>- x 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>test 120 <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>fix factabs<span style="color: #909183;">)</span> 5<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Now purely with lambdas</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Y-combinator</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #7388d6;">(</span>f<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>f <span style="color: #907373;">(</span>x x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>f <span style="color: #907373;">(</span>x x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test
 120
 <span style="color: #7388d6;">(</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIX</span>
  <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>f<span style="color: #709870;">)</span>
    <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>x<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span>f <span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  5<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock26"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> srfi-1<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">let-&gt;combination</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>proc <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>symbol? <span style="color: #858580;">(</span>cadr exp<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                   <span style="color: #6276ba;">(</span>cadr exp<span style="color: #6276ba;">)</span>
                   #f<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>clauses <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>symbol? <span style="color: #858580;">(</span>cadr exp<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                      <span style="color: #6276ba;">(</span>cddr exp<span style="color: #6276ba;">)</span>
                      <span style="color: #6276ba;">(</span>cdr exp<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>bindings <span style="color: #907373;">(</span>car clauses<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>body <span style="color: #907373;">(</span>cdr clauses<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #709870;">(</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">Partition list of bindings ((a 1) (b 2) ...) into a pair of a</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">parameter list and an argument list ((a b ...) . (1 2 ...)).</span>
           <span style="color: #907373;">(</span>res <span style="color: #6276ba;">(</span>fold-right
                 <span style="color: #858580;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #80a880;">(</span>e ls<span style="color: #80a880;">)</span>
                   <span style="color: #80a880;">(</span>cons
                    <span style="color: #887070;">(</span>cons <span style="color: #707183;">(</span>car e<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>car ls<span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                    <span style="color: #887070;">(</span>cons <span style="color: #707183;">(</span>cadr e<span style="color: #707183;">)</span> <span style="color: #707183;">(</span>cdr ls<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 '<span style="color: #858580;">(</span><span style="color: #80a880;">()</span> . <span style="color: #80a880;">()</span><span style="color: #858580;">)</span>
                 bindings<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>params <span style="color: #6276ba;">(</span>car res<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>args <span style="color: #6276ba;">(</span>cdr res<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> proc
          `<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">()</span>
              <span style="color: #858580;">(</span><span style="color: #a020f0;">define</span> <span style="color: #80a880;">(</span>,proc ,@params<span style="color: #80a880;">)</span> ,@body<span style="color: #858580;">)</span>
              <span style="color: #858580;">(</span>,proc ,@args<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          `<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> ,params ,@body<span style="color: #6276ba;">)</span>
            ,@args<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock27"><span style="color: #707183;">(</span>eval-4-1-put 'let
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>let-&gt;combination exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-3"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">test-group</span> <span style="color: #8b2252;">"test-4-8"</span>
            <span style="color: #7388d6;">(</span>test 5
                  <span style="color: #909183;">(</span>eval-4-1 '<span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>x 2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">(</span>+ x 3<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>setup-environment<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test 21
                  <span style="color: #909183;">(</span>eval-4-1
                   '<span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">fib-iter</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>a 1<span style="color: #6276ba;">)</span>
                                   <span style="color: #6276ba;">(</span>b 0<span style="color: #6276ba;">)</span>
                                   <span style="color: #6276ba;">(</span>count 8<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                      <span style="color: #907373;">(</span><span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>= count 0<span style="color: #6276ba;">)</span>
                          b
                          <span style="color: #6276ba;">(</span>fib-iter <span style="color: #858580;">(</span>+ a b<span style="color: #858580;">)</span> a <span style="color: #858580;">(</span>- count 1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>setup-environment<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test 21
                  <span style="color: #909183;">(</span>eval-4-1
                   '<span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>n 8<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                      <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">fib-iter</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>a 1<span style="color: #858580;">)</span>
                                     <span style="color: #858580;">(</span>b 0<span style="color: #858580;">)</span>
                                     <span style="color: #858580;">(</span>count n<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                        <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span>= count 0<span style="color: #858580;">)</span>
                            b
                            <span style="color: #858580;">(</span>fib-iter <span style="color: #80a880;">(</span>+ a b<span style="color: #80a880;">)</span> a <span style="color: #80a880;">(</span>- count 1<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>setup-environment<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
:Effort:   0:30
</p>
</div>
</div>
<div id="outline-container-orgheadline15" class="outline-5">
<h5 id="orgheadline15"><span class="todo NEXT">NEXT</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.9">Exercise 4.9</a></h5>
<div class="outline-text-5" id="text-orgheadline15">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-05-23 Sat 18:46] </span></span> <br  />
Test is failing because, inside a procedure, setting the value of a variable
defined in the enclosing scope doesn't seem to stick after the lambda
returns. Since Section 4.1.3 deals with the environment lookup, I'll come back
to this after I fix the environment.</li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>while p b
       <span style="color: #b22222;">;; </span><span style="color: #b22222;">Equivalent to (let foo ((p (lambda () p)) (b (lambda () b)) (if (not</span>
       <span style="color: #b22222;">;; </span><span style="color: #b22222;">(p)) #f (b) (foo p b)))</span>
       <span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock28"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">expand-while</span> exp<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>pred <span style="color: #907373;">(</span>cadr exp<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>body <span style="color: #907373;">(</span>cddr exp<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    `<span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">iter</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>pred <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">()</span> ,pred<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">(</span>body <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">()</span> ,@body<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
       <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>pred<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           #f
           <span style="color: #907373;">(</span><span style="color: #a020f0;">begin</span>
             <span style="color: #6276ba;">(</span>body<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>iter pred body<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock29"><span style="color: #707183;">(</span>eval-4-1-put 'while
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-4-1 <span style="color: #709870;">(</span>expand-while exp<span style="color: #709870;">)</span> env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-3"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">test-group</span> <span style="color: #8b2252;">"ex-4-9"</span>
            <span style="color: #7388d6;">(</span>test 1
                  <span style="color: #909183;">(</span>eval-4-1
                   '<span style="color: #709870;">(</span><span style="color: #a020f0;">begin</span>
                      <span style="color: #907373;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">x</span> 0<span style="color: #907373;">)</span>
                      <span style="color: #907373;">(</span>while <span style="color: #6276ba;">(</span>= x 0<span style="color: #6276ba;">)</span>
                        <span style="color: #6276ba;">(</span><span style="color: #a020f0;">set!</span> x 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                      x<span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>setup-environment<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
<p>
:Effort:   0:30
</p>
</div>
</div>
<div id="outline-container-orgheadline16" class="outline-5">
<h5 id="orgheadline16"><span class="todo NEXT">NEXT</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.10">Exercise 4.10</a></h5>
<div class="outline-text-5" id="text-orgheadline16">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-02-17 Tue 17:24] </span></span> <br  />
I've got the lexer done. Onto the parser.</li>
</ul>
<p>
I'm going to try to do this with M-expressions.
</p>

<pre class="example">
S ::= ...

SEXPR ::= ATOM
          | '\'' SEXPR
          | '`' SEXPR
          | ',' SEXPR
          | ',@' SEXPR
          | '(' SEXPR_END
SEXPR_BODY ::= ')'
              | SEXPR SEXPR_END
SEXPR_END ::= '.' SEXPR ')'
              | SEXPRS_REST
SEXPRS_REST ::= ')'
                | SEXPR SEXPRS_REST
ATOM ::= NUM | BOOL | SYMBOL
NUM ::= /[0-9]+(\.[0-9]*)?|\.[0-9]+/
BOOL ::= "#t" | "#f"
SYMBOL ::= /[-+*/_a-zA-Z][-+*/_a-zA-Z0-9]*/
</pre>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #228b22;">&lt;&lt;mexpr-lexer&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;mexpr-parser&gt;&gt;</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock30"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> srfi-1<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-terminal</span> port start? continue? string-&gt;result<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>in <span style="color: #907373;">(</span>peek-char port<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">or</span> <span style="color: #907373;">(</span>eof-object? in<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>start? in<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        #f
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">iter</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>chars <span style="color: #858580;">(</span>list <span style="color: #80a880;">(</span>read-char port<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>in <span style="color: #80a880;">(</span>peek-char port<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span><span style="color: #a020f0;">or</span> <span style="color: #80a880;">(</span>eof-object? in<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>not <span style="color: #887070;">(</span>continue? in<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span>string-&gt;result
                 <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>compose list-&gt;string reverse<span style="color: #887070;">)</span> chars<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span>iter <span style="color: #80a880;">(</span>cons <span style="color: #887070;">(</span>read-char port<span style="color: #887070;">)</span> chars<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">atomize</span> atom<span style="color: #7388d6;">)</span> `<span style="color: #7388d6;">(</span>atom . ,atom<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">atom-token?</span> token<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>pair? token<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>eq? <span style="color: #709870;">(</span>car token<span style="color: #709870;">)</span> 'atom<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">atom-value</span> token<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr token<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-symbol</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">symbol-start?</span> c<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">or</span> <span style="color: #709870;">(</span>char-alphabetic? c<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>char-numeric? c<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>find <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>char=? c x<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> '<span style="color: #907373;">(</span>#\+ #\- #\* #\/ #\= #\&lt; #\&gt; #\? #\_<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">symbol-continue?</span> c<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">or</span> <span style="color: #709870;">(</span>symbol-start? c<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>char-numeric? c<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-terminal port symbol-start? symbol-continue? <span style="color: #909183;">(</span>compose atomize string-&gt;symbol<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-num</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-terminal port char-numeric? char-numeric? <span style="color: #909183;">(</span>compose atomize string-&gt;number<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">true</span> #t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">false</span> #f<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-bool</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-terminal port
                 <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>c<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>char=? c #\#<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                 <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>c<span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">or</span> <span style="color: #907373;">(</span>char-ci=? c #\t<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>char-ci=? c #\f<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                 <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>s<span style="color: #709870;">)</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>string-ci=? s <span style="color: #8b2252;">"#t"</span><span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>atomize true<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                                   <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>atomize false<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">consume-whitespace</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-terminal port char-whitespace? char-whitespace? <span style="color: #909183;">(</span>constant 'whitespace<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">consume-line-comment</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-terminal port
                 <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>c<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>char=? #\; c<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                 <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>c<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>char=? #\newline c<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                 <span style="color: #909183;">(</span>constant 'line-comment<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">consume-space</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>consume-whitespace port<span style="color: #907373;">)</span>
                <span style="color: #907373;">(</span>consume-line-comment port<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      #f
      <span style="color: #909183;">(</span>consume-space port<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Single-character tokens</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">constant</span> value<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>x<span style="color: #909183;">)</span> value<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-scan-literal-char</span> c<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>port<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>scan-terminal port
                   <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>inc<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>char=? c inc<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #907373;">(</span>inc<span style="color: #907373;">)</span> #f<span style="color: #709870;">)</span>
                   <span style="color: #709870;">(</span>constant c<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">lparen</span> #\(<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-lparen</span> <span style="color: #7388d6;">(</span>make-scan-literal-char lparen<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rparen</span> #\)<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-rparen</span> <span style="color: #7388d6;">(</span>make-scan-literal-char rparen<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">lbracket</span> #\(<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-lbracket</span> <span style="color: #7388d6;">(</span>make-scan-literal-char lbracket<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">rbracket</span> #\)<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-rbracket</span> <span style="color: #7388d6;">(</span>make-scan-literal-char rbracket<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">dot</span> #\.<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-dot</span> <span style="color: #7388d6;">(</span>make-scan-literal-char dot<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">semicolon</span> #\;<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-semicolon</span> <span style="color: #7388d6;">(</span>make-scan-literal-char semicolon<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">quote-sym</span> #\'<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-quote-sym</span> <span style="color: #7388d6;">(</span>make-scan-literal-char quote-sym<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">quasiquote-sym</span> #\`<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">scan-quasiquote-sym</span> <span style="color: #7388d6;">(</span>make-scan-literal-char quasiquote-sym<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Parse both unquote operators here, since we need the lookahead to</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">distinguish between unquote (",") and unquote-splicing (",@").</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">unquote-sym</span> #\,<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">unquote-splicing-sym</span> '<span style="color: #7388d6;">(</span>#\, #\@<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-unquotes</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>in <span style="color: #907373;">(</span>peek-char port<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #a020f0;">or</span> <span style="color: #907373;">(</span>eof-object? in<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>char=? in #\,<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        #f
        <span style="color: #709870;">(</span><span style="color: #a020f0;">begin</span>
          <span style="color: #907373;">(</span>read-char port<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>in <span style="color: #80a880;">(</span>peek-char port<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span><span style="color: #a020f0;">or</span> <span style="color: #80a880;">(</span>eof-object? in<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>not <span style="color: #887070;">(</span>char=? in #\@<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                unquote-sym
                <span style="color: #858580;">(</span><span style="color: #a020f0;">begin</span>
                  <span style="color: #80a880;">(</span>read-char port<span style="color: #80a880;">)</span>
                  unquote-splicing-sym<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">identity</span> x<span style="color: #7388d6;">)</span> x<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">nonnull?</span> x<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>not <span style="color: #909183;">(</span>null? x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">atom?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">or</span> <span style="color: #909183;">(</span>number? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>symbol? x<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>boolean? x<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-next-token</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>consume-space port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-lparen port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-rparen port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-lbracket port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-rbracket port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-dot port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>

        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-unquotes port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-quasiquote-sym port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-quote-sym port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>

        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-symbol port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-num port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>scan-bool port<span style="color: #709870;">)</span> =&gt; identity<span style="color: #909183;">)</span>

        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>eof-object? <span style="color: #907373;">(</span>peek-char port<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>peek-char port<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"SCAN-NEXT-TOKEN: Next token not found"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock31"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-next-token</span> port<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">lookahead</span> '<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">get</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>nonnull? lookahead<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>token lookahead<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">set!</span> lookahead '<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span>
          token<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>scan-next-token port<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">unget</span> token<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">set!</span> lookahead token<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">dispatch</span> msg<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? msg 'get<span style="color: #907373;">)</span> get<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? msg 'unget<span style="color: #907373;">)</span> unget<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #907373;">(</span>error <span style="color: #8b2252;">"NEXT-TOKEN -- unrecognized message"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  dispatch<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">read-sexpr</span> next-token<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>token <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>next-token 'get<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                                        <span style="color: #b22222;">; </span><span style="color: #b22222;">(display token) (newline)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span>
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">TODO: Why doesn't `(quasiquote ,expr) work?</span>
     <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token quote-sym<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span>list 'quote <span style="color: #6276ba;">(</span>read-sexpr next-token<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token quasiquote-sym<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span>list 'quasiquote <span style="color: #6276ba;">(</span>read-sexpr next-token<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token unquote-sym<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span>list 'unquote <span style="color: #6276ba;">(</span>read-sexpr next-token<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token unquote-splicing-sym<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span>list 'unquote-splicing <span style="color: #6276ba;">(</span>read-sexpr next-token<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>

     <span style="color: #709870;">(</span><span style="color: #907373;">(</span>atom-token? token<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span>atom-value token<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token lparen<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span>read-sexpr-body next-token<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #8b2252;">"READ-SEXPR: No parse"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">read-sexpr-body</span> next-token<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>token <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>next-token 'get<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token rparen<span style="color: #907373;">)</span> '<span style="color: #907373;">()</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>next-token 'unget<span style="color: #6276ba;">)</span> token<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>sexpr <span style="color: #80a880;">(</span>read-sexpr next-token<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>sexpr-end <span style="color: #80a880;">(</span>read-sexpr-end next-token<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>cons sexpr sexpr-end<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">read-sexpr-end</span> next-token<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>token <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>next-token 'get<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token dot<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>sexpr <span style="color: #80a880;">(</span>read-sexpr next-token<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>end <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>next-token 'get<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span><span style="color: #a020f0;">if</span> <span style="color: #858580;">(</span>eq? end rparen<span style="color: #858580;">)</span>
                 sexpr
                 <span style="color: #858580;">(</span>error <span style="color: #8b2252;">"READ-SEXPR-END: Failed parse of dotted pair"</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>next-token 'unget<span style="color: #6276ba;">)</span> token<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>read-sexprs-rest next-token<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">read-sexprs-rest</span> next-token<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>token <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>next-token 'get<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? token rparen<span style="color: #907373;">)</span> '<span style="color: #907373;">()</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span>
           <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>next-token 'unget<span style="color: #6276ba;">)</span> token<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span><span style="color: #a020f0;">let*</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>sexpr <span style="color: #80a880;">(</span>read-sexpr next-token<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>sexprs-rest <span style="color: #80a880;">(</span>read-sexprs-rest next-token<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>cons sexpr sexprs-rest<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
:Effort:   3:00
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline23" class="outline-4">
<h4 id="orgheadline23"><span class="todo NEXT">NEXT</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1.3">4.1.3: Evaluator Data Structures</a> <code>[3/4]</code></h4>
<div class="outline-text-4" id="text-orgheadline23">
</div><div id="outline-container-orgheadline18" class="outline-5">
<h5 id="orgheadline18">Code</h5>
<div class="outline-text-5" id="text-orgheadline18">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock32"><span style="color: #228b22;">&lt;&lt;evaluator-structs-predicates&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;evaluator-structs-procedures&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;ex-4-12-environments&gt;&gt;</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock33"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Define true and false inside the interpreter, to show that it's not</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">necessary to conflate the representation of booleans in the interpreter</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">with the implementing language's representation.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">true</span> 'sec-4-1-true<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">false</span> 'sec-4-1-false<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">true?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>not <span style="color: #909183;">(</span>eq? x false<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">false?</span> x<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>eq? x false<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock34"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-procedure</span> parameters body env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>list 'procedure parameters body env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">compound-procedure?</span> p<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>tagged-list? p 'procedure<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">procedure-parameters</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">procedure-body</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>caddr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">procedure-environment</span> p<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadddr p<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock35"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">enclosing-environment</span> env<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">first-frame</span> env<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">the-empty-environment</span> '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-frame</span> variables values<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons variables values<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">frame-variables</span> frame<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car frame<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">frame-values</span> frame<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr frame<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">add-binding-to-frame!</span> var val frame<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>set-car! frame <span style="color: #909183;">(</span>cons var <span style="color: #709870;">(</span>car frame<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>set-cdr! frame <span style="color: #909183;">(</span>cons val <span style="color: #709870;">(</span>cdr frame<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">extend-environment</span> vars vals base-env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>= <span style="color: #709870;">(</span>length vars<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>length vals<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>cons <span style="color: #709870;">(</span>make-frame vars vals<span style="color: #709870;">)</span> base-env<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>&lt; <span style="color: #907373;">(</span>length vars<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>length vals<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Too many arguments supplied"</span> vars vals<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Too few arguments supplied"</span> vars vals<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lookup-variable-value</span> var env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">env-loop</span> env<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">scan</span> vars vals<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>null? vars<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>env-loop <span style="color: #858580;">(</span>enclosing-environment env<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? var <span style="color: #858580;">(</span>car vars<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>car vals<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>scan <span style="color: #858580;">(</span>cdr vars<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cdr vals<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>eq? env the-empty-environment<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Unbound variable"</span> var<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>frame <span style="color: #858580;">(</span>first-frame env<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>scan <span style="color: #6276ba;">(</span>frame-variables frame<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span>frame-values frame<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>env-loop env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-variable-value!</span> var val env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">env-loop</span> env<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">scan</span> vars vals<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>null? vars<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>env-loop <span style="color: #858580;">(</span>enclosing-environment env<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? var <span style="color: #858580;">(</span>car vars<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>set-car! vals val<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>scan <span style="color: #858580;">(</span>cdr vars<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cdr vals<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>eq? env the-empty-environment<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Unbound variable -- SET!"</span> var<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>frame <span style="color: #858580;">(</span>first-frame env<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>scan <span style="color: #6276ba;">(</span>frame-variables frame<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span>frame-values frame<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>env-loop env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">define-variable!</span> var val env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>frame <span style="color: #907373;">(</span>first-frame env<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">scan</span> vars vals<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>null? vars<span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>add-binding-to-frame! var val frame<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>eq? var <span style="color: #858580;">(</span>car vars<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
             <span style="color: #6276ba;">(</span>set-car! vals val<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span><span style="color: #a020f0;">else</span> <span style="color: #6276ba;">(</span>scan <span style="color: #858580;">(</span>cdr vars<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>cdr vals<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>scan <span style="color: #709870;">(</span>frame-variables frame<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>frame-values frame<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-5">
<h5 id="orgheadline19"><span class="done DONE">DONE</span> Read SICP 4.1.3</h5>
<div class="outline-text-5" id="text-orgheadline19">
</div>
</div>
<div id="outline-container-orgheadline20" class="outline-5">
<h5 id="orgheadline20"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.11">Exercise 4.11</a></h5>
<div class="outline-text-5" id="text-orgheadline20">
<p>
:Effort:   0:15
</p>

<p>
Redundant with Exercise 4.12.
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-5">
<h5 id="orgheadline21"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.12">Exercise 4.12</a></h5>
<div class="outline-text-5" id="text-orgheadline21">
<p>
Implement environment bindings as a list of name-value pairs (implemented as a
list of two elements to allow for deleting a binding from an environment, see
Exercise 4.13) instead of as a pair of lists:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock36"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">enclosing-environment</span> env<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cdr env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">first-frame</span> env<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">the-empty-environment</span> '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get-bindings</span> frame<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>car frame<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-binding</span> var val<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>list var val<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-frame</span> variables values<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">iter</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>variables variables<span style="color: #709870;">)</span>
             <span style="color: #709870;">(</span>values values<span style="color: #709870;">)</span>
             <span style="color: #709870;">(</span>bindings '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>null? variables<span style="color: #709870;">)</span>
        `<span style="color: #709870;">(</span>,bindings<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>iter <span style="color: #907373;">(</span>cdr variables<span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span>cdr values<span style="color: #907373;">)</span>
              <span style="color: #907373;">(</span>cons <span style="color: #6276ba;">(</span>make-binding <span style="color: #858580;">(</span>car variables<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>car values<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                    bindings<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">add-binding-to-frame!</span> var val frame<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>bindings <span style="color: #907373;">(</span>get-bindings frame<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>set-car! frame <span style="color: #709870;">(</span>cons <span style="color: #907373;">(</span>make-binding var val<span style="color: #907373;">)</span> bindings<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">extend-environment</span> vars vals base-env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>= <span style="color: #709870;">(</span>length vars<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>length vals<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>cons <span style="color: #709870;">(</span>make-frame vars vals<span style="color: #709870;">)</span> base-env<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>&lt; <span style="color: #907373;">(</span>length vars<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>length vals<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Too many arguments supplied"</span> vars vals<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Too few arguments supplied"</span> vars vals<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lookup-variable-value</span> var env<span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Wrap returned value in list in order to terminate lookup, which requires</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">that we unwrap it at the top.</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>res
         <span style="color: #907373;">(</span>scan-env
          var #f env
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>var -unused- env frame<span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span>scan-bindings
             var #f env frame
             <span style="color: #80a880;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #887070;">(</span>var -unused- env frame bindings<span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span>list <span style="color: #707183;">(</span>cadar bindings<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
             <span style="color: #80a880;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #887070;">(</span>var -unused- env frame bindings<span style="color: #887070;">)</span> #f<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>var -unused- env<span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span>error <span style="color: #8b2252;">"Unbound variable"</span> var<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>pair? res<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>car res<span style="color: #709870;">)</span>
        res<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-value-in-bindings!</span> bindings val<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>set-car! <span style="color: #909183;">(</span>cdar bindings<span style="color: #909183;">)</span> val<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">set-variable-value!</span> var val env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-env
   var val env
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var val env frame<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>scan-bindings
      var val env frame
      <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>var val env frame bindings<span style="color: #6276ba;">)</span>
        <span style="color: #6276ba;">(</span>set-value-in-bindings! bindings val<span style="color: #6276ba;">)</span>
        'ok<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>var val env frame bindings<span style="color: #6276ba;">)</span> #f<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var val env<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Unbound variable -- SET!"</span> var<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">define-variable!</span> var val env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-env
   var val env
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var val env frame<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>scan-bindings
      var val env frame
      <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>var val env frame bindings<span style="color: #6276ba;">)</span>
        <span style="color: #6276ba;">(</span>set-value-in-bindings! bindings val<span style="color: #6276ba;">)</span>
        'ok<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>var val env frame bindings<span style="color: #6276ba;">)</span>
        <span style="color: #6276ba;">(</span>add-binding-to-frame! var val frame<span style="color: #6276ba;">)</span>
        'ok<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var val env<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Should never get here -- DEFINE!"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-env</span> var val env on-frame on-not-found-in-env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">env-loop</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>env env<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>eq? env the-empty-environment<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>on-not-found-in-env var val env<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>frame <span style="color: #858580;">(</span>first-frame env<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>on-frame var val env frame<span style="color: #858580;">)</span> =&gt; identity<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">(</span><span style="color: #a020f0;">else</span> <span style="color: #858580;">(</span>env-loop <span style="color: #80a880;">(</span>enclosing-environment env<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-bindings</span> var val env frame on-found-in-frame on-not-found-in-frame<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">frame-loop</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>bindings <span style="color: #907373;">(</span>get-bindings frame<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>null? bindings<span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>on-not-found-in-frame var val env frame bindings<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? var <span style="color: #6276ba;">(</span>caar bindings<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>on-found-in-frame var val env frame bindings<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #907373;">(</span>frame-loop <span style="color: #6276ba;">(</span>cdr bindings<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-3"</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-4-12-environments&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">test-group</span> <span style="color: #8b2252;">"ex-4-12-test"</span>
            <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">env</span> <span style="color: #909183;">(</span>extend-environment '<span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> '<span style="color: #709870;">(</span>1 2<span style="color: #709870;">)</span> the-empty-environment<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span><span style="color: #a020f0;">test-assert</span> <span style="color: #909183;">(</span>equal? env '<span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>y 2<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>x 1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>define-variable! 'z <span style="color: #8b2252;">"zeta"</span> env<span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test <span style="color: #8b2252;">"zeta"</span>
                  <span style="color: #909183;">(</span>lookup-variable-value 'z env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>set-variable-value! 'z <span style="color: #8b2252;">"zee"</span> env<span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test <span style="color: #8b2252;">"zee"</span>
                  <span style="color: #909183;">(</span>lookup-variable-value 'z env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>define-variable! 'x 3 env<span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test 3
                  <span style="color: #909183;">(</span>lookup-variable-value 'x env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test 2
                  <span style="color: #909183;">(</span>lookup-variable-value 'y env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
<p>
:Effort:   0:30
</p>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-5">
<h5 id="orgheadline22"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.13">Exercise 4.13</a></h5>
<div class="outline-text-5" id="text-orgheadline22">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-05-23 Sat 23:51] </span></span> <br  />
Test 7 continues to fail for some reason.</li>
</ul>

<p>
There are three obvious approaches to allow unbinding a variable from the
environment:
</p>

<ol class="org-ol">
<li>Unbind the variable in the first frame where it is visible (starting from the
current frame).</li>
<li>Unbind the variable in all frames.</li>
<li>Hide the variable from the current frame, but don't affect the bindings in
higher frames.</li>
</ol>

<p>
Of these approaches, number 3 is the most consistent with the reference
semantics of lexical scoping implied by the way new bindings shadow bindings in
higher frames. When a binding to a variable is added in the current frame, the
value assigned to it shadows the previous value until the current frame is
popped by returning from the procedure, after which the variable continues to
have its previous value. Thus, deleting a binding to a variable should have the
same behavior &#x2013; the deletion affects only the current and lower frames and is
voided upon popping the current frame.
</p>

<p>
It may be argued that approach 1 or 2 is more reasonable, since mutation
affects the value of the variable in the first frame where it's visible even
after the current procedure returns. However, adding a binding to a frame
creates a reference to a value valid until the current frame is popped, so
deleting a binding should also unbind that reference for the lifetime of the
current frame. Mutations, on the other hand, don't affect references, but
rather the value behind the reference.
</p>

<p>
In Exercise 4.12, I've used the data structure <code>`(,var (,val))</code> for each
binding rather than the simpler <code>`(,var ,val)</code> to enable deletions to shadow
earlier bindings by adding a binding of the form
<code>`(,var the-unbound-sentinel)</code> without causing ambiguity if <code>val</code> happens to be
<code>the-unbound-sentinel</code>.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock37"><span style="color: #228b22;">&lt;&lt;ex-4-12-environments&gt;&gt;</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">unbound-binding?</span> binding<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>eq? <span style="color: #909183;">(</span>cdr binding<span style="color: #909183;">)</span> 'the-unbound-sentinel<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">scan-bindings</span> var val env frame on-found-in-frame on-not-found-in-frame<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">frame-loop</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>bindings <span style="color: #907373;">(</span>get-bindings frame<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #a020f0;">or</span> <span style="color: #6276ba;">(</span>null? bindings<span style="color: #6276ba;">)</span>
               <span style="color: #6276ba;">(</span>unbound-binding? <span style="color: #858580;">(</span>car bindings<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>on-not-found-in-frame var val env frame bindings<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #907373;">(</span>eq? var <span style="color: #6276ba;">(</span>caar bindings<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>on-found-in-frame var val env frame bindings<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span><span style="color: #a020f0;">else</span> <span style="color: #907373;">(</span>frame-loop <span style="color: #6276ba;">(</span>cdr bindings<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">lookup-variable-value</span> var env<span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Wrap returned value in list in order to terminate lookup, which requires</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">that we unwrap it at the top.</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>res
         <span style="color: #907373;">(</span>scan-env
          var #f env
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>var -unused- env frame<span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span>scan-bindings
             var #f env frame
             <span style="color: #80a880;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #887070;">(</span>var -unused- env frame bindings<span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span>list <span style="color: #707183;">(</span>cadar bindings<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
             <span style="color: #80a880;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #887070;">(</span>var -unused- env frame bindings<span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span><span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">and</span> <span style="color: #7388d6;">(</span>not <span style="color: #909183;">(</span>null? bindings<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
                        <span style="color: #7388d6;">(</span>unbound-binding? <span style="color: #909183;">(</span>car bindings<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
                   <span style="color: #707183;">(</span>error <span style="color: #8b2252;">"Unbound variable (deleted)"</span> var<span style="color: #707183;">)</span>
                   #f<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>var -unused- env<span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span>error <span style="color: #8b2252;">"Unbound variable"</span> var<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>pair? res<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>car res<span style="color: #709870;">)</span>
        res<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">make-unbound-variable!</span> var env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>scan-env
   var #f env
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var -unused- env frame<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>scan-bindings
      var #f env frame
      <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>var -unused- env frame bindings<span style="color: #6276ba;">)</span>
        <span style="color: #6276ba;">(</span>set-cdr! <span style="color: #858580;">(</span>car bindings<span style="color: #858580;">)</span> 'the-unbound-sentinel<span style="color: #6276ba;">)</span>
        'ok<span style="color: #907373;">)</span>
      <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>var -unused- env frame bindings<span style="color: #6276ba;">)</span>
        <span style="color: #6276ba;">(</span>add-binding-to-frame! var -unused- frame<span style="color: #6276ba;">)</span>
        'ok<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>var -unused- env<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>error <span style="color: #8b2252;">"Should never get here -- DEFINE!"</span> var<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">get-make-unbound-variable</span> exp<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr exp<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">eval-make-unbound</span> exp env<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>make-unbound-variable! <span style="color: #909183;">(</span>get-make-unbound-variable exp<span style="color: #909183;">)</span>
                          env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock38"><span style="color: #707183;">(</span>eval-4-1-put 'make-unbound!
              <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>exp env<span style="color: #909183;">)</span>
                <span style="color: #909183;">(</span>eval-make-unbound exp env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-3"</span><span style="color: #707183;">)</span>
<span style="color: #228b22;">&lt;&lt;ex-4-13-environments&gt;&gt;</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">test-group</span> <span style="color: #8b2252;">"ex-4-13-test"</span>
            <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">env</span> <span style="color: #909183;">(</span>extend-environment '<span style="color: #709870;">(</span>x y<span style="color: #709870;">)</span> '<span style="color: #709870;">(</span>1 2<span style="color: #709870;">)</span> the-empty-environment<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span><span style="color: #a020f0;">test-assert</span> <span style="color: #909183;">(</span>equal? env '<span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>y 2<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>x 1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>define-variable! 'z <span style="color: #8b2252;">"zeta"</span> env<span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test <span style="color: #8b2252;">"zeta"</span>
                  <span style="color: #909183;">(</span>lookup-variable-value 'z env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>set-variable-value! 'z <span style="color: #8b2252;">"zee"</span> env<span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test <span style="color: #8b2252;">"zee"</span>
                  <span style="color: #909183;">(</span>lookup-variable-value 'z env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>define-variable! 'x 3 env<span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test 3
                  <span style="color: #909183;">(</span>lookup-variable-value 'x env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #7388d6;">(</span>test 2
                  <span style="color: #909183;">(</span>lookup-variable-value 'y env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #b22222;">;;; </span><span style="color: #b22222;">Assert that the effects of make-unbound! disappear once its</span>
            <span style="color: #b22222;">;;; </span><span style="color: #b22222;">frame has been popped.</span>
            <span style="color: #7388d6;">(</span>test 3
                  <span style="color: #909183;">(</span>eval-4-1
                   '<span style="color: #709870;">(</span><span style="color: #a020f0;">begin</span>
                      <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">()</span>
                         <span style="color: #858580;">(</span>make-unbound! x<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                      x<span style="color: #709870;">)</span>
                   env<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
            <span style="color: #b22222;">;;; </span><span style="color: #b22222;">Assert that make-unbound! actually unbinds the variable.</span>
            <span style="color: #7388d6;">(</span><span style="color: #a020f0;">test-assert</span>
             <span style="color: #909183;">(</span><span style="color: #a020f0;">condition-case</span>
                 <span style="color: #709870;">(</span><span style="color: #a020f0;">begin</span>
                   <span style="color: #907373;">(</span>eval-4-1
                    '<span style="color: #6276ba;">(</span><span style="color: #a020f0;">begin</span>
                       <span style="color: #858580;">(</span><span style="color: #80a880;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #887070;">()</span>
                          <span style="color: #887070;">(</span>make-unbound! x<span style="color: #887070;">)</span>
                          x<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                    env<span style="color: #907373;">)</span>
                   #f<span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span><span style="color: #907373;">(</span>exn<span style="color: #907373;">)</span> #t<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>


<p>
:Effort:   0:45
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline27" class="outline-4">
<h4 id="orgheadline27"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1.4">4.1.4: Running the Evaluator as a Program</a> <code>[2/2]</code></h4>
<div class="outline-text-4" id="text-orgheadline27">
</div><div id="outline-container-orgheadline24" class="outline-5">
<h5 id="orgheadline24">Code</h5>
<div class="outline-text-5" id="text-orgheadline24">
<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock39"><span style="color: #228b22;">&lt;&lt;evaluator-running-primitives&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;evaluator-running-setup&gt;&gt;</span>
<span style="color: #228b22;">&lt;&lt;evaluator-running-driver&gt;&gt;</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
Set up the environment:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock40"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">setup-environment</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>initial-env
         <span style="color: #907373;">(</span>extend-environment <span style="color: #6276ba;">(</span>primitive-procedure-names<span style="color: #6276ba;">)</span>
                             <span style="color: #6276ba;">(</span>primitive-procedure-objects<span style="color: #6276ba;">)</span>
                             the-empty-environment<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>define-variable! 'true true initial-env<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>define-variable! 'false false initial-env<span style="color: #909183;">)</span>
    initial-env<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">the-global-environment</span> <span style="color: #7388d6;">(</span>setup-environment<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Implement primitive procedures:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock41"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">primitive-procedure?</span> proc<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>tagged-list? proc 'primitive<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">primitive-implementation</span> proc<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>cadr proc<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">primitive-procedures</span>
  <span style="color: #7388d6;">(</span>list <span style="color: #909183;">(</span>list 'car car<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list 'cdr cdr<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list 'cons cons<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list 'null? null?<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list 'not not<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list '+ +<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list '- -<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list '* *<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list '/ /<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>list '= =<span style="color: #909183;">)</span>
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;more primitives&gt;</span>
        <span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">primitive-procedure-names</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">map</span> car
       primitive-procedures<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">primitive-procedure-objects</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">map</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>proc<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>list 'primitive <span style="color: #907373;">(</span>cadr proc<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
       primitive-procedures<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Save the APPLY procedure from the underlying Scheme. This separates out the</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">APPLY procedure in the interpreter from that of the underlying Scheme. (I</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">have renamed the interpreter's version APPLY-4-1 as well, instead of just</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">APPLY, as used in the original text.)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">apply-in-underlying-scheme</span> apply<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">apply-primitive-procedure</span> proc args<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>apply-in-underlying-scheme
   <span style="color: #909183;">(</span>primitive-implementation proc<span style="color: #909183;">)</span> args<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
Driver loop:
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock42"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> posix<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">input-prompt</span> <span style="color: #8b2252;">";;; M-Eval input:"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">output-prompt</span> <span style="color: #8b2252;">";;; M-Eval value:"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">driver-loop</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;;; </span><span style="color: #b22222;">Define a temporary port duplicated from standard input in order to allow</span>
  <span style="color: #b22222;">;;; </span><span style="color: #b22222;">exiting the driver loop on EOF without exiting the interpreter as well.</span>
  <span style="color: #7388d6;">(</span>with-input-from-port <span style="color: #909183;">(</span>open-input-file* <span style="color: #709870;">(</span>duplicate-fileno fileno/stdin<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">()</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #0000ff;">iter</span> <span style="color: #907373;">()</span>
          <span style="color: #907373;">(</span>prompt-for-input input-prompt<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>input <span style="color: #80a880;">(</span>read<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">when</span> <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>eof-object? input<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span><span style="color: #a020f0;">let</span> <span style="color: #80a880;">(</span><span style="color: #887070;">(</span>output <span style="color: #707183;">(</span>eval-4-1 input the-global-environment<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>announce-output output-prompt<span style="color: #80a880;">)</span>
                    <span style="color: #80a880;">(</span>user-print output<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                  <span style="color: #858580;">(</span>iter<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">prompt-for-input</span> string<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>newline<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>newline<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>display string<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>newline<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">announce-output</span> string<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>newline<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>display string<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>newline<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">user-print</span> object<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>compound-procedure? object<span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>display <span style="color: #709870;">(</span>list 'compound-procedure
                     <span style="color: #907373;">(</span>procedure-parameters object<span style="color: #907373;">)</span>
                     <span style="color: #907373;">(</span>procedure-body object<span style="color: #907373;">)</span>
                     '<span style="color: #228b22;">&lt;procedure-env&gt;</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>display object<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-5">
<h5 id="orgheadline25"><span class="done DONE">DONE</span> Read SICP 4.1.4</h5>
</div>
<div id="outline-container-orgheadline26" class="outline-5">
<h5 id="orgheadline26"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.14">Exercise 4.14</a></h5>
<div class="outline-text-5" id="text-orgheadline26">
<p>
When Louis installs <code>map</code> from the underlying Scheme as a primitive procedure
of the interpreter, the function passed to <code>map</code> is unable to access the
environment of the interpreter, so any reference to a binding in the
environment won't get resolved to the binding in the interpreter, but rather to
a binding in the underlying Scheme. Eva's typing of the definition of <code>map</code>
into the interpreter allows the function argument to <code>map</code> to access the
interpreter environment, so it works.
</p>

<p>
:Effort:   0:30
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1.5">4.1.5: Data as Programs</a> <code>[1/2]</code></h4>
<div class="outline-text-4" id="text-orgheadline30">
</div><div id="outline-container-orgheadline28" class="outline-5">
<h5 id="orgheadline28"><span class="done DONE">DONE</span> Read SICP 4.1.5</h5>
</div>
<div id="outline-container-orgheadline29" class="outline-5">
<h5 id="orgheadline29"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.15">Exercise 4.15</a></h5>
</div>
</div>
<div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1.6">4.1.6: Internal Definitions</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline38">
</div><div id="outline-container-orgheadline31" class="outline-5">
<h5 id="orgheadline31"><span class="todo TODO">TODO</span> Read SICP 4.1.6</h5>
</div>
<div id="outline-container-orgheadline32" class="outline-5">
<h5 id="orgheadline32"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.16">Exercise 4.16</a></h5>
</div>
<div id="outline-container-orgheadline33" class="outline-5">
<h5 id="orgheadline33"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.17">Exercise 4.17</a></h5>
</div>
<div id="outline-container-orgheadline34" class="outline-5">
<h5 id="orgheadline34"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.18">Exercise 4.18</a></h5>
</div>
<div id="outline-container-orgheadline35" class="outline-5">
<h5 id="orgheadline35"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.19">Exercise 4.19</a></h5>
</div>
<div id="outline-container-orgheadline36" class="outline-5">
<h5 id="orgheadline36"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.20">Exercise 4.20</a></h5>
</div>
<div id="outline-container-orgheadline37" class="outline-5">
<h5 id="orgheadline37"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.21">Exercise 4.21</a></h5>
</div>
</div>
<div id="outline-container-orgheadline43" class="outline-4">
<h4 id="orgheadline43"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_sec_4.1.7">4.1.7: Separating Syntactic Analysis from Execution</a> <code>[0/4]</code></h4>
<div class="outline-text-4" id="text-orgheadline43">
</div><div id="outline-container-orgheadline39" class="outline-5">
<h5 id="orgheadline39"><span class="todo NEXT">NEXT</span> Read SICP 4.1.7</h5>
<div class="outline-text-5" id="text-orgheadline39">
<p>
:Effort:   0:15
</p>
</div>
</div>
<div id="outline-container-orgheadline40" class="outline-5">
<h5 id="orgheadline40"><span class="todo NEXT">NEXT</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.22">Exercise 4.22</a></h5>
</div>
<div id="outline-container-orgheadline41" class="outline-5">
<h5 id="orgheadline41"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.23">Exercise 4.23</a></h5>
</div>
<div id="outline-container-orgheadline42" class="outline-5">
<h5 id="orgheadline42"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-26.html#%_thm_4.24">Exercise 4.24</a></h5>
<div class="outline-text-5" id="text-orgheadline42">
<p>
danenberg@'s analytic evaluator was slower than the original evaluator, and one
of the symptoms was garbage collection overheads. Perhaps he was actually
re-analyzing all the time, or throwing away a lot of results.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline60" class="outline-3">
<h3 id="orgheadline60"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.2">4.2: Variations on a Scheme &#x2013; Lazy Evaluation</a> <code>[%]</code></h3>
<div class="outline-text-3" id="text-orgheadline60">
</div><div id="outline-container-orgheadline47" class="outline-4">
<h4 id="orgheadline47"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.2.1">4.2.1: Normal Order and Applicative Order</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline47">
</div><div id="outline-container-orgheadline44" class="outline-5">
<h5 id="orgheadline44"><span class="todo TODO">TODO</span> Read SICP 4.2.1</h5>
</div>
<div id="outline-container-orgheadline45" class="outline-5">
<h5 id="orgheadline45"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.25">Exercise 4.25</a></h5>
</div>
<div id="outline-container-orgheadline46" class="outline-5">
<h5 id="orgheadline46"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.26">Exercise 4.26</a></h5>
</div>
</div>
<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.2.2">4.2.2: An Interpreter with Lazy Evaluation</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline54">
</div><div id="outline-container-orgheadline48" class="outline-5">
<h5 id="orgheadline48"><span class="todo TODO">TODO</span> Read SICP 4.2.2</h5>
</div>
<div id="outline-container-orgheadline49" class="outline-5">
<h5 id="orgheadline49"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.29">Exercise 4.29</a></h5>
</div>
<div id="outline-container-orgheadline50" class="outline-5">
<h5 id="orgheadline50"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.28">Exercise 4.28</a></h5>
</div>
<div id="outline-container-orgheadline51" class="outline-5">
<h5 id="orgheadline51"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.29">Exercise 4.29</a></h5>
</div>
<div id="outline-container-orgheadline52" class="outline-5">
<h5 id="orgheadline52"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.30">Exercise 4.30</a></h5>
</div>
<div id="outline-container-orgheadline53" class="outline-5">
<h5 id="orgheadline53"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.31">Exercise 4.31</a></h5>
</div>
</div>
<div id="outline-container-orgheadline59" class="outline-4">
<h4 id="orgheadline59"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.2.3">4.2.3: Streams as Lazy Lists</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline59">
</div><div id="outline-container-orgheadline55" class="outline-5">
<h5 id="orgheadline55"><span class="todo TODO">TODO</span> Read SICP 4.2.3</h5>
</div>
<div id="outline-container-orgheadline56" class="outline-5">
<h5 id="orgheadline56"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.32">Exercise 4.32</a></h5>
</div>
<div id="outline-container-orgheadline57" class="outline-5">
<h5 id="orgheadline57"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.33">Exercise 4.33</a></h5>
</div>
<div id="outline-container-orgheadline58" class="outline-5">
<h5 id="orgheadline58"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.34">Exercise 4.34</a></h5>
</div>
</div>
</div>

<div id="outline-container-orgheadline87" class="outline-3">
<h3 id="orgheadline87"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_sec_4.3">4.3: Variations on a Scheme &#x2013; Nondeterministic Computing</a> <code>[%]</code></h3>
<div class="outline-text-3" id="text-orgheadline87">
</div><div id="outline-container-orgheadline65" class="outline-4">
<h4 id="orgheadline65"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_sec_4.3.1">4.3.1: Amb and Search</a> <code>[3/4]</code></h4>
<div class="outline-text-4" id="text-orgheadline65">
</div><div id="outline-container-orgheadline61" class="outline-5">
<h5 id="orgheadline61"><span class="done DONE">DONE</span> Read SICP 4.3.1</h5>
</div>
<div id="outline-container-orgheadline62" class="outline-5">
<h5 id="orgheadline62"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.35">Exercise 4.35</a></h5>
<div class="outline-text-5" id="text-orgheadline62">
<p>
For
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">a-pythagorean-triple-between</span> low high<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>i <span style="color: #907373;">(</span>an-integer-between low high<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>j <span style="color: #6276ba;">(</span>an-integer-between i high<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>k <span style="color: #858580;">(</span>an-integer-between j high<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>= <span style="color: #858580;">(</span>+ <span style="color: #80a880;">(</span>* i i<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>* j j<span style="color: #80a880;">)</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>* k k<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>list i j k<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
define <code>an-integer-between</code> as follows:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">an-integer-between</span> low high<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>require <span style="color: #909183;">(</span>&lt;= low high<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>amb low <span style="color: #909183;">(</span>an-integer-between <span style="color: #709870;">(</span>+ low 1<span style="color: #709870;">)</span> high<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline63" class="outline-5">
<h5 id="orgheadline63"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.36">Exercise 4.36</a></h5>
<div class="outline-text-5" id="text-orgheadline63">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-05-04 Mon 17:51] </span></span> <br  />
Need to actually do Exercise 3.69.</li>
</ul>

<p>
In <code>a-pythagorean-triple-between</code>, one cannot simply replace
<code>an-integer-between</code> with <code>an-integer-starting-from</code>, a procedure that
nondeterministically generates any integer starting from a lower bound, because
<code>amb</code> performs a depth-first search, meaning that the call of
<code>an-integer-starting-from</code> to generate one of the numbers (probably <code>k</code>) will
search through an infinite stream of integers, meaning the possibilities for
the other numbers will never been explored.
</p>

<p>
In order to generate an infinite number of Pythagorean triples, one must use a
similar technique as Exercise 3.69.
</p>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-5">
<h5 id="orgheadline64"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.37">Exercise 4.37</a></h5>
<div class="outline-text-5" id="text-orgheadline64">
<p>
Yes, this version is more efficient. With the version in 4.35, you must
generate all triples of integers \( [l, h] \times [l, h] \times [l, h] \), where \(l\)
and \(h\) are the <code>low</code> and <code>high</code> respectively passed to
<code>a-pythagorean-triple-between</code>. This version, on the other hand, only requires
generating pairs \( [l, h] \times [l, h] \), giving an asymptotic \(O(N^2)\) running
time rather than \(O(N^3)\).
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-4">
<h4 id="orgheadline79"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_sec_4.3.2">4.3.2: Examples of Nondeterministic Programs</a> <code>[4/13]</code></h4>
<div class="outline-text-4" id="text-orgheadline79">
</div><div id="outline-container-orgheadline66" class="outline-5">
<h5 id="orgheadline66"><span class="done DONE">DONE</span> Read SICP 4.3.2</h5>
</div>
<div id="outline-container-orgheadline67" class="outline-5">
<h5 id="orgheadline67"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.38">Exercise 4.38</a></h5>
<div class="outline-text-5" id="text-orgheadline67">
<p>
To remove the requirement that Smith and Fletcher do not live on adjacent
floors, simply remove the line
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>require <span style="color: #7388d6;">(</span>not <span style="color: #909183;">(</span>= <span style="color: #709870;">(</span>abs <span style="color: #907373;">(</span>- smith fletcher<span style="color: #907373;">)</span><span style="color: #709870;">)</span> 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
which produces the following procedure:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiple-dwelling</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>baker <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>cooper <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>fletcher <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>miller <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>smith <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require
     <span style="color: #709870;">(</span>distinct? <span style="color: #907373;">(</span>list baker cooper fletcher miller smith<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>= baker 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>= cooper 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>= fletcher 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>= fletcher 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>&gt; miller cooper<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>= <span style="color: #6276ba;">(</span>abs <span style="color: #858580;">(</span>- fletcher cooper<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span> 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>list 'baker baker<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>list 'cooper cooper<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>list 'fletcher fletcher<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>list 'miller miller<span style="color: #709870;">)</span>
          <span style="color: #709870;">(</span>list 'smith smith<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline68" class="outline-5">
<h5 id="orgheadline68"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.39">Exercise 4.39</a></h5>
<div class="outline-text-5" id="text-orgheadline68">
<p>
The order of the restrictions does not affect the answer, since all of the
restrictions must be satisfied in order for the answer to be reached. However,
their order can affect the time it takes to obtain the answer. The simplest way
to see this is to note that moving the distinctness requirement to the end will
increase the number of sets of assignments that need to be evaluated by the
other clauses to \(5^5\) from \(5^{\underline{5}}\).
</p>
</div>
</div>

<div id="outline-container-orgheadline69" class="outline-5">
<h5 id="orgheadline69"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.40">Exercise 4.40</a></h5>
<div class="outline-text-5" id="text-orgheadline69">
<p>
We can make the program substantially more efficient by imposing all
restrictions that involve one variable before those that involve two and so on
until those involving all five:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiple-dwelling</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>baker <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>= baker 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>cooper <span style="color: #6276ba;">(</span>amb 1 2 3 4 5<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>require <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>= cooper 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>fletcher <span style="color: #858580;">(</span>amb 1 2 3 4 5<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>= fletcher 5<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>= fletcher 1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>= <span style="color: #80a880;">(</span>abs <span style="color: #887070;">(</span>- fletcher cooper<span style="color: #887070;">)</span><span style="color: #80a880;">)</span> 1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">let</span> <span style="color: #6276ba;">(</span><span style="color: #858580;">(</span>miller <span style="color: #80a880;">(</span>amb 1 2 3 4 5<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span>require <span style="color: #858580;">(</span>&gt; miller cooper<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">let</span> <span style="color: #858580;">(</span><span style="color: #80a880;">(</span><span style="color: #887070;">(</span>smith <span style="color: #707183;">(</span>amb 1 2 3 4 5<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span>require
             <span style="color: #80a880;">(</span>distinct? <span style="color: #887070;">(</span>list baker cooper fletcher miller smith<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span>require <span style="color: #80a880;">(</span>not <span style="color: #887070;">(</span>= <span style="color: #707183;">(</span>abs <span style="color: #7388d6;">(</span>- smith fletcher<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> 1<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span>list <span style="color: #80a880;">(</span>list 'baker baker<span style="color: #80a880;">)</span>
                  <span style="color: #80a880;">(</span>list 'cooper cooper<span style="color: #80a880;">)</span>
                  <span style="color: #80a880;">(</span>list 'fletcher fletcher<span style="color: #80a880;">)</span>
                  <span style="color: #80a880;">(</span>list 'miller miller<span style="color: #80a880;">)</span>
                  <span style="color: #80a880;">(</span>list 'smith smith<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline70" class="outline-5">
<h5 id="orgheadline70"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.41">Exercise 4.41</a></h5>
<div class="outline-text-5" id="text-orgheadline70">
<p>
Seems substantially easier to recast in terms of an ordinary recursive Scheme
procedure after looking at the non-deterministic version &#x2013; we'll just perform
the tree search ourselves:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">multiple-dwelling</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>filter-mapper
   <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>baker<span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>= baker 5<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
         <span style="color: #907373;">(</span>filter-mapper
          <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>cooper<span style="color: #858580;">)</span>
            <span style="color: #858580;">(</span><span style="color: #a020f0;">if</span> <span style="color: #80a880;">(</span>not <span style="color: #887070;">(</span>= cooper 1<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                <span style="color: #80a880;">(</span>filter-mapper
                 <span style="color: #887070;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #707183;">(</span>fletcher<span style="color: #707183;">)</span>
                   <span style="color: #707183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">and</span> <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span>= fletcher 5<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                            <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span>= fletcher 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                            <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span>= <span style="color: #907373;">(</span>abs <span style="color: #6276ba;">(</span>- fletcher cooper<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> 1<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
                       <span style="color: #7388d6;">(</span>filter-mapper
                        <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>miller<span style="color: #709870;">)</span>
                          <span style="color: #709870;">(</span><span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>&gt; miller cooper<span style="color: #907373;">)</span>
                              <span style="color: #907373;">(</span>filter-mapper
                               <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>smith<span style="color: #858580;">)</span>
                                 <span style="color: #858580;">(</span><span style="color: #a020f0;">if</span> <span style="color: #80a880;">(</span><span style="color: #a020f0;">and</span> <span style="color: #887070;">(</span>distinct? <span style="color: #707183;">(</span>list baker cooper fletcher miller smith<span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                                          <span style="color: #887070;">(</span>not <span style="color: #707183;">(</span>= <span style="color: #7388d6;">(</span>abs <span style="color: #909183;">(</span>- smith fletcher<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> 1<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                                     <span style="color: #80a880;">(</span>list <span style="color: #887070;">(</span>list 'baker baker<span style="color: #887070;">)</span>
                                           <span style="color: #887070;">(</span>list 'cooper cooper<span style="color: #887070;">)</span>
                                           <span style="color: #887070;">(</span>list 'fletcher fletcher<span style="color: #887070;">)</span>
                                           <span style="color: #887070;">(</span>list 'miller miller<span style="color: #887070;">)</span>
                                           <span style="color: #887070;">(</span>list 'smith smith<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                                     '<span style="color: #80a880;">()</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                              '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
                       '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
                   <span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                '<span style="color: #80a880;">()</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
         '<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">filter-mapper</span> f<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>filter <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>xs<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>null? xs<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #a020f0;">map</span> f '<span style="color: #709870;">(</span>1 2 3 4 5<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">distinct?</span> items<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">cond</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>null? items<span style="color: #709870;">)</span> #t<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>null? <span style="color: #907373;">(</span>cdr items<span style="color: #907373;">)</span><span style="color: #709870;">)</span> #t<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span>member <span style="color: #907373;">(</span>car items<span style="color: #907373;">)</span> <span style="color: #907373;">(</span>cdr items<span style="color: #907373;">)</span><span style="color: #709870;">)</span> #f<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #a020f0;">else</span> <span style="color: #709870;">(</span>distinct? <span style="color: #907373;">(</span>cdr items<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline71" class="outline-5">
<h5 id="orgheadline71"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.42">Exercise 4.42</a></h5>
<div class="outline-text-5" id="text-orgheadline71">
<p>
Here's the <code>amb</code> evaluator-based solution:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">solve-liars</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>betty <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>kitty <span style="color: #907373;">(</span>amb 1 2 3 4 5<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>xor <span style="color: #907373;">(</span>= kitty 2<span style="color: #907373;">)</span>
                  <span style="color: #907373;">(</span>= betty 3<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>mary <span style="color: #6276ba;">(</span>amb 1 2 3 4 5<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>require <span style="color: #907373;">(</span>xor <span style="color: #6276ba;">(</span>= kitty 2<span style="color: #6276ba;">)</span>
                    <span style="color: #6276ba;">(</span>= mary 4<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>require <span style="color: #907373;">(</span>xor <span style="color: #6276ba;">(</span>= mary 4<span style="color: #6276ba;">)</span>
                    <span style="color: #6276ba;">(</span>= betty 1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>ethel <span style="color: #858580;">(</span>amb 1 2 3 4 5<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>joan <span style="color: #858580;">(</span>amb 1 2 3 4 5<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>xor <span style="color: #858580;">(</span>= ethel 1<span style="color: #858580;">)</span>
                      <span style="color: #858580;">(</span>= joan 2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>xor <span style="color: #858580;">(</span>= joan 3<span style="color: #858580;">)</span>
                      <span style="color: #858580;">(</span>= ethel 5<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>distinct? <span style="color: #858580;">(</span>list betty ethel joan kitty mary<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        `<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>betty ,betty<span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span>ethel ,ethel<span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span>joan ,joan<span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span>kitty ,kitty<span style="color: #6276ba;">)</span>
          <span style="color: #6276ba;">(</span>mary ,mary<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">xor</span> a b<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>not <span style="color: #909183;">(</span>eq? a b<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
However, it's fairly simple to solve this puzzle by hand. Let's perform the
following assignments:
</p>

<ul class="org-ul">
<li>\(a\): Kitty was second</li>
<li>\(b\): Betty was third</li>
<li>\(c\): Mary was fourth</li>
<li>\(d\): Betty was first</li>
<li>\(e\): Ethel was first</li>
<li>\(f\): Joan was second</li>
<li>\(g\): Joan was third</li>
<li>\(h\): Ethel was fifth</li>
</ul>

<p>
We want to find all solutions to the equation below where the rank assigned to
each girl is distinct:
</p>

<p>
\[(a + b) \wedge (a + c) \wedge (c + d) \wedge (e + f) \wedge (g + h)\]
</p>

<p>
Using the distinctness of ranks, we can add additional constraints:
</p>

<p>
\[(a + b) \wedge (a + c) \wedge (b + d) \wedge (c + d) \wedge (e + f) \wedge (g + h) \wedge (e + h) \wedge (f + g)\]
</p>

<p>
Since \(\wedge\) is distributive over \(+\), we first simplify the equation down to
</p>

<p>
\[(a + (b \wedge c)) \wedge ((b \wedge c) + d) \wedge (e + f) \wedge (g + h) \wedge (e + h) \wedge (f + g)\]
</p>

<p>
This gives the result
</p>

<div class="org-src-container">

<pre class="src src-scheme">'<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>betty 3<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>ethel 5<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>joan 2<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>kitty 1<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>mary 4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline72" class="outline-5">
<h5 id="orgheadline72"><span class="todo NEXT">NEXT</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.43">Exercise 4.43</a></h5>
<div class="outline-text-5" id="text-orgheadline72">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-05-17 Sun 19:14] </span></span> <br  />
Still need to determine the number of solutions when Mary Ann's last name is
not given.</li>
</ul>
<ul class="org-ul">
<li>Mr. Moore</li>
<li>Colonel Downing</li>
<li>Mr. Hall</li>
<li>Sir Barnacle Hood</li>
<li>Dr. Parker</li>

<li>Mary Ann Moore</li>
<li>Gabrielle</li>
<li>Lorna</li>
<li>Rosalind</li>
<li>Melissa</li>
</ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">yacht-solver</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>d-moore <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>d-downing <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>d-hall <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>d-barnacle <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>d-parker <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>y-moore <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>y-downing <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>y-hall <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>y-barnacle <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>y-parker <span style="color: #907373;">(</span>amb 'maryann 'gabrielle 'lorna 'rosalind 'melissa<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>eq? d-moore 'maryann<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>eq? y-barnacle 'gabrielle<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>eq? y-moore 'lorna<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>eq? y-hall 'rosalind<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>eq? d-barnacle 'melissa<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>eq? y-downing 'melissa<span style="color: #709870;">)</span><span style="color: #909183;">)</span>

    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>eq? d-moore y-moore<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>eq? d-downing y-downing<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>eq? d-hall y-hall<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>eq? d-barnacle y-barnacle<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>require <span style="color: #709870;">(</span>not <span style="color: #907373;">(</span>eq? d-parker y-parker<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">How to encode "Gabrielle's father owns the yacht that is named after</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Dr. Parker's daughter"?</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">More conditions</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>daughters <span style="color: #6276ba;">(</span>list d-moore d-downing d-hall d-barnacle d-parker<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>list-index <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>x<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>eq? x 'lorna<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> daughters<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
The solution is:
</p>

<ul class="org-ul">
<li>Daughters:
<ul class="org-ul">
<li>Mr. Moore: Mary Ann</li>
<li>Colonel Downing: Lorna</li>
<li>Mr. Hall: Gabrielle</li>
<li>Sir Barnacle Hood: Melissa</li>
<li>Dr. Parker: Rosalind</li>
</ul></li>

<li>Yachts:
<ul class="org-ul">
<li>Mr. Moore: Lorna</li>
<li>Colonel Downing: Melissa</li>
<li>Mr. Hall: Rosalind</li>
<li>Sir Barnacle Hood: Gabrielle</li>
<li>Dr. Parker: Mary Ann</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline73" class="outline-5">
<h5 id="orgheadline73"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.44">Exercise 4.44</a></h5>
<div class="outline-text-5" id="text-orgheadline73">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-05-17 Sun 19:29] </span></span> <br  />
TODO: Verify that you can actually apply <code>amb</code> like I'm doing here.</li>
</ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> sicp<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">queens</span> board-size<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">queen-cols</span> k<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>= k 0<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>list empty-board<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>positions
               <span style="color: #858580;">(</span>apply amb
                      <span style="color: #80a880;">(</span>flatmap
                       <span style="color: #887070;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #707183;">(</span>rest-of-queens<span style="color: #707183;">)</span>
                         <span style="color: #707183;">(</span><span style="color: #a020f0;">map</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">(</span>new-row<span style="color: #909183;">)</span>
                                <span style="color: #909183;">(</span>adjoin-position new-row k rest-of-queens<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
                              <span style="color: #7388d6;">(</span>enumerate-interval 1 board-size<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                       <span style="color: #887070;">(</span>queen-cols <span style="color: #707183;">(</span>- k 1<span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>require <span style="color: #6276ba;">(</span>safe? k positions<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          positions<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>queen-cols board-size<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">The representation of an empty board</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #0000ff;">empty-board</span> '<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Add a position (new-row . k) to the list rest-of-queens containing positions</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">for queens.</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">adjoin-position</span> new-row k rest-of-queens<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>cons <span style="color: #909183;">(</span>cons new-row k<span style="color: #909183;">)</span> rest-of-queens<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Is the position of the queen in column k safe with respect to the positions</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">in the list positions?</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">define</span> <span style="color: #7388d6;">(</span><span style="color: #0000ff;">safe?</span> k positions<span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Are positions p1 and p2 safe with respect to each other?</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">p1 and p2 are pairs (x . y).</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">define</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">pos-safe?</span> p1 p2<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>x1 <span style="color: #6276ba;">(</span>car p1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>y1 <span style="color: #6276ba;">(</span>cdr p1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>x2 <span style="color: #6276ba;">(</span>car p2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>y2 <span style="color: #6276ba;">(</span>cdr p2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span><span style="color: #a020f0;">let</span> <span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>dx <span style="color: #858580;">(</span>- x2 x1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>dy <span style="color: #858580;">(</span>- y2 y1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
        <span style="color: #907373;">(</span><span style="color: #a020f0;">or</span> <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>= x1 x2<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>= y1 y2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span><span style="color: #a020f0;">or</span> <span style="color: #80a880;">(</span>= 0 dx<span style="color: #80a880;">)</span>
                     <span style="color: #80a880;">(</span>= 0 dy<span style="color: #80a880;">)</span>
                     <span style="color: #80a880;">(</span>= <span style="color: #887070;">(</span>abs dx<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>abs dy<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Each column has a queen in only one row - find the position in column k</span>
  <span style="color: #7388d6;">(</span><span style="color: #a020f0;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>last-position <span style="color: #907373;">(</span>find <span style="color: #6276ba;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #858580;">(</span>position<span style="color: #858580;">)</span>
                               <span style="color: #858580;">(</span>= k <span style="color: #80a880;">(</span>cdr position<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                             positions<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Filter list to contain only unsafe positions.</span>
    <span style="color: #909183;">(</span>not <span style="color: #709870;">(</span>find <span style="color: #907373;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #6276ba;">(</span>point<span style="color: #6276ba;">)</span>
                 <span style="color: #6276ba;">(</span>not <span style="color: #858580;">(</span>pos-safe? point last-position<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
               positions<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>1 0 0 2 10 4 40 92<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span><span style="color: #a020f0;">map</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>length <span style="color: #907373;">(</span>queens x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>iota 8 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>include <span style="color: #8b2252;">"ex-4-44"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>test '<span style="color: #7388d6;">(</span>1 0 0 2 10 4 40 92<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span><span style="color: #a020f0;">map</span> <span style="color: #909183;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #709870;">(</span>x<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>length <span style="color: #907373;">(</span>queens x<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>iota 8 1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline74" class="outline-5">
<h5 id="orgheadline74"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.45">Exercise 4.45</a></h5>
</div>
<div id="outline-container-orgheadline75" class="outline-5">
<h5 id="orgheadline75"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.46">Exercise 4.46</a></h5>
</div>
<div id="outline-container-orgheadline76" class="outline-5">
<h5 id="orgheadline76"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.47">Exercise 4.47</a></h5>
</div>
<div id="outline-container-orgheadline77" class="outline-5">
<h5 id="orgheadline77"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.48">Exercise 4.48</a></h5>
</div>
<div id="outline-container-orgheadline78" class="outline-5">
<h5 id="orgheadline78"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.49">Exercise 4.49</a></h5>
</div>
</div>
<div id="outline-container-orgheadline86" class="outline-4">
<h4 id="orgheadline86"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_sec_4.3.3">4.3.3: Implementing the Amb Evaluator</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline86">
</div><div id="outline-container-orgheadline80" class="outline-5">
<h5 id="orgheadline80"><span class="todo TODO">TODO</span> Read SICP 4.3.3</h5>
</div>
<div id="outline-container-orgheadline81" class="outline-5">
<h5 id="orgheadline81"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.50">Exercise 4.50</a></h5>
</div>
<div id="outline-container-orgheadline82" class="outline-5">
<h5 id="orgheadline82"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.51">Exercise 4.51</a></h5>
</div>
<div id="outline-container-orgheadline83" class="outline-5">
<h5 id="orgheadline83"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.52">Exercise 4.52</a></h5>
</div>
<div id="outline-container-orgheadline84" class="outline-5">
<h5 id="orgheadline84"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.53">Exercise 4.53</a></h5>
</div>
<div id="outline-container-orgheadline85" class="outline-5">
<h5 id="orgheadline85"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_thm_4.54">Exercise 4.54</a></h5>
</div>
</div>
</div>

<div id="outline-container-orgheadline121" class="outline-3">
<h3 id="orgheadline121"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.4">4.4: Logic Programming</a> <code>[%]</code></h3>
<div class="outline-text-3" id="text-orgheadline121">
</div><div id="outline-container-orgheadline88" class="outline-4">
<h4 id="orgheadline88"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.4.1">4.4.1: Deductive Information Retrieval</a> <code>[7/10]</code></h4>
<div class="outline-text-4" id="text-orgheadline88">
<ul class="org-ul">
<li>Note taken on <span class="timestamp-wrapper"><span class="timestamp">[2015-08-24 Mon 16:18] </span></span> <br  />
Trying to figure out how to use evaluator from the SICP egg.</li>
</ul>
</div>
<div id="outline-container-orgheadline89" class="outline-5">
<h5 id="orgheadline89"><span class="done DONE">DONE</span> Read SICP 4.4.1</h5>
</div>
<div id="outline-container-orgheadline90" class="outline-5">
<h5 id="orgheadline90"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.55">Exercise 4.55</a></h5>
<div class="outline-text-5" id="text-orgheadline90">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> sicp-eval-logic test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>with-microshaft-database
 <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">()</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">test-group</span>
    <span style="color: #8b2252;">"Exercise 4.55"</span>
    <span style="color: #709870;">(</span>test <span style="color: #8b2252;">"a. all people supervised by Ben Bitdiddle;"</span>
          '<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>supervisor <span style="color: #858580;">(</span>Tweakit Lem E<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>Bitdiddle Ben<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>supervisor <span style="color: #858580;">(</span>Fect Cy D<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>Bitdiddle Ben<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>supervisor <span style="color: #858580;">(</span>Hacker Alyssa P<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>Bitdiddle Ben<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>qeval* '<span style="color: #6276ba;">(</span>supervisor ?x <span style="color: #858580;">(</span>Bitdiddle Ben<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>

   <span style="color: #909183;">(</span>test <span style="color: #8b2252;">"b. the names and jobs of all people in the accounting division;"</span>
         '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>job <span style="color: #6276ba;">(</span>Cratchet Robert<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>accounting scrivener<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>job <span style="color: #6276ba;">(</span>Scrooge Eben<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>accounting chief accountant<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>qeval* '<span style="color: #907373;">(</span>job ?x <span style="color: #6276ba;">(</span>accounting . ?type<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>


   <span style="color: #909183;">(</span>test <span style="color: #8b2252;">"c. the names and addresses of all people who live in Slumerville."</span>
         '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>address <span style="color: #6276ba;">(</span>Aull DeWitt<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>Slumerville <span style="color: #858580;">(</span>Onion Square<span style="color: #858580;">)</span> 5<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>address <span style="color: #6276ba;">(</span>Reasoner Louis<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>Slumerville <span style="color: #858580;">(</span>Pine Tree Road<span style="color: #858580;">)</span> 80<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>address <span style="color: #6276ba;">(</span>Bitdiddle Ben<span style="color: #6276ba;">)</span> <span style="color: #6276ba;">(</span>Slumerville <span style="color: #858580;">(</span>Ridge Road<span style="color: #858580;">)</span> 10<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>qeval* '<span style="color: #907373;">(</span>address ?x <span style="color: #6276ba;">(</span>Slumerville . ?addr<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline91" class="outline-5">
<h5 id="orgheadline91"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.56">Exercise 4.56</a></h5>
<div class="outline-text-5" id="text-orgheadline91">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> sicp-eval-logic test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>with-microshaft-database
 <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">()</span>
   <span style="color: #909183;">(</span><span style="color: #a020f0;">test-group</span>
    <span style="color: #8b2252;">"Exercise 4.56"</span>
    <span style="color: #709870;">(</span>test <span style="color: #8b2252;">"a. the names of all people who are supervised by Ben Bitdiddle, together with their addresses;"</span>
          '<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor <span style="color: #80a880;">(</span>Tweakit Lem E<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>address <span style="color: #80a880;">(</span>Tweakit Lem E<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Boston <span style="color: #887070;">(</span>Bay State Road<span style="color: #887070;">)</span> 22<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor <span style="color: #80a880;">(</span>Fect Cy D<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>address <span style="color: #80a880;">(</span>Fect Cy D<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Cambridge <span style="color: #887070;">(</span>Ames Street<span style="color: #887070;">)</span> 3<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor <span style="color: #80a880;">(</span>Hacker Alyssa P<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>address <span style="color: #80a880;">(</span>Hacker Alyssa P<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Cambridge <span style="color: #887070;">(</span>Mass Ave<span style="color: #887070;">)</span> 78<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>qeval* '<span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor ?person <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span>address ?person ?where<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>

    <span style="color: #709870;">(</span>test <span style="color: #8b2252;">"b. all people whose salary is less than Ben Bitdiddle's, together with their salary and Ben Bitdiddle's salary;"</span>
          '<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> 60000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Aull DeWitt<span style="color: #80a880;">)</span> 25000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 25000 60000<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> 60000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Cratchet Robert<span style="color: #80a880;">)</span> 18000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 18000 60000<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> 60000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Reasoner Louis<span style="color: #80a880;">)</span> 30000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 30000 60000<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> 60000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Tweakit Lem E<span style="color: #80a880;">)</span> 25000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 25000 60000<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> 60000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Fect Cy D<span style="color: #80a880;">)</span> 35000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 35000 60000<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> 60000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Hacker Alyssa P<span style="color: #80a880;">)</span> 40000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 40000 60000<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>qeval* '<span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> ?bb-amount<span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span>salary ?person ?amount<span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span>lisp-value &lt; ?amount ?bb-amount<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>

    <span style="color: #709870;">(</span>test <span style="color: #8b2252;">"c. all people who are supervised by someone who is not in the computer division, together with the supervisor's name and job."</span>
          '<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor <span style="color: #80a880;">(</span>Aull DeWitt<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Warbucks Oliver<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>job <span style="color: #887070;">(</span>Warbucks Oliver<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>computer . ?type<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor <span style="color: #80a880;">(</span>Cratchet Robert<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Scrooge Eben<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>job <span style="color: #887070;">(</span>Scrooge Eben<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>computer . ?type<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor <span style="color: #80a880;">(</span>Scrooge Eben<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Warbucks Oliver<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>job <span style="color: #887070;">(</span>Warbucks Oliver<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>computer . ?type<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor <span style="color: #80a880;">(</span>Bitdiddle Ben<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Warbucks Oliver<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>job <span style="color: #887070;">(</span>Warbucks Oliver<span style="color: #887070;">)</span> <span style="color: #887070;">(</span>computer . ?type<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>qeval* '<span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>supervisor ?person ?sup<span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span>not <span style="color: #80a880;">(</span>job ?sup <span style="color: #887070;">(</span>computer . ?type<span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline92" class="outline-5">
<h5 id="orgheadline92"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.57">Exercise 4.57</a></h5>
<div class="outline-text-5" id="text-orgheadline92">
<p>
Define a rule that says that person 1 can replace person 2 if either person 1
does the same job as person 2 or someone who does person 1's job can also do
person 2's job, and if person 1 and person 2 are not the same person.
</p>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock43"><span style="color: #707183;">(</span>qeval* '<span style="color: #7388d6;">(</span>assert! <span style="color: #909183;">(</span>rule <span style="color: #709870;">(</span>same ?x ?x<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme" id="orgsrcblock44"><span style="color: #228b22;">&lt;&lt;rule-same&gt;&gt;</span>
<span style="color: #707183;">(</span>qeval* '<span style="color: #7388d6;">(</span>assert! <span style="color: #909183;">(</span>can-do-job <span style="color: #709870;">(</span>computer wizard<span style="color: #709870;">)</span>
                              <span style="color: #709870;">(</span>computer programmer<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>qeval* '<span style="color: #7388d6;">(</span>assert! <span style="color: #909183;">(</span>can-do-job <span style="color: #709870;">(</span>computer wizard<span style="color: #709870;">)</span>
                              <span style="color: #709870;">(</span>computer technician<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>qeval* '<span style="color: #7388d6;">(</span>assert! <span style="color: #909183;">(</span>can-do-job <span style="color: #709870;">(</span>computer programmer<span style="color: #709870;">)</span>
                              <span style="color: #709870;">(</span>computer programmer trainee<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>qeval* '<span style="color: #7388d6;">(</span>assert! <span style="color: #909183;">(</span>can-do-job <span style="color: #709870;">(</span>administration secretary<span style="color: #709870;">)</span>
                              <span style="color: #709870;">(</span>administration big wheel<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>qeval* '<span style="color: #7388d6;">(</span>assert! <span style="color: #909183;">(</span>rule <span style="color: #709870;">(</span>substitute-for ?person-1 ?person-2<span style="color: #709870;">)</span>
                        <span style="color: #709870;">(</span><span style="color: #a020f0;">and</span> <span style="color: #907373;">(</span>job ?person-1 ?job-1<span style="color: #907373;">)</span>
                             <span style="color: #907373;">(</span>job ?person-2 ?job-2<span style="color: #907373;">)</span>
                             <span style="color: #907373;">(</span><span style="color: #a020f0;">or</span> <span style="color: #6276ba;">(</span>same ?job-1 ?job-2<span style="color: #6276ba;">)</span>
                                 <span style="color: #6276ba;">(</span>can-do-job ?job-1 ?job-2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                             <span style="color: #907373;">(</span>not <span style="color: #6276ba;">(</span>same ?person-1 ?person-2<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Queries:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> sicp-eval-logic test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>with-microshaft-database
 <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">()</span>
  <span style="color: #228b22;">&lt;&lt;rule-substitute-for&gt;&gt;</span>

   <span style="color: #909183;">(</span><span style="color: #a020f0;">test-group</span>
    <span style="color: #8b2252;">"Exercise 4.57"</span>
    <span style="color: #709870;">(</span>test <span style="color: #8b2252;">"a. all people who can replace Cy D. Fect;"</span>
          '<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span>substitute-for <span style="color: #858580;">(</span>Bitdiddle Ben<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>Fect Cy D<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>substitute-for <span style="color: #858580;">(</span>Hacker Alyssa P<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>Fect Cy D<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span>substitute-for <span style="color: #858580;">(</span>Hacker Alyssa P<span style="color: #858580;">)</span> <span style="color: #858580;">(</span>Fect Cy D<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>qeval* '<span style="color: #6276ba;">(</span>substitute-for ?person <span style="color: #858580;">(</span>Fect Cy D<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>

    <span style="color: #709870;">(</span>test <span style="color: #8b2252;">"b. all people who can replace someone who is being paid more than they are, together with the two salaries."</span>
          '<span style="color: #907373;">(</span><span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Aull DeWitt<span style="color: #80a880;">)</span> 25000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Warbucks Oliver<span style="color: #80a880;">)</span> 150000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 25000 150000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>substitute-for <span style="color: #80a880;">(</span>Aull DeWitt<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Warbucks Oliver<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Fect Cy D<span style="color: #80a880;">)</span> 35000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Hacker Alyssa P<span style="color: #80a880;">)</span> 40000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 35000 40000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>substitute-for <span style="color: #80a880;">(</span>Fect Cy D<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Hacker Alyssa P<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
            <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Fect Cy D<span style="color: #80a880;">)</span> 35000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>salary <span style="color: #80a880;">(</span>Hacker Alyssa P<span style="color: #80a880;">)</span> 40000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>lisp-value &lt; 35000 40000<span style="color: #858580;">)</span>
                 <span style="color: #858580;">(</span>substitute-for <span style="color: #80a880;">(</span>Fect Cy D<span style="color: #80a880;">)</span> <span style="color: #80a880;">(</span>Hacker Alyssa P<span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>qeval* '<span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>salary ?person-1 ?amount-1<span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span>salary ?person-2 ?amount-2<span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span>lisp-value &lt; ?amount-1 ?amount-2<span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span>substitute-for ?person-1 ?person-2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-5">
<h5 id="orgheadline93"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.58">Exercise 4.58</a></h5>
<div class="outline-text-5" id="text-orgheadline93">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">use</span> sicp-eval-logic test<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>with-microshaft-database
 <span style="color: #7388d6;">(</span><span style="color: #a020f0;">lambda</span> <span style="color: #909183;">()</span>
   <span style="color: #909183;">(</span>qeval* '<span style="color: #709870;">(</span>assert!
             <span style="color: #907373;">(</span>rule <span style="color: #6276ba;">(</span>big-shot ?shot<span style="color: #6276ba;">)</span>
                   <span style="color: #6276ba;">(</span><span style="color: #a020f0;">and</span> <span style="color: #858580;">(</span>job ?shot <span style="color: #80a880;">(</span>?shot-division . ?shot-type<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>
                        <span style="color: #858580;">(</span><span style="color: #a020f0;">or</span> <span style="color: #80a880;">(</span>not <span style="color: #887070;">(</span>supervisor ?shot ?sup<span style="color: #887070;">)</span><span style="color: #80a880;">)</span>
                            <span style="color: #80a880;">(</span><span style="color: #a020f0;">and</span> <span style="color: #887070;">(</span>supervisor ?shot ?sup<span style="color: #887070;">)</span>
                                 <span style="color: #887070;">(</span>not <span style="color: #707183;">(</span>job ?sup <span style="color: #7388d6;">(</span>?shot-division . ?sup-type<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80a880;">)</span><span style="color: #858580;">)</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>test <span style="color: #8b2252;">"Foo"</span>
         '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>big-shot <span style="color: #6276ba;">(</span>Warbucks Oliver<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>big-shot <span style="color: #6276ba;">(</span>Scrooge Eben<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
           <span style="color: #907373;">(</span>big-shot <span style="color: #6276ba;">(</span>Bitdiddle Ben<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>qeval* '<span style="color: #907373;">(</span>big-shot ?person<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline94" class="outline-5">
<h5 id="orgheadline94"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.59">Exercise 4.59</a></h5>
<div class="outline-text-5" id="text-orgheadline94">
<ul class="org-ul">
<li><p>
a. All meetings on Friday:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>meeting ?division <span style="color: #7388d6;">(</span>Friday . $time<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
b. Alyssa's rule:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>rule <span style="color: #7388d6;">(</span>meeting-time ?person ?day-and-time<span style="color: #7388d6;">)</span>
      <span style="color: #7388d6;">(</span><span style="color: #a020f0;">or</span> <span style="color: #909183;">(</span>meeting whole-company ?day-and-time<span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span><span style="color: #a020f0;">and</span> <span style="color: #709870;">(</span>job ?person <span style="color: #907373;">(</span>?division . ?type<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span>meeting ?division ?day-and-time<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>

<li><p>
c. Alyssa's meetings on Wednesday:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span>meeting-time <span style="color: #7388d6;">(</span>Hacker Alyssa P<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">(</span>Wednesday . ?time<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline95" class="outline-5">
<h5 id="orgheadline95"><span class="done DONE">DONE</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.60">Exercise 4.60</a></h5>
<div class="outline-text-5" id="text-orgheadline95">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #a020f0;">and</span> <span style="color: #7388d6;">(</span>lives-near ?person-1 ?person-2<span style="color: #7388d6;">)</span>
     <span style="color: #7388d6;">(</span>not <span style="color: #909183;">(</span>lives-near ?person-2 ?person-1<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline96" class="outline-5">
<h5 id="orgheadline96"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.61">Exercise 4.61</a></h5>
</div>
<div id="outline-container-orgheadline97" class="outline-5">
<h5 id="orgheadline97"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.62">Exercise 4.62</a></h5>
</div>
<div id="outline-container-orgheadline98" class="outline-5">
<h5 id="orgheadline98"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.63">Exercise 4.63</a></h5>
</div>
</div>
<div id="outline-container-orgheadline99" class="outline-4">
<h4 id="orgheadline99"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.4.2">4.4.2: How the Query System Works</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline99">
<p>
No exercises.
</p>
</div>

<div id="outline-container-orgheadline100" class="outline-5">
<h5 id="orgheadline100"><span class="todo TODO">TODO</span> Read SICP 4.4.2</h5>
</div>
</div>
<div id="outline-container-orgheadline108" class="outline-4">
<h4 id="orgheadline108"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.4.3">4.4.3: Is Logic Programming Mathematical Logic?</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline108">
</div><div id="outline-container-orgheadline101" class="outline-5">
<h5 id="orgheadline101"><span class="todo TODO">TODO</span> Read SICP 4.4.3</h5>
</div>
<div id="outline-container-orgheadline102" class="outline-5">
<h5 id="orgheadline102"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.64">Exercise 4.64</a></h5>
</div>
<div id="outline-container-orgheadline103" class="outline-5">
<h5 id="orgheadline103"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.65">Exercise 4.65</a></h5>
</div>
<div id="outline-container-orgheadline104" class="outline-5">
<h5 id="orgheadline104"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.66">Exercise 4.66</a></h5>
</div>
<div id="outline-container-orgheadline105" class="outline-5">
<h5 id="orgheadline105"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.67">Exercise 4.67</a></h5>
</div>
<div id="outline-container-orgheadline106" class="outline-5">
<h5 id="orgheadline106"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.68">Exercise 4.68</a></h5>
</div>
<div id="outline-container-orgheadline107" class="outline-5">
<h5 id="orgheadline107"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.69">Exercise 4.69</a></h5>
</div>
</div>
<div id="outline-container-orgheadline120" class="outline-4">
<h4 id="orgheadline120"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.4.4">4.4.4: Implementing the Query System</a> <code>[/]</code></h4>
<div class="outline-text-4" id="text-orgheadline120">
</div><div id="outline-container-orgheadline109" class="outline-5">
<h5 id="orgheadline109"><span class="todo TODO">TODO</span> Read SICP 4.4.4</h5>
</div>
<div id="outline-container-orgheadline110" class="outline-5">
<h5 id="orgheadline110"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.70">Exercise 4.70</a></h5>
</div>
<div id="outline-container-orgheadline111" class="outline-5">
<h5 id="orgheadline111"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.71">Exercise 4.71</a></h5>
</div>
<div id="outline-container-orgheadline112" class="outline-5">
<h5 id="orgheadline112"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.72">Exercise 4.72</a></h5>
</div>
<div id="outline-container-orgheadline113" class="outline-5">
<h5 id="orgheadline113"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.73">Exercise 4.73</a></h5>
</div>
<div id="outline-container-orgheadline114" class="outline-5">
<h5 id="orgheadline114"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.74">Exercise 4.74</a></h5>
</div>
<div id="outline-container-orgheadline115" class="outline-5">
<h5 id="orgheadline115"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.75">Exercise 4.75</a></h5>
</div>
<div id="outline-container-orgheadline116" class="outline-5">
<h5 id="orgheadline116"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.76">Exercise 4.76</a></h5>
</div>
<div id="outline-container-orgheadline117" class="outline-5">
<h5 id="orgheadline117"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.77">Exercise 4.77</a></h5>
</div>
<div id="outline-container-orgheadline118" class="outline-5">
<h5 id="orgheadline118"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.78">Exercise 4.78</a></h5>
</div>
<div id="outline-container-orgheadline119" class="outline-5">
<h5 id="orgheadline119"><span class="todo TODO">TODO</span> <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_thm_4.79">Exercise 4.79</a></h5>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Robert Irelan</p>
<p class="email">Email: <a href="mailto:rirelan@gmail.com">rirelan@gmail.com</a></p>
<p class="date">Created: 2015-10-05 Mon 16:05</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
